import{_,B as D,z as B,j as o,q as e,Q as P,K as M,$ as q}from"./index-DH9ttZ5A.js";import{b as u}from"./blog-DMsYJa6l.js";import{N as W,a as H,P as K,S as O}from"./ConfirmModal-BY2lFhqh.js";import{A as E}from"./arrow-left-C3i7Cb6_.js";import{E as Q}from"./eye-TfNKSRYN.js";import{S as V}from"./save-IacTVr3j.js";import"./circle-alert-dDPiUgPe.js";import"./triangle-alert-B6-u5HDx.js";const ae=()=>{const{id:i}=_(),j=D(),{user:b}=B(),[s,h]=o.useState({title:"",slug:"",summary:"",contentRaw:"",tags:"",coverImageUrl:""}),[n,f]=o.useState("edit"),[p,x]=o.useState(null),[c,w]=o.useState(i||null),[R,y]=o.useState(!!i),[v,k]=o.useState({show:!1,type:"success",message:""}),[I,N]=o.useState(!1),r=(t,a)=>{k({show:!0,type:t,message:a})},A=t=>{h({title:t.title,slug:t.slug,summary:t.summary,contentRaw:t.contentRaw||t.content,tags:Array.isArray(t.tags)?t.tags.join(", "):t.tags,coverImageUrl:t.coverImageUrl||""}),t._id&&w(t._id)};o.useEffect(()=>{i&&b&&(y(!0),(async()=>{try{let a=null;try{const l=await u.getById(i);l&&(a=l)}catch{}a||(a=(await u.getMyPosts(b._id)).find(m=>m._id===i)),a?A(a):r("error","Post not found or access denied.")}catch(a){console.error("Error loading post for edit:",a),r("error","Failed to load post data.")}finally{y(!1)}})())},[i,b]);const d=t=>{h({...s,[t.target.name]:t.target.value})},z=()=>{if(!s.title)return;const t=s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"");h(a=>({...a,slug:t}))},S=t=>t?t.trim().split(/\s+/).filter(Boolean).length:0,L=()=>{if(!s.title.trim())return r("error","Title is required"),!1;const t=S(s.contentRaw);if(t<10)return r("error",`Content must be at least 10 words (Current: ${t})`),!1;const a=S(s.summary);return a<3?(r("error",`Summary must be at least 3 words (Current: ${a})`),!1):!0},C=async()=>{if(!s.title.trim())return r("error","Title is required to save"),{success:!1,message:"Title required"};const t=s.tags?s.tags.split(",").map(T=>T.trim()).filter(Boolean):[],a=s.contentRaw,l={...s,tags:t,content:a};let m;return c?m=await u.update(c,l):m=await u.create({...l,visibility:q.DRAFT}),m},F=async()=>{if(!s.title.trim()){r("error","Title is required");return}x("save");try{const t=await C();t.success?(!c&&t.post&&t.post._id&&w(t.post._id),r("success","Draft saved successfully!")):r("error","Error saving draft: "+t.message)}catch(t){console.error("Save Draft Error",t),r("error","An unexpected error occurred while saving.")}finally{x(null)}},U=()=>{L()&&N(!0)},$=async()=>{x("submit");try{const t=await C();if(!t.success)throw new Error("Failed to save changes: "+t.message);let a=c;if(!a&&t.post&&t.post._id&&(a=t.post._id,w(a)),!a)throw new Error("Could not determine Post ID after save.");const l=await u.submit(a);if(l.success)r("success","Post submitted for approval!"),setTimeout(()=>{j("/dashboard")},1500);else throw new Error(l.message)}catch(t){console.error("Submit Error",t),r("error","Error submitting post: "+t.message),x(null)}},g=p!==null;return R?e.jsx("div",{className:"min-h-screen pt-24 flex items-center justify-center bg-slate-50 dark:bg-slate-950 px-4 transition-colors duration-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-slate-200 dark:border-slate-800 border-t-accent-600 animate-spin"}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Loading Editor..."}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Fetching post data, please wait."})]})}):e.jsxs("div",{className:"min-h-screen pt-24 pb-12 bg-slate-50 dark:bg-slate-950 px-4 sm:px-6 lg:px-8 transition-colors duration-500",children:[e.jsx(W,{show:v.show,type:v.type,message:v.message,onClose:()=>k(t=>({...t,show:!1}))}),e.jsx(H,{isOpen:I,onClose:()=>N(!1),onConfirm:$,title:"Submit for Review?",message:"Are you sure you want to submit this post? It will be sent to moderators for approval and you won't be able to edit it until a decision is made."}),e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-8 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>j("/dashboard"),className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors",children:e.jsx(E,{size:20,className:"text-slate-600 dark:text-slate-300"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:c?"Edit Post":"New Post"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto justify-end",children:[e.jsxs("div",{className:"bg-slate-200 dark:bg-slate-800 p-1 rounded-lg flex",children:[e.jsxs("button",{onClick:()=>f("edit"),className:`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition-colors ${n==="edit"?"bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(K,{size:16})," Edit"]}),e.jsxs("button",{onClick:()=>f("preview"),className:`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition-colors ${n==="preview"?"bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(Q,{size:16})," Preview"]})]}),e.jsx("button",{onClick:F,disabled:g,className:`flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 font-medium transition-colors ${g?"opacity-50 cursor-not-allowed":""}`,children:p==="save"?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:18,className:"animate-spin"})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{size:18})," Save Draft"]})}),e.jsx("button",{onClick:U,disabled:g,className:`flex items-center gap-2 px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 font-medium transition-colors shadow-lg shadow-accent-600/20 ${g?"opacity-70 cursor-not-allowed":""}`,children:p==="submit"?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:18,className:"animate-spin"})," Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{size:18})," Submit"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:`lg:col-span-2 space-y-6 ${n==="preview"?"hidden lg:block lg:opacity-50 lg:pointer-events-none":""}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",value:s.title,onChange:d,onBlur:z,className:"w-full px-4 py-3 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-accent-500 dark:text-white text-lg font-semibold",placeholder:"Enter post title..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Slug (URL)"}),e.jsx("input",{type:"text",name:"slug",value:s.slug,onChange:d,className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg text-sm font-mono text-slate-600 dark:text-slate-400"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Summary (Min 3 words)"}),e.jsx("textarea",{name:"summary",value:s.summary,onChange:d,rows:3,className:"w-full px-4 py-3 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"Short summary for the card view..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Content (Min 10 words)"}),e.jsx("span",{className:"text-xs text-slate-500",children:"Supports HTML"})]}),e.jsx("textarea",{name:"contentRaw",value:s.contentRaw,onChange:d,rows:15,className:"w-full px-4 py-3 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-accent-500 dark:text-white font-mono text-sm",placeholder:"Write your article content here. You can use standard HTML tags..."})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 space-y-4 ${n==="preview"?"hidden":"block"}`,children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2",children:"Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Tags (comma separated)"}),e.jsx("input",{type:"text",name:"tags",value:s.tags,onChange:d,className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg dark:text-white text-sm",placeholder:"react, tech, tutorial"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300",children:"Cover Image URL"}),e.jsx("input",{type:"text",name:"coverImageUrl",value:s.coverImageUrl,onChange:d,className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg dark:text-white text-sm",placeholder:"https://..."})]}),s.coverImageUrl&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 aspect-video",children:e.jsx("img",{src:s.coverImageUrl,alt:"Preview",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-xl ${n==="preview"?"fixed inset-4 z-50 overflow-y-auto lg:static lg:inset-auto lg:z-auto lg:block":"hidden lg:block"}`,children:[n==="preview"&&e.jsx("button",{onClick:()=>f("edit"),className:"lg:hidden absolute top-4 right-4 p-2 bg-slate-100 dark:bg-slate-800 rounded-full z-10",children:e.jsx(E,{size:20})}),e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 dark:text-white",children:s.title||"Untitled Post"}),s.coverImageUrl&&e.jsx("img",{src:s.coverImageUrl,alt:"Cover",className:"w-full rounded-lg mb-4"}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg bg-white dark:bg-slate-950 overflow-hidden",children:e.jsx(O,{content:s.contentRaw})})]})]})]})]})]})]})};export{ae as default};
