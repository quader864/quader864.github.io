import{w as M,Q as R,z as $,h as o,y as F,o as e,L as p,q as x,U as q,K,A as O}from"./index-DBqzZxuE.js";import{b as j}from"./blog-DMsYJa6l.js";import{N as Q,C as Y,P as G,S as J}from"./SafeContentRenderer-DE0dxxQ0.js";import{A}from"./arrow-left-9CQCAZn5.js";import{T as V}from"./trash-2-B4oTB1To.js";import{C as W}from"./calendar-ZLGEkrPh.js";import{H as P}from"./heart-BjW2Etqi.js";import{C as X}from"./clock-fmooIl38.js";import"./circle-check-big-CT8Kt_t-.js";import"./circle-alert-zyYcdUIs.js";import"./triangle-alert-B6kgdTa8.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ee=M("history",Z),me=()=>{var C,S;const{slug:m}=R(),_=$(),[s,z]=o.useState(null),[U,D]=o.useState(!0),[k,y]=o.useState(!1),[E,N]=o.useState(!1),{user:r}=F(),[v,n]=o.useState(0),[h,d]=o.useState(!1),[u,w]=o.useState(!1),[f,I]=o.useState({show:!1,type:"success",message:""}),c=(t,i)=>{I({show:!0,type:t,message:i})};o.useEffect(()=>{if(!m)return;(async()=>{try{const i=await j.getBySlug(m);z(i)}catch(i){console.error("Failed to load post",i)}finally{D(!1)}})()},[m]),o.useEffect(()=>{if(!s||!r){d(!1),s&&n(s.likesCount||0);return}n(s.likesCount||0);const t=String(r._id||""),i=String(r.user_id||""),a=Array.isArray(s.likedBy)&&s.likedBy.some(l=>{const g=typeof l=="object"&&l?l._id||l.user_id:l,L=String(g);return t&&L===t||i&&L===i}),T=Array.isArray(r.likedPosts)&&r.likedPosts.some(l=>{const g=typeof l=="object"&&l?l._id:l;return String(g)===String(s._id)});d(!!(a||T))},[s,r]);const B=async()=>{if(s)try{const t=await j.delete(s._id);t.success?_("/dashboard"):c("error","Failed to delete: "+t.message)}catch{c("error","Error deleting post")}},H=async()=>{if(!r){c("error","You need to be logged in to like posts.");return}if(!s||u)return;w(!0);const t=h,i=v;d(!t),n(a=>t?a-1:a+1);try{const a=await j.toggleLike(s._id);n(a.likesCount),d(a.liked)}catch(a){console.error("Toggle like failed",a),d(t),n(i),c("error","Failed to update like")}finally{w(!1)}};if(U)return e.jsx("div",{className:"min-h-screen pt-32 px-6 bg-slate-50 dark:bg-slate-950 flex justify-center",children:e.jsxs("div",{className:"w-full max-w-3xl space-y-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-slate-200 dark:bg-slate-800 rounded w-3/4"}),e.jsx("div",{className:"h-64 bg-slate-200 dark:bg-slate-800 rounded-xl"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-800 rounded"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-800 rounded"})]})]})});if(!s)return e.jsxs("div",{className:"min-h-screen pt-32 text-center bg-slate-50 dark:bg-slate-950 text-slate-500",children:["Post not found. ",e.jsx(p,{to:"/blog",className:"text-accent-600 underline",children:"Return to Blog"})]});const b=r&&(r.role==="admin"||typeof s.authorId=="string"&&s.authorId===r._id||typeof s.authorId=="object"&&s.authorId&&s.authorId._id===r._id);return e.jsxs("div",{className:"min-h-screen pt-24 pb-12 bg-slate-50 dark:bg-slate-950 px-4 sm:px-6 lg:px-8 transition-colors duration-500",children:[e.jsx(Q,{show:f.show,type:f.type,message:f.message,onClose:()=>I(t=>({...t,show:!1}))}),e.jsx(Y,{isOpen:E,title:"Delete Post",message:"Are you sure you want to delete this post? This cannot be undone.",onClose:()=>N(!1),onConfirm:B}),e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col lg:flex-row gap-8",children:[e.jsxs(x.article,{className:"flex-1 min-w-0",initial:{opacity:0},animate:{opacity:1},children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(p,{to:"/blog",className:"inline-flex items-center text-sm text-slate-500 hover:text-accent-600 transition-colors",children:[e.jsx(A,{size:16,className:"mr-1"})," Back to Blog"]}),b&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{to:`/blog/editor/${s._id}`,className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(G,{size:16})," Edit"]}),e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-3 py-1.5 text-sm font-medium bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:[e.jsx(V,{size:16})," Delete"]})]})]}),e.jsxs("header",{className:"mb-8",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.tags.map(t=>e.jsxs("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-accent-50 dark:bg-accent-900/20 text-accent-700 dark:text-accent-400 border border-accent-100 dark:border-accent-800",children:["#",t]},t))}),e.jsx("h1",{className:"text-3xl md:text-5xl font-bold text-slate-900 dark:text-white mb-6 leading-tight",children:s.title}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-800 pb-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:16}),e.jsx("span",{children:s.authorId&&typeof s.authorId=="object"?`${((C=s.authorId)==null?void 0:C.firstName)||"Unknown"} ${((S=s.authorId)==null?void 0:S.lastName)||""}`:"Unknown Author"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{size:16}),e.jsx("span",{children:s.publishedAt?new Date(s.publishedAt).toLocaleDateString():"Unpublished"})]}),e.jsxs("button",{onClick:H,disabled:u,className:`flex items-center gap-1.5 px-3 py-1 rounded-full border transition-all ${h?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-600 dark:text-red-400":"bg-transparent border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[u?e.jsx(K,{size:16,className:"animate-spin text-accent-600 dark:text-accent-400"}):e.jsx(O,{mode:"wait",children:h?e.jsx(x.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},children:e.jsx(P,{size:16,className:"fill-current"})},"filled"):e.jsx(x.div,{initial:{scale:0},animate:{scale:1},exit:{scale:0},children:e.jsx(P,{size:16})},"outline")}),e.jsx("span",{className:"font-medium",children:v})]}),b&&e.jsxs("button",{onClick:()=>y(!k),className:"flex items-center gap-2 text-accent-600 hover:underline ml-auto",children:[e.jsx(ee,{size:16})," History"]})]})]}),s.coverImageUrl&&e.jsx("div",{className:"rounded-xl overflow-hidden mb-10 shadow-lg",children:e.jsx("img",{src:s.coverImageUrl,alt:s.title,className:"w-full h-auto object-cover max-h-[500px]"})}),e.jsx("div",{className:"prose-container",children:e.jsx(J,{content:s.content,title:s.title})})]}),b&&k&&e.jsx(x.aside,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"w-full lg:w-80 shrink-0",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 sticky top-24 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(X,{size:18})," Revision History"]}),e.jsx("button",{onClick:()=>y(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(A,{size:16})})]}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2",children:s.revisions&&s.revisions.length>0?[...s.revisions].reverse().map((t,i)=>{var a;return e.jsxs("div",{className:"relative pl-4 border-l-2 border-slate-200 dark:border-slate-800 pb-4 last:pb-0",children:[e.jsx("div",{className:"absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-slate-400"}),e.jsx("div",{className:"text-xs text-slate-500 mb-1",children:new Date(t.editedAt).toLocaleString()}),e.jsxs("div",{className:"text-sm font-medium text-slate-800 dark:text-slate-200 mb-1",children:["Edited by ",t.editorId&&typeof t.editorId=="object"?(a=t.editorId)==null?void 0:a.firstName:"User"]}),e.jsxs("div",{className:"text-xs text-slate-500 mb-2 italic",children:['"',t.summary.substring(0,50),'..."']})]},t.revId)}):e.jsx("div",{className:"text-sm text-slate-500 italic",children:"No history available."})})]})})]})]})};export{me as default};
