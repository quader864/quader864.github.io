import{c as q,r as i,j as e,u as as,b as ls,e as b,X as ke,U as rs,f as is,g as ds,L as V,V as ns}from"./index-jrY0XaDR.js";import{b as p}from"./blog-DMsYJa6l.js";import{u as we,U as os,v}from"./user-BjqdXGvd.js";import{N as cs,C as xs,S as ms,T as Ie,P as Ce}from"./SafeContentRenderer-DlgLN3h7.js";import{A as bs}from"./index-CBdRf8sN.js";import{l as hs}from"./proxy-DfXWtG79.js";import{C as us}from"./circle-alert-CQmtqnQA.js";import{H as Pe}from"./heart-DbhAvoIa.js";import{S as Z}from"./shield-CKy7k_2o.js";import{A as _e}from"./arrow-left-Dm4z0Fty.js";import{T as gs}from"./trash-2-172kphwE.js";import{C as k}from"./circle-check-big-DVDSFvTV.js";import{C as ze}from"./clock-CcNcfDLY.js";import{U as fs}from"./upload-ByGgbR6d.js";import{C as Ae}from"./check-BU2aypkI.js";import{E as ps}from"./eye-DYZ_xDN2.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],vs=q("file-check",js);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Le=q("file-text",Ns);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ks=q("shield-check",ys),Re=({isOpen:l,onClose:C,onConfirm:P})=>{const[N,o]=i.useState("");return l?e.jsx(bs,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:C}),e.jsxs(hs.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-sm w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full",children:e.jsx(us,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Reject Post"})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 text-sm",children:"Please provide a reason for rejection. This will be visible to the author."}),e.jsx("textarea",{value:N,onChange:M=>o(M.target.value),className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-slate-900 dark:text-white mb-6 resize-none",rows:3,placeholder:"Reason for rejection..."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:C,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{P(N),C(),o("")},disabled:!N.trim(),className:"px-6 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg font-medium transition-colors shadow-lg shadow-red-600/20 disabled:opacity-50 disabled:cursor-not-allowed",children:"Reject Post"})]})]})]})}):null},Ts=()=>{const{user:l,logout:C,isLoading:P}=as(),N=ls(),[o,M]=i.useState("overview"),[D,ee]=i.useState([]),[Se,se]=i.useState(!1),[te,L]=i.useState([]),[Ue,ae]=i.useState(!1),[ws,le]=i.useState(null),[re,ie]=i.useState([]),[Ve,O]=i.useState(!1),[Me,de]=i.useState([]),[De,ne]=i.useState(!1),[g,E]=i.useState(null),[_,oe]=i.useState({public:[],pending:[],rejected:[]}),[Is,ce]=i.useState(!1),[r,xe]=i.useState(null),[Oe,R]=i.useState(!1),[Ee,me]=i.useState(!1),[be,he]=i.useState(""),[z,ue]=i.useState(null),[ge,F]=i.useState(null),[fe,Fe]=i.useState([]),[w,A]=i.useState(null),[$e,pe]=i.useState(!1),[Te,S]=i.useState(!1),[h,j]=i.useState(null),[$,je]=i.useState({show:!1,type:"success",message:""}),[U,T]=i.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[B,G]=i.useState({isOpen:!1,postId:null}),[H,Y]=i.useState({isOpen:!1,userId:null}),[x,c]=i.useState({}),d=(s,t)=>{je({show:!0,type:s,message:t})};i.useEffect(()=>{!P&&!l&&N("/auth/login")},[P,l,N]);const Be=s=>{const t=s.verification;if(!t)return{status:ns.UNVERIFIED,emailVerified:!1,identityVerified:!1,identityStatus:"unverified"};let a="unverified";return t.identity.verified?a="verified":t.rejectionReason&&!t.identity.documentKey&&!t.identity.documentUrl||t.rejectionReason?a="rejected":(t.identity.documentKey||t.identity.documentUrl)&&(a="pending"),{status:t.overall,emailVerified:t.email.verified,identityVerified:t.identity.verified,identityStatus:a,rejectionReason:t.rejectionReason}};i.useEffect(()=>{if(l&&l.verification&&(xe(Be(l)),l.verificationPreview)){if(typeof l.verificationPreview=="string")F(l.verificationPreview);else if(typeof l.verificationPreview=="object"){const s=l.verificationPreview;F(s.presignedUrl||s.documentUrl||null)}}},[l]);const Ge=async()=>{if((l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="moderator"){ae(!0),le(null);try{const s=await p.getModerationPosts();L(s)}catch(s){console.error("Error fetching moderation posts:",s),le(s.message||"Failed to load"),d("error","Failed to fetch moderation queue")}finally{ae(!1)}}},J=async()=>{R(!0);try{const s=await v.getStatus();xe(s)}catch(s){console.error("Fetch verification status failed:",s)}finally{R(!1)}},Q=async()=>{R(!0);try{const s=await v.getPendingRequests();Fe(s)}catch(s){console.error("[Dashboard] Error fetching verifications:",s)}finally{R(!1)}};i.useEffect(()=>{o==="blog"&&l&&(se(!0),p.getMyPosts(l._id||"").then(s=>{ee(s),se(!1)})),o==="moderation"&&((l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="moderator")&&Ge(),o==="users"&&(l==null?void 0:l.role)==="admin"&&(ne(!0),we.getAll().then(s=>{de(s),ne(!1)})),o==="liked"&&l&&(O(!0),p.getAllPublic().then(s=>{const t=String(l._id||""),a=String(l.user_id||""),n=new Set;Array.isArray(l.likedPosts)&&l.likedPosts.forEach(u=>{const I=typeof u=="object"&&u?u._id:u;I&&n.add(String(I))});const f=s.filter(u=>{const I=Array.isArray(u.likedBy)&&u.likedBy.some(m=>{const X=typeof m=="object"&&m?m._id||m.user_id:m,ye=String(X);return t&&ye===t||a&&ye===a}),W=n.has(String(u._id));return I||W});ie(f),O(!1)}).catch(s=>{console.error("Failed to fetch liked posts",s),O(!1)})),(o==="verification"||o==="overview")&&l&&J(),o==="admin_verifications"&&(l==null?void 0:l.role)==="admin"&&Q(),o!=="users"&&E(null)},[o,l]);const He=async()=>{c(s=>({...s,otp:!0}));try{const s=await v.sendEmailOtp();s.success&&(me(!0),d("success",s.message))}catch(s){d("error",s.message)}finally{c(s=>({...s,otp:!1}))}},Ye=async()=>{c(s=>({...s,otp_confirm:!0}));try{const s=await v.confirmEmailOtp(be);s.success&&(d("success",s.message),J(),me(!1),he(""))}catch(s){d("error",s.message)}finally{c(s=>({...s,otp_confirm:!1}))}},Je=s=>{if(s.target.files&&s.target.files[0]){const t=s.target.files[0];if(t.size>5*1024*1024){d("error","File size exceeds 5MB limit.");return}if(!["image/jpeg","image/png"].includes(t.type)){d("error","Only JPG and PNG allowed.");return}ue(t),F(URL.createObjectURL(t))}},Qe=async()=>{if(z){c(s=>({...s,upload:!0}));try{const s=await v.uploadIdentity(z);s.success&&(d("success",s.message),ue(null),J())}catch(s){d("error",s.message)}finally{c(s=>({...s,upload:!1}))}}},Ke=async s=>{const t=s.userId||s._id;if(!t){d("error","Invalid User ID");return}c(a=>({...a,[`view-${t}`]:!0})),pe(!1),S(!0);try{const a=await v.getPresignedUrl(t);A({req:s,url:a.url,userId:t})}catch(a){d("error",a.message),S(!1)}finally{c(a=>({...a,[`view-${t}`]:!1}))}},We=async s=>{c(t=>({...t,approve_id:!0}));try{(await v.approveIdentity(s)).success&&(d("success","Identity Approved"),A(null),Q())}catch(t){d("error",t.message)}finally{c(t=>({...t,approve_id:!1}))}},Xe=async(s,t)=>{c(a=>({...a,reject_id:!0}));try{(await v.rejectIdentity(s,t)).success&&(d("success","Identity Rejected"),A(null),Y({isOpen:!1,userId:null}),Q())}catch(a){d("error",a.message)}finally{c(a=>({...a,reject_id:!1}))}},ve=async s=>{c(t=>({...t,[s]:!0}));try{const t=await p.approve(s);t.success?(L(a=>a.filter(n=>n._id!==s)),g&&K(g),h&&h._id===s&&j(null),d("success",t.message)):d("error","Action failed")}catch{d("error","An error occurred")}finally{c(t=>({...t,[s]:!1}))}},Ze=async(s,t)=>{c(a=>({...a,[s]:!0}));try{const a=await p.reject(s,t);a.success?(L(n=>n.filter(f=>f._id!==s)),g&&K(g),h&&h._id===s&&j(null),d("success",a.message)):d("error","Action failed")}catch{d("error","An error occurred")}finally{c(a=>({...a,[s]:!1}))}},qe=s=>{T({isOpen:!0,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",onConfirm:async()=>{c(t=>({...t,[s]:!0}));try{const t=await p.delete(s);t.success?(d("success",t.message),ee(a=>a.filter(n=>n._id!==s)),L(a=>a.filter(n=>n._id!==s)),ie(a=>a.filter(n=>n._id!==s)),g&&oe(a=>({...a,public:a.public.filter(n=>n._id!==s),pending:a.pending.filter(n=>n._id!==s),rejected:a.rejected.filter(n=>n._id!==s)}))):d("error",t.message)}catch{d("error","Failed to delete post")}finally{c(t=>({...t,[s]:!1}))}}})},Ne=async s=>{if(j(s),!s.content&&!s.contentRaw)try{const t=await p.getById(s._id);t&&j(t)}catch(t){console.error("Failed to fetch full post details",t)}},es=(s,t)=>{T({isOpen:!0,title:"Change User Role",message:`Are you sure you want to change this user's role to ${t}?`,onConfirm:async()=>{c(a=>({...a,[`role-${s}`]:!0}));try{const a=await we.updateRole(s,t);a.success?(d("success",a.message),de(n=>n.map(f=>f._id===s?{...f,role:t}:f))):d("error",a.message)}catch(a){d("error",a.message||"Failed to update role")}finally{c(a=>({...a,[`role-${s}`]:!1}))}}})},K=async s=>{E(s),ce(!0);try{const[t,a]=await Promise.all([p.getAllPublic(),p.getModerationPosts()]),n=m=>{const X=typeof m.authorId=="object"&&m.authorId?m.authorId._id:m.authorId;return String(X)===String(s._id)},f=t.filter(n),u=a.filter(n),I=u.filter(m=>m.visibility==="pending"),W=u.filter(m=>m.visibility==="rejected");oe({public:f,pending:I,rejected:W})}catch(t){console.error("Error inspecting user",t),d("error","Failed to load user posts")}finally{ce(!1)}},ss=()=>Oe?e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(Z,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"Account Status"})]}),e.jsxs("div",{className:"space-y-4 flex-1 animate-pulse",children:[e.jsx("div",{className:"h-12 bg-slate-100 dark:bg-slate-800/50 rounded-lg"}),e.jsx("div",{className:"h-12 bg-slate-100 dark:bg-slate-800/50 rounded-lg"})]})]}):e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(Z,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"Account Status"})]}),e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 1 (Email)"}),r!=null&&r.emailVerified?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(k,{size:12})," Verified"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 2 (Identity)"}),r!=null&&r.identityVerified||(r==null?void 0:r.status)==="FULLY_VERIFIED"?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(k,{size:12})," Verified"]}):(r==null?void 0:r.identityStatus)==="pending"||(r==null?void 0:r.status)==="PENDING"?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 px-2 py-1 rounded-full",children:[e.jsx(ze,{size:12})," Pending"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]})]})]}),ts=async()=>{await C(),N("/")},y=({id:s,label:t,icon:a})=>e.jsxs("button",{onClick:()=>M(s),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${o===s?"bg-accent-600 text-white shadow-md shadow-accent-600/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(a,{size:18}),t]});return P?e.jsx("div",{className:"min-h-screen pt-24 flex items-center justify-center bg-slate-50 dark:bg-slate-950",children:e.jsxs("div",{className:"text-slate-600 dark:text-slate-400 font-medium animate-pulse flex items-center gap-2",children:[e.jsx(b,{className:"animate-spin"})," Loading dashboard..."]})}):l?e.jsxs("div",{className:"min-h-screen pt-24 pb-12 bg-slate-50 dark:bg-slate-950 px-4 sm:px-6 lg:px-8 transition-colors duration-500",children:[e.jsx(cs,{show:$.show,type:$.type,message:$.message,onClose:()=>je(s=>({...s,show:!1}))}),e.jsx(xs,{isOpen:U.isOpen,title:U.title,message:U.message,onClose:()=>T(s=>({...s,isOpen:!1})),onConfirm:U.onConfirm}),e.jsx(Re,{isOpen:B.isOpen,onClose:()=>G(s=>({...s,isOpen:!1})),onConfirm:s=>{B.postId&&Ze(B.postId,s)}}),e.jsx(Re,{isOpen:H.isOpen,onClose:()=>Y(s=>({...s,isOpen:!1})),onConfirm:s=>{H.userId&&Xe(H.userId,s)}}),h&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>j(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white",children:["Reviewing: ",h.title]}),e.jsx("button",{onClick:()=>j(null),children:e.jsx(ke,{size:20,className:"text-slate-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-slate-950",children:e.jsx(ms,{content:h.content||h.contentRaw,title:h.title})}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{G({isOpen:!0,postId:h._id}),j(null)},className:"px-4 py-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg font-bold",children:"Reject"}),e.jsx("button",{onClick:()=>{ve(h._id),j(null)},className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700",children:"Approve & Publish"})]})]})]}),w&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-md",onClick:()=>A(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(rs,{size:20,className:"text-emerald-500"}),"Review Identity: ",w.req.userEmail]}),e.jsx("button",{onClick:()=>A(null),children:e.jsx(ke,{size:20,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-black flex items-center justify-center",children:[Te&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-10",children:e.jsx(b,{className:"animate-spin text-emerald-500",size:32})}),$e?e.jsxs("div",{className:"text-center p-8 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-200 dark:border-red-900",children:[e.jsx(Ie,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Failed to load document image."}),e.jsx("p",{className:"text-xs mt-2 opacity-70",children:"The URL may have expired or is invalid."})]}):e.jsx("img",{src:w.url,alt:"ID Document",className:"max-w-full max-h-[60vh] object-contain rounded-lg shadow-lg border border-slate-200 dark:border-slate-800",onLoad:()=>S(!1),onError:()=>{pe(!0),S(!1)}})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:["User ID: ",e.jsx("span",{className:"font-mono",children:w.userId})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Y({isOpen:!0,userId:w.userId}),disabled:x.reject_id,className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>We(w.userId),disabled:x.approve_id,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[x.approve_id&&e.jsx(b,{size:16,className:"animate-spin"}),"Approve Identity"]})]})]})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row gap-8",children:[e.jsx("aside",{className:"w-full md:w-64 shrink-0",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 sticky top-24",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-xl",children:l.firstName[0]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white truncate",children:l.firstName}),e.jsx("p",{className:"text-xs text-slate-500 truncate",children:l.email})]})]}),e.jsxs("nav",{className:"space-y-1",children:[e.jsx(y,{id:"overview",label:"Overview",icon:is}),e.jsx(y,{id:"blog",label:"My Posts",icon:Le}),e.jsx(y,{id:"liked",label:"Liked Posts",icon:Pe}),e.jsx(y,{id:"verification",label:"Verification",icon:ks}),(l.role==="admin"||l.role==="moderator")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-800"}),e.jsx("h4",{className:"px-4 text-xs font-bold text-slate-400 uppercase mb-2",children:"Staff Area"}),e.jsx(y,{id:"moderation",label:"Moderation Queue",icon:Z})]}),l.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(y,{id:"admin_verifications",label:"ID Verification",icon:vs}),e.jsx(y,{id:"users",label:"User Management",icon:os})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("button",{onClick:ts,className:"w-full flex items-center gap-3 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(ds,{size:18})," Sign Out"]})})]})}),e.jsxs("main",{className:"flex-1 min-w-0",children:[o==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Dashboard Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ss(),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg",children:e.jsx(Le,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"My Contributions"})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-1",children:D.length}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total posts created"}),e.jsxs(V,{to:"/blog/editor",className:"mt-4 inline-flex items-center text-sm text-accent-600 hover:underline",children:["Write new post ",e.jsx(_e,{className:"rotate-180 ml-1",size:14})]})]})]})]}),o==="blog"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Posts"}),e.jsxs(V,{to:"/blog/editor",className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(Ce,{size:16})," New Post"]})]}),Se?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(b,{className:"animate-spin text-accent-600"})}):D.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:e.jsx("p",{className:"text-slate-500",children:"You haven't written any posts yet."})}):e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:s.title}),e.jsxs("div",{className:"flex gap-2 text-xs mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded capitalize ${s.visibility==="public"?"bg-green-100 text-green-700":s.visibility==="pending"?"bg-yellow-100 text-yellow-700":s.visibility==="rejected"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"}`,children:s.visibility}),e.jsx("span",{className:"text-slate-400",children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{to:`/blog/editor/${s._id}`,className:"p-2 text-slate-500 hover:text-accent-600 hover:bg-slate-100 dark:hover:bg-slate-800 rounded transition-colors",children:e.jsx(Ce,{size:18})}),e.jsx("button",{onClick:()=>qe(s._id),className:"p-2 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",children:e.jsx(gs,{size:18})})]})]},s._id))})]}),o==="verification"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Account Verification"}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${r!=null&&r.emailVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(r==null?void 0:r.emailVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(k,{className:"text-green-500",size:24})}),e.jsx("h3",{className:"font-bold text-lg mb-2 dark:text-white",children:"Level 1: Email Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-6",children:"Required for basic commenting and posting."}),r!=null&&r.emailVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(k,{size:16})," Verified"]}):e.jsx("div",{className:"space-y-4 max-w-sm",children:Ee?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter OTP",className:"flex-1 px-4 py-2 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg outline-none",value:be,onChange:s=>he(s.target.value)}),e.jsx("button",{onClick:Ye,disabled:x.otp_confirm,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:x.otp_confirm?e.jsx(b,{className:"animate-spin"}):"Confirm"})]}):e.jsx("button",{onClick:He,disabled:x.otp,className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50",children:x.otp?e.jsx(b,{className:"animate-spin"}):"Send Verification Code"})})]}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${r!=null&&r.identityVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(r==null?void 0:r.identityVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(k,{className:"text-green-500",size:24})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Level 2: Identity Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Required for advanced features and badge."})]}),r!=null&&r.identityVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(k,{size:16})," Verified"]}):(r==null?void 0:r.identityStatus)==="pending"?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-900/30 rounded-lg text-yellow-800 dark:text-yellow-400 flex items-start gap-3",children:[e.jsx(ze,{className:"shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:"Under Review"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"Your document has been uploaded and is waiting for administrator approval."})]})]}),ge&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 mb-2",children:"Submitted Document:"}),e.jsx("img",{src:ge,alt:"Uploaded Doc",className:"h-32 rounded border border-slate-200 dark:border-slate-700"})]})]}):e.jsxs("div",{className:"space-y-4 max-w-sm",children:[(r==null?void 0:r.rejectionReason)&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-lg text-red-800 dark:text-red-400 mb-4",children:[e.jsxs("p",{className:"font-bold text-sm flex items-center gap-2",children:[e.jsx(Ie,{size:16})," Application Rejected"]}),e.jsxs("p",{className:"text-xs mt-1",children:["Reason: ",r.rejectionReason]})]}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 text-center hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors relative",children:[e.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:"image/jpeg,image/png",onChange:Je}),e.jsx(fs,{className:"mx-auto text-slate-400 mb-2",size:24}),e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:z?z.name:"Click to upload ID (JPG/PNG)"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Max 5MB"})]}),z&&e.jsx("button",{onClick:Qe,disabled:x.upload,className:"w-full px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:x.upload?e.jsx(b,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{size:18})," Submit Document"]})})]})]})]}),o==="moderation"&&((l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="moderator")&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Moderation Queue"}),Ue?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(b,{className:"animate-spin text-accent-600"})}):te.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800 text-slate-500",children:[e.jsx(k,{className:"mx-auto mb-2 text-green-500",size:32}),e.jsx("p",{children:"All caught up! No pending posts."})]}):e.jsx("div",{className:"space-y-4",children:te.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-1",children:s.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:["By ",s.authorId&&typeof s.authorId=="object"?`${s.authorId.firstName} ${s.authorId.lastName}`:"Unknown"," • ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${s.visibility==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:s.visibility})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-6 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:s.summary}),e.jsxs("div",{className:"flex gap-3 justify-end border-t border-slate-100 dark:border-slate-800 pt-4",children:[e.jsx("button",{onClick:()=>Ne(s),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors text-sm",children:"Preview Content"}),e.jsx("button",{onClick:()=>G({isOpen:!0,postId:s._id}),disabled:x[s._id],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors text-sm",children:"Reject"}),e.jsxs("button",{onClick:()=>ve(s._id),disabled:x[s._id],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 text-sm flex items-center gap-2",children:[x[s._id]?e.jsx(b,{className:"animate-spin",size:16}):e.jsx(Ae,{size:16})," Approve"]})]})]},s._id))})]}),o==="users"&&(l==null?void 0:l.role)==="admin"&&e.jsx("div",{className:"space-y-6",children:g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>E(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(_e,{size:20,className:"text-slate-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[g.firstName," ",g.lastName]}),e.jsxs("div",{className:"flex gap-2 text-sm text-slate-500",children:[e.jsx("span",{children:g.email}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:g.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Public Posts"}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:_.public.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Pending Review"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-500",children:_.pending.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Rejected"}),e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-500",children:_.rejected.length})]})]}),_.public.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 font-bold border-b border-slate-200 dark:border-slate-800",children:"Recent Public Posts"}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:_.public.map(s=>e.jsxs("button",{onClick:()=>Ne(s),className:"w-full text-left p-4 hover:bg-slate-50 dark:hover:bg-slate-800/30 flex justify-between items-center group",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white group-hover:text-accent-600 transition-colors",children:s.title}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(s.createdAt).toLocaleDateString()})]},s._id))})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"User Management"}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:De?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center",children:e.jsx(b,{className:"animate-spin mx-auto"})})}):Me.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("select",{value:s.role||"user",onChange:t=>es(s._id,t.target.value),disabled:x[`role-${s._id}`],className:"bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs font-bold uppercase text-slate-900 dark:text-slate-300 outline-none focus:ring-2 focus:ring-accent-500",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),x[`role-${s._id}`]&&e.jsx(b,{className:"animate-spin inline ml-2",size:12})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>K(s),className:"text-accent-600 hover:underline text-sm font-medium",children:"Inspect"})})]},s._id))})]})})]})}),o==="admin_verifications"&&(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"ID Verification Requests"}),fe.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending identity checks."}):e.jsx("div",{className:"space-y-4",children:fe.map((s,t)=>{var a;return e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold",children:(a=s.userEmail)==null?void 0:a[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:s.userEmail}),e.jsxs("p",{className:"text-xs text-slate-500",children:["User ID: ",s.userId||s._id]})]})]}),e.jsxs("button",{onClick:()=>Ke(s),disabled:x[`view-${s.userId||s._id}`],className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 font-medium transition-colors flex items-center gap-2",children:[x[`view-${s.userId||s._id}`]?e.jsx(b,{size:16,className:"animate-spin"}):e.jsx(ps,{size:16}),"Review Doc"]})]},t)})})]}),o==="liked"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Liked Posts"}),Ve?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(b,{className:"animate-spin text-accent-600"})}):re.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"You haven't liked any posts yet."}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:re.map(s=>e.jsx(V,{to:`/blog/${s.slug}`,className:"block group",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 hover:border-accent-500/50 transition-all shadow-sm hover:shadow-lg",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white group-hover:text-accent-600 transition-colors mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2",children:s.summary}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-slate-400",children:[e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[e.jsx(Pe,{size:12,fill:"currentColor"})," ",s.likesCount]})]})]})},s._id))})]})]})]})]}):null};export{Ts as default};
