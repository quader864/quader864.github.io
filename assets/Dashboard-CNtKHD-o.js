import{c as E,j as d,q as e,A as Pe,t as Ce,Q as A,W as Xe,U as Ae,Y as We,Z as ke,L as re,z as Ie,X as H,x as Ze,F as Ke,B as et}from"./index-DH9ttZ5A.js";import{b as z}from"./blog-DMsYJa6l.js";import{C as B,P as ee,a as pe,N as tt,S as st}from"./ConfirmModal-BY2lFhqh.js";import{C as le}from"./circle-alert-dDPiUgPe.js";import{H as at}from"./heart-BEm6mAMZ.js";import{C as de,T as Ee}from"./trash-2-CNn041rC.js";import{A as _e}from"./arrow-left-C3i7Cb6_.js";import{L as $e,E as rt}from"./lock-DD8fqcQh.js";import{S as ue}from"./save-IacTVr3j.js";import{E as ze}from"./eye-TfNKSRYN.js";import{T as Me}from"./triangle-alert-B6-u5HDx.js";import{P as lt}from"./plus-DD5ZkaYM.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Le=E("badge-check",dt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],be=E("check",it);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Re=E("cpu",nt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],ct=E("credit-card",ot);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],mt=E("file-check",xt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],pt=E("file-exclamation-point",ht);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ge=E("file-text",ut);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],gt=E("hash",bt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],we=E("library",ft);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Se=E("map-pin",jt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],vt=E("phone",yt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Oe=E("power",Nt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],wt=E("search",kt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Pt=E("shield-check",St);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ue=E("shield",Ct);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Te=E("upload",At);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Et=E("users",It),ie=({isOpen:t,onClose:s,onConfirm:r,isProcessing:m=!1})=>{const[c,o]=d.useState("");return t?e.jsx(Pe,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:m?void 0:s}),e.jsxs(Ce.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-sm w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full",children:e.jsx(le,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Reject Post"})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 text-sm",children:"Please provide a reason for rejection. This will be visible to the author."}),e.jsx("textarea",{value:c,onChange:p=>o(p.target.value),disabled:m,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-slate-900 dark:text-white mb-6 resize-none disabled:opacity-50",rows:3,placeholder:"Reason for rejection..."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:s,disabled:m,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:()=>r(c),disabled:!c.trim()||m,className:"px-6 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg font-medium transition-colors shadow-lg shadow-red-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:m?e.jsx(A,{size:18,className:"animate-spin"}):"Reject Post"})]})]})]})}):null},_t=({user:t,activeTab:s,setActiveTab:r,onLogout:m})=>{const c=({id:o,label:p,icon:j})=>e.jsxs("button",{onClick:()=>r(o),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${s===o?"bg-accent-600 text-white shadow-md shadow-accent-600/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(j,{size:18}),p]});return e.jsx("aside",{className:"w-full md:w-64 shrink-0",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 sticky top-24",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-xl overflow-hidden relative group shrink-0",children:t.profilePic?e.jsx("img",{src:t.profilePic,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{children:t.firstName[0]})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white truncate",title:`${t.firstName} ${t.lastName}`,children:[t.firstName," ",t.lastName]}),e.jsx("p",{className:"text-xs text-slate-500 truncate",title:t.username?`@${t.username}`:t.email,children:t.username?`@${t.username}`:t.email})]})]}),e.jsxs("nav",{className:"space-y-1",children:[e.jsx(c,{id:"overview",label:"Overview",icon:Xe}),e.jsx(c,{id:"profile",label:"My Profile",icon:Ae}),e.jsx(c,{id:"blog",label:"My Posts",icon:ge}),e.jsx(c,{id:"liked",label:"Liked Posts",icon:at}),e.jsx(c,{id:"verification",label:"Verification",icon:Pt}),(t.role==="admin"||t.role==="moderator")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-800"}),e.jsx("h4",{className:"px-4 text-xs font-bold text-slate-400 uppercase mb-2",children:"Staff Area"}),e.jsx(c,{id:"moderation",label:"Moderation Queue",icon:Ue})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(c,{id:"admin_verifications",label:"ID Verification",icon:mt}),e.jsx(c,{id:"admin_profiles",label:"Profile Reviews",icon:Le}),e.jsx(c,{id:"expert_systems",label:"Expert Access",icon:Re}),e.jsx(c,{id:"users",label:"User Management",icon:Et})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("button",{onClick:m,className:"w-full flex items-center gap-3 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(We,{size:18})," Sign Out"]})})]})})},D="https://api.quader864.ir/auth/verify",G=()=>({"Content-Type":"application/json",Accept:"application/json"}),F=async t=>{const s=t.headers.get("content-type");if(s&&s.includes("application/json")){const r=await t.json();if(!t.ok)throw new Error(r.message||`API Error: ${t.status}`);return r}else{const r=await t.text();throw console.error(`Non-JSON response from ${t.url}:`,r.substring(0,100)),new Error(`API Error: ${t.status} (Invalid Response Format)`)}},$t=t=>{var m,c,o,p,j,v,N;const s=t.verification||t;if(!s||typeof s!="object")return{status:"UNVERIFIED",emailVerified:!1,identityVerified:!1,identityStatus:"unverified"};let r="unverified";return(m=s.identity)!=null&&m.verified?r="verified":s.rejectionReason?r="rejected":((c=s.identity)!=null&&c.documentKey||(o=s.identity)!=null&&o.documentUrl)&&(r="pending"),{status:s.overall||"UNVERIFIED",emailVerified:!!((p=s.email)!=null&&p.verified),identityVerified:!!((j=s.identity)!=null&&j.verified),identityStatus:r,rejectionReason:s.rejectionReason,updatedAt:((v=s.identity)==null?void 0:v.verifiedAt)||((N=s.email)==null?void 0:N.verifiedAt)}},M={getStatus:async()=>{try{const t=await fetch(`${D}/status`,{method:"GET",headers:G(),mode:"cors",credentials:"include"}),s=await F(t);return $t(s)}catch(t){throw console.error("Fetch status failed:",t),t}},sendEmailOtp:async()=>{try{const t=await fetch(`${D}/email/send-otp`,{method:"POST",headers:G(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await F(t)}catch(t){throw new Error(t.message||"Failed to send OTP")}},confirmEmailOtp:async t=>{try{const s=await fetch(`${D}/email/confirm-otp`,{method:"POST",headers:G(),mode:"cors",credentials:"include",body:JSON.stringify({otp:t})});return await F(s)}catch(s){throw new Error(s.message||"Invalid OTP")}},uploadIdentity:async t=>{const s=new FormData;s.append("document",t);try{const r=await fetch(`${D}/identity/upload`,{method:"POST",headers:{Accept:"application/json"},mode:"cors",credentials:"include",body:s});return await F(r)}catch(r){throw new Error(r.message||"Upload failed")}},getPendingRequests:async()=>{try{const t=`${D}/identity/pending`,s=await fetch(t,{method:"GET",headers:G(),mode:"cors",credentials:"include"});return await F(s)}catch(t){return console.error("[VerificationAPI] Fetch pending failed:",t),[]}},getPresignedUrl:async t=>{try{const s=await fetch(`${D}/identity/${t}/presign`,{method:"GET",headers:G(),mode:"cors",credentials:"include"});return{url:(await F(s)).presignedUrl}}catch(s){throw new Error(s.message||"Failed to get document URL")}},approveIdentity:async t=>{try{const s=await fetch(`${D}/identity/${t}/approve`,{method:"POST",headers:G(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await F(s)}catch(s){throw new Error(s.message||"Action failed")}},rejectIdentity:async(t,s)=>{try{const r=await fetch(`${D}/identity/${t}/reject`,{method:"POST",headers:G(),mode:"cors",credentials:"include",body:JSON.stringify({reason:s})});return await F(r)}catch(r){throw new Error(r.message||"Action failed")}}},zt=({user:t,onNavigate:s})=>{const[r,m]=d.useState(0),[c,o]=d.useState(null),[p,j]=d.useState(!0);return d.useEffect(()=>{(async()=>{try{const[N,w]=await Promise.all([z.getMyPosts(t._id||""),M.getStatus()]);m(N.length),o(w)}catch(N){console.error("Overview fetch error",N)}finally{j(!1)}})()},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Dashboard Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(Ue,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"Account Status"})]}),p?e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsx("div",{className:"h-12 bg-slate-100 dark:bg-slate-800/50 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-12 bg-slate-100 dark:bg-slate-800/50 rounded-lg animate-pulse"})]}):e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 1 (Email)"}),c!=null&&c.emailVerified?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(B,{size:12})," Verified"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 2 (Identity)"}),c!=null&&c.identityVerified||(c==null?void 0:c.status)===ke.FULLY_VERIFIED?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(B,{size:12})," Verified"]}):(c==null?void 0:c.identityStatus)==="pending"||(c==null?void 0:c.status)===ke.PENDING?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 px-2 py-1 rounded-full",children:[e.jsx(de,{size:12})," Pending"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg",children:e.jsx(ge,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"My Contributions"})]}),p?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 w-20 bg-slate-100 dark:bg-slate-800/50 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-32 bg-slate-100 dark:bg-slate-800/50 rounded animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-1",children:r}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total posts created"})]}),e.jsxs(re,{to:"/blog/editor",className:"mt-4 inline-flex items-center text-sm text-accent-600 hover:underline",children:["Write new post ",e.jsx(_e,{className:"rotate-180 ml-1",size:14})]})]})]}),!p&&!t.username&&!t.phoneNumber&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 shadow-lg text-white flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Complete your Profile"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"Add your username and details to get verified faster."})]}),e.jsx("button",{onClick:()=>s("profile"),className:"px-6 py-2 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-50 transition-colors shadow-md whitespace-nowrap",children:"Update Profile"})]})]})},Z="https://api.quader864.ir/api/users",ae=()=>({"Content-Type":"application/json",Accept:"application/json"}),K=async t=>{const s=t.headers.get("content-type");if(s&&s.includes("application/json")){const r=await t.json();if(!t.ok)throw new Error(r.message||r.error||`API Error: ${t.status}`);return r}else{const r=await t.text();throw console.error(`Non-JSON response from ${t.url}:`,r.substring(0,100)),new Error(`API Error: ${t.status} (Invalid Response Format)`)}},me=t=>t.profilePic&&!t.profilePic.startsWith("http")&&t.profilePic.includes("cdn.quader864.ir")?{...t,profilePic:`https://${t.profilePic}`}:t,Q={getAll:async()=>{try{const t=await fetch(`${Z}`,{method:"GET",headers:ae(),mode:"cors",credentials:"include"});return(await K(t)).map(me)}catch(t){return console.error("Fetch users failed:",t),[]}},updateRole:async(t,s)=>{try{const r=await fetch(`${Z}/${t}/role`,{method:"PATCH",headers:ae(),mode:"cors",credentials:"include",body:JSON.stringify({role:s})});return await K(r),{success:!0,message:"User role updated successfully"}}catch(r){return{success:!1,message:r.message}}},uploadProfilePic:async t=>{const s=new FormData;s.append("profilePic",t);try{const r=await fetch(`${Z}/upload/profile-pic`,{method:"POST",headers:{Accept:"application/json"},mode:"cors",credentials:"include",body:s});return await K(r)}catch(r){throw new Error(r.message||"Image upload failed")}},updateProfile:async t=>{try{const s=await fetch(`${Z}/me/profile`,{method:"PATCH",headers:ae(),mode:"cors",credentials:"include",body:JSON.stringify(t)}),r=await K(s);return r.user&&(r.user=me(r.user)),r}catch(s){throw new Error(s.message||"Profile update failed")}},verifyProfile:async(t,s,r)=>{try{const m=await fetch(`${Z}/${t}/profile-verification`,{method:"PATCH",headers:ae(),mode:"cors",credentials:"include",body:JSON.stringify({status:s,rejectionReason:r})}),c=await K(m);return c.user&&(c.user=me(c.user)),c}catch(m){throw new Error(m.message||"Verification update failed")}}},he=({label:t,value:s,onChange:r,show:m,toggleShow:c})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:t}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($e,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:m?"text":"password",value:s,onChange:r,className:"block w-full pl-10 pr-10 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500 dark:text-white text-slate-900 transition-colors",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:c,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:m?e.jsx(rt,{className:"h-5 w-5"}):e.jsx(ze,{className:"h-5 w-5"})})]})]}),Mt=({isOpen:t,onClose:s,onSuccess:r})=>{const{changePassword:m}=Ie(),[c,o]=d.useState(""),[p,j]=d.useState(""),[v,N]=d.useState(""),[w,u]=d.useState(!1),[i,x]=d.useState(!1),[y,f]=d.useState(!1),[S,b]=d.useState(""),[P,l]=d.useState(!1);if(!t)return null;const n=async h=>{if(h.preventDefault(),b(""),console.log("[ChangePassword] Submitting form..."),p.length<8){b("New password must be at least 8 characters long.");return}if(p!==v){b("New passwords do not match.");return}if(c===p){b("New password must be different from current password.");return}l(!0);try{console.log("[ChangePassword] Calling changePassword API...");const k=await m(c,p);console.log("[ChangePassword] API Result:",k),l(!1),k.success?(r(),s(),o(""),j(""),N("")):(console.error("[ChangePassword] API Error:",k.message),b(k.message))}catch(k){console.error("[ChangePassword] Unexpected error:",k),l(!1),b("An unexpected error occurred.")}};return e.jsx(Pe,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:s}),e.jsxs(Ce.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-md w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx($e,{size:20,className:"text-accent-600"})," Change Password"]}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(H,{size:20})})]}),S&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 flex items-start gap-3",children:[e.jsx(le,{className:"text-red-600 dark:text-red-400 shrink-0",size:20}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:S})]}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsx(he,{label:"Current Password",value:c,onChange:h=>o(h.target.value),show:w,toggleShow:()=>u(!w)}),e.jsx(he,{label:"New Password",value:p,onChange:h=>j(h.target.value),show:i,toggleShow:()=>x(!i)}),e.jsx(he,{label:"Confirm New Password",value:v,onChange:h=>N(h.target.value),show:y,toggleShow:()=>f(!y)}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:P,className:"px-6 py-2 bg-accent-600 text-white hover:bg-accent-700 rounded-lg font-medium transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2",children:[P?e.jsx(A,{className:"animate-spin",size:18}):e.jsx(ue,{size:18}),"Update Password"]})]})]})]})]})})},Lt=({user:t,onNotify:s,refreshUser:r})=>{var S,b,P,l;const[m,c]=d.useState(!1),[o,p]=d.useState({}),[j,v]=d.useState({}),[N,w]=d.useState(!0),[u,i]=d.useState(!1),x=d.useRef(null);d.useEffect(()=>{p({username:t.username||"",phoneNumber:t.phoneNumber||"",passportId:t.passportId||"",address:t.address||"",country:t.country||"",city:t.city||""});const n=setTimeout(()=>w(!1),300);return()=>clearTimeout(n)},[t,m]);const y=async n=>{if(n.target.files&&n.target.files[0]){const h=n.target.files[0];v(k=>({...k,avatar:!0}));try{const k=await Q.uploadProfilePic(h);k.success&&(s("success",k.message),await r())}catch(k){s("error",k.message)}finally{v(k=>({...k,avatar:!1}))}}},f=async n=>{n.preventDefault(),v(h=>({...h,update:!0}));try{(await Q.updateProfile(o)).success&&(s("success","Profile updated successfully"),c(!1),await r())}catch(h){let k=h.message;const _=k.toLowerCase();(_.includes("duplicate")||_.includes("already exists"))&&(k="This information is already in use by another account."),s("error",k)}finally{v(h=>({...h,update:!1}))}};return N?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"h-8 w-40 bg-slate-200 dark:bg-slate-800 rounded animate-pulse"})}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-8 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 mb-8 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-800 animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-6 w-1/3 bg-slate-200 dark:bg-slate-800 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-1/4 bg-slate-200 dark:bg-slate-800 rounded animate-pulse"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"h-40 bg-slate-100 dark:bg-slate-800/50 rounded-xl animate-pulse"}),e.jsx("div",{className:"h-40 bg-slate-100 dark:bg-slate-800/50 rounded-xl animate-pulse"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Mt,{isOpen:u,onClose:()=>i(!1),onSuccess:()=>s("success","Password updated successfully")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Profile"}),!m&&e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(ee,{size:16})," Edit Profile"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-8 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 mb-8 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-4xl border-4 border-slate-50 dark:border-slate-800 overflow-hidden",children:t.profilePic?e.jsx("img",{src:t.profilePic,alt:"Profile",className:"w-full h-full object-cover"}):t.firstName[0]}),e.jsx("input",{type:"file",ref:x,className:"hidden",accept:"image/png, image/jpeg",onChange:y}),e.jsx("button",{onClick:()=>{var n;return(n=x.current)==null?void 0:n.click()},disabled:j.avatar,className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer disabled:cursor-wait",children:j.avatar?e.jsx(A,{className:"animate-spin text-white"}):e.jsx(Te,{className:"text-white",size:24})})]}),e.jsxs("div",{className:"text-center md:text-left space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 justify-center md:justify-start",children:[e.jsxs("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[t.firstName," ",t.lastName]}),((S=t.profileVerification)==null?void 0:S.status)==="verified"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-bold rounded-full border border-blue-200 dark:border-blue-800",children:[e.jsx(Le,{size:12})," Verified Profile"]}),((b=t.profileVerification)==null?void 0:b.status)==="pending"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs font-bold rounded-full border border-yellow-200 dark:border-yellow-800",children:[e.jsx(de,{size:12})," Pending Review"]}),((P=t.profileVerification)==null?void 0:P.status)==="rejected"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-bold rounded-full border border-red-200 dark:border-red-800",title:t.profileVerification.rejectionReason||"Profile rejected",children:[e.jsx(H,{size:12})," Rejected"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 text-sm text-slate-500 dark:text-slate-400",children:[t.username&&e.jsxs("span",{className:"text-accent-600 dark:text-accent-400 font-medium",children:["@",t.username]}),t.city&&t.country&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{size:14})," ",t.city,", ",t.country]})]}),((l=t.profileVerification)==null?void 0:l.status)==="rejected"&&t.profileVerification.rejectionReason&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-600 dark:text-red-400 mt-2 text-left",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",t.profileVerification.rejectionReason]})]})]}),m?e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Username"}),e.jsx("input",{type:"text",value:o.username||"",onChange:n=>p({...o,username:n.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"@username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Phone Number"}),e.jsx("input",{type:"text",value:o.phoneNumber||"",onChange:n=>p({...o,phoneNumber:n.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Passport ID"}),e.jsx("input",{type:"text",value:o.passportId||"",onChange:n=>p({...o,passportId:n.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Address"}),e.jsx("input",{type:"text",value:o.address||"",onChange:n=>p({...o,address:n.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Country"}),e.jsx("input",{type:"text",value:o.country||"",onChange:n=>p({...o,country:n.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"City"}),e.jsx("input",{type:"text",value:o.city||"",onChange:n=>p({...o,city:n.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-900/30 rounded-lg text-sm text-yellow-800 dark:text-yellow-400 flex gap-3",children:[e.jsx(pt,{className:"shrink-0",size:20}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"}),' Updating sensitive profile information (Passport ID, Address, Phone) will require re-verification by our administrators. Your profile status will be set to "Pending Review".']})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),p({...t})},className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:j.update,className:"px-6 py-2 bg-accent-600 text-white hover:bg-accent-700 rounded-lg font-medium transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[j.update?e.jsx(A,{className:"animate-spin",size:18}):e.jsx(ue,{size:18}),"Save Changes"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950 p-6 rounded-xl border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2 mb-4",children:"Contact Info"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Email"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(vt,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Phone"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.phoneNumber||"Not set"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950 p-6 rounded-xl border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2 mb-4",children:"Identity & Location"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Address"}),e.jsxs("span",{className:"text-slate-700 dark:text-slate-300",children:[t.address?t.address:"Not set",t.city&&`, ${t.city}`,t.country&&`, ${t.country}`]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(gt,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Passport / National ID"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.passportId?`${t.passportId.substring(0,2)}${"*".repeat(Math.max(0,t.passportId.length-4))}${t.passportId.slice(-2)}`:"Not set"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Security Settings"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between p-4 bg-slate-50 dark:bg-slate-950 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 sm:mb-0",children:[e.jsx("div",{className:"p-2 bg-white dark:bg-slate-900 rounded-full border border-slate-200 dark:border-slate-800 text-slate-500",children:e.jsx(Oe,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:"Password"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last changed: Never"})]})]}),e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors shadow-sm",children:"Change Password"})]})]})]})]})},Rt=({user:t,onNotify:s})=>{const[r,m]=d.useState([]),[c,o]=d.useState(!0),[p,j]=d.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[v,N]=d.useState({});d.useEffect(()=>{t._id&&z.getMyPosts(t._id).then(u=>{m(u),o(!1)})},[t]);const w=u=>{j({isOpen:!0,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",isLoading:!1,onConfirm:async()=>{j(i=>({...i,isLoading:!0})),N(i=>({...i,[u]:!0}));try{const i=await z.delete(u);i.success?(s("success",i.message),m(x=>x.filter(y=>y._id!==u)),j(x=>({...x,isOpen:!1}))):(s("error",i.message),j(x=>({...x,isLoading:!1})))}catch{s("error","Failed to delete post"),j(x=>({...x,isLoading:!1}))}finally{N(i=>({...i,[u]:!1}))}}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(pe,{isOpen:p.isOpen,title:p.title,message:p.message,isLoading:p.isLoading,onClose:()=>j(u=>({...u,isOpen:!1})),onConfirm:p.onConfirm}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Posts"}),e.jsxs(re,{to:"/blog/editor",className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(ee,{size:16})," New Post"]})]}),c?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"animate-spin text-accent-600"})}):r.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:e.jsx("p",{className:"text-slate-500",children:"You haven't written any posts yet."})}):e.jsx("div",{className:"space-y-4",children:r.map(u=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:u.title}),e.jsxs("div",{className:"flex gap-2 text-xs mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded capitalize ${u.visibility==="public"?"bg-green-100 text-green-700":u.visibility==="pending"?"bg-yellow-100 text-yellow-700":u.visibility==="rejected"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"}`,children:u.visibility}),e.jsx("span",{className:"text-slate-400",children:new Date(u.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(re,{to:`/blog/editor/${u._id}`,className:"p-2 text-slate-500 hover:text-accent-600 hover:bg-slate-100 dark:hover:bg-slate-800 rounded transition-colors",children:e.jsx(ee,{size:18})}),e.jsx("button",{onClick:()=>w(u._id),className:"p-2 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",children:e.jsx(Ee,{size:18})})]})]},u._id))})]})},Ot=({user:t})=>{const[s,r]=d.useState([]),[m,c]=d.useState(!0);return d.useEffect(()=>{(async()=>{try{const p=await z.getAllPublic(),j=String(t._id||""),v=String(t.user_id||""),N=new Set;Array.isArray(t.likedPosts)&&t.likedPosts.forEach(u=>{const i=typeof u=="object"&&u?u._id:u;i&&N.add(String(i))});const w=p.filter(u=>{const i=Array.isArray(u.likedBy)&&u.likedBy.some(y=>{const f=typeof y=="object"&&y?y._id||y.user_id:y,S=String(f);return j&&S===j||v&&S===v}),x=N.has(String(u._id));return i||x});r(w)}catch(p){console.error(p)}finally{c(!1)}})()},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Liked Posts"}),m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"animate-spin text-accent-600"})}):s.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"You haven't liked any posts yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(o=>e.jsxs(re,{to:`/blog/${o.slug}`,className:"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"h-48 overflow-hidden relative",children:[o.coverImageUrl?e.jsx("img",{src:o.coverImageUrl,alt:o.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(ge,{size:48})}),e.jsx("div",{className:"absolute top-2 right-2 bg-white/90 dark:bg-black/80 backdrop-blur px-2 py-1 rounded text-xs font-bold shadow-sm",children:new Date(o.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white mb-2 line-clamp-1 group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors",children:o.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:o.summary})]})]},o._id))})]})},Ut=({onNotify:t})=>{const[s,r]=d.useState(null),[m,c]=d.useState(!1),[o,p]=d.useState(!1),[j,v]=d.useState(""),[N,w]=d.useState(null),[u,i]=d.useState({});d.useEffect(()=>{(async()=>{c(!0);try{const P=await M.getStatus();r(P)}catch(P){console.error(P)}finally{c(!1)}})()},[]);const x=async()=>{i(b=>({...b,otp:!0}));try{const b=await M.sendEmailOtp();b.success&&(p(!0),t("success",b.message))}catch(b){t("error",b.message)}finally{i(b=>({...b,otp:!1}))}},y=async()=>{i(b=>({...b,otp_confirm:!0}));try{const b=await M.confirmEmailOtp(j);if(b.success){t("success",b.message);const P=await M.getStatus();r(P),p(!1),v("")}}catch(b){t("error",b.message)}finally{i(b=>({...b,otp_confirm:!1}))}},f=b=>{if(b.target.files&&b.target.files[0]){const P=b.target.files[0];if(P.size>5*1024*1024){t("error","File size exceeds 5MB limit.");return}if(!["image/jpeg","image/png"].includes(P.type)){t("error","Only JPG and PNG allowed.");return}w(P)}},S=async()=>{if(N){i(b=>({...b,upload:!0}));try{const b=await M.uploadIdentity(N);if(b.success){t("success",b.message),w(null);const P=await M.getStatus();r(P)}}catch(b){t("error",b.message)}finally{i(b=>({...b,upload:!1}))}}};return m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"animate-spin"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Account Verification"}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${s!=null&&s.emailVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(s==null?void 0:s.emailVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(B,{className:"text-green-500",size:24})}),e.jsx("h3",{className:"font-bold text-lg mb-2 dark:text-white",children:"Level 1: Email Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-6",children:"Required for basic commenting and posting."}),s!=null&&s.emailVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(B,{size:16})," Verified"]}):e.jsx("div",{className:"space-y-4 max-w-sm",children:o?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter OTP",className:"flex-1 px-4 py-2 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg outline-none",value:j,onChange:b=>v(b.target.value)}),e.jsx("button",{onClick:y,disabled:u.otp_confirm,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:u.otp_confirm?e.jsx(A,{className:"animate-spin"}):"Confirm"})]}):e.jsx("button",{onClick:x,disabled:u.otp,className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50",children:u.otp?e.jsx(A,{className:"animate-spin"}):"Send Verification Code"})})]}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${s!=null&&s.identityVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(s==null?void 0:s.identityVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(B,{className:"text-green-500",size:24})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Level 2: Identity Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Required for advanced features and badge."})]}),s!=null&&s.identityVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(B,{size:16})," Verified"]}):(s==null?void 0:s.identityStatus)==="pending"?e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-900/30 rounded-lg text-yellow-800 dark:text-yellow-400 flex items-start gap-3",children:[e.jsx(de,{className:"shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:"Under Review"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"Your document has been uploaded and is waiting for administrator approval."})]})]})}):e.jsxs("div",{className:"space-y-4 max-w-sm",children:[(s==null?void 0:s.rejectionReason)&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-lg text-red-800 dark:text-red-400 mb-4",children:[e.jsxs("p",{className:"font-bold text-sm flex items-center gap-2",children:[e.jsx(Me,{size:16})," Application Rejected"]}),e.jsxs("p",{className:"text-xs mt-1",children:["Reason: ",s.rejectionReason]})]}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 text-center hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors relative",children:[e.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:"image/jpeg,image/png",onChange:f}),e.jsx(Te,{className:"mx-auto text-slate-400 mb-2",size:24}),e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:N?N.name:"Click to upload ID (JPG/PNG)"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Max 5MB"})]}),N&&e.jsx("button",{onClick:S,disabled:u.upload,className:"w-full px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:u.upload?e.jsx(A,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," Submit Document"]})})]})]})]})},Tt=({onNotify:t,onViewPost:s})=>{const[r,m]=d.useState([]),[c,o]=d.useState(!0),[p,j]=d.useState({}),[v,N]=d.useState({isOpen:!1,postId:null});d.useEffect(()=>{w()},[]);const w=async()=>{o(!0);try{const x=await z.getModerationPosts();m(x)}catch(x){console.error(x),t("error","Failed to fetch moderation queue")}finally{o(!1)}},u=async x=>{j(y=>({...y,[x]:!0}));try{const y=await z.approve(x);y.success&&(m(f=>f.filter(S=>S._id!==x)),t("success",y.message))}catch{t("error","An error occurred")}finally{j(y=>({...y,[x]:!1}))}},i=async(x,y)=>{j(f=>({...f,[x]:!0}));try{const f=await z.reject(x,y);f.success&&(m(S=>S.filter(b=>b._id!==x)),N({isOpen:!1,postId:null}),t("success",f.message))}catch{t("error","An error occurred")}finally{j(f=>({...f,[x]:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{isOpen:v.isOpen,isProcessing:p[v.postId||""],onClose:()=>N(x=>({...x,isOpen:!1})),onConfirm:x=>{v.postId&&i(v.postId,x)}}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Moderation Queue"}),c?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"animate-spin text-accent-600"})}):r.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800 text-slate-500",children:[e.jsx(B,{className:"mx-auto mb-2 text-green-500",size:32}),e.jsx("p",{children:"All caught up! No pending posts."})]}):e.jsx("div",{className:"space-y-4",children:r.map(x=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-1",children:x.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:["By ",x.authorId&&typeof x.authorId=="object"?`${x.authorId.firstName} ${x.authorId.lastName}`:"Unknown"," • ",new Date(x.createdAt).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${x.visibility==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:x.visibility})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-6 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:x.summary}),e.jsxs("div",{className:"flex gap-3 justify-end border-t border-slate-100 dark:border-slate-800 pt-4",children:[e.jsx("button",{onClick:()=>s(x),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors text-sm",children:"Preview Content"}),e.jsx("button",{onClick:()=>N({isOpen:!0,postId:x._id}),disabled:p[x._id],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors text-sm",children:"Reject"}),e.jsxs("button",{onClick:()=>u(x._id),disabled:p[x._id],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 text-sm flex items-center gap-2",children:[p[x._id]?e.jsx(A,{className:"animate-spin",size:16}):e.jsx(be,{size:16})," Approve"]})]})]},x._id))})]})},Dt=({onNotify:t,onViewPost:s})=>{const[r,m]=d.useState([]),[c,o]=d.useState(!1),[p,j]=d.useState(null),[v,N]=d.useState({public:[],pending:[],rejected:[]}),[w,u]=d.useState(!1),[i,x]=d.useState({}),[y,f]=d.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});d.useEffect(()=>{S()},[]);const S=async()=>{o(!0);try{const l=await Q.getAll();m(l)}catch(l){console.error(l),t("error","Failed to load users")}finally{o(!1)}},b=(l,n)=>{f({isOpen:!0,title:"Change User Role",message:`Are you sure you want to change this user's role to ${n}?`,isLoading:!1,onConfirm:async()=>{f(h=>({...h,isLoading:!0})),x(h=>({...h,[`role-${l}`]:!0}));try{const h=await Q.updateRole(l,n);h.success?(t("success",h.message),m(k=>k.map(_=>_._id===l?{..._,role:n}:_)),f(k=>({...k,isOpen:!1}))):(t("error",h.message),f(k=>({...k,isLoading:!1})))}catch(h){t("error",h.message||"Failed to update role"),f(k=>({...k,isLoading:!1}))}finally{x(h=>({...h,[`role-${l}`]:!1}))}}})},P=async l=>{j(l),u(!0);try{const[n,h]=await Promise.all([z.getAllPublic(),z.getModerationPosts()]),k=L=>{const X=typeof L.authorId=="object"&&L.authorId?L.authorId._id:L.authorId;return String(X)===String(l._id)},_=n.filter(k),J=h.filter(k),te=J.filter(L=>L.visibility==="pending"),Y=J.filter(L=>L.visibility==="rejected");N({public:_,pending:te,rejected:Y})}catch(n){console.error("Error inspecting user",n),t("error","Failed to load user posts")}finally{u(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(pe,{isOpen:y.isOpen,title:y.title,message:y.message,isLoading:y.isLoading,onClose:()=>f(l=>({...l,isOpen:!1})),onConfirm:y.onConfirm}),p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>j(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(_e,{size:20,className:"text-slate-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[p.firstName," ",p.lastName]}),e.jsxs("div",{className:"flex gap-2 text-sm text-slate-500",children:[e.jsx("span",{children:p.email}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:p.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Public Posts"}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:v.public.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Pending Review"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-500",children:v.pending.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Rejected"}),e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-500",children:v.rejected.length})]})]}),v.public.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 font-bold border-b border-slate-200 dark:border-slate-800",children:"Recent Public Posts"}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:v.public.map(l=>e.jsxs("button",{onClick:()=>s(l),className:"w-full text-left p-4 hover:bg-slate-50 dark:hover:bg-slate-800/30 flex justify-between items-center group",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white group-hover:text-accent-600 transition-colors",children:l.title}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(l.createdAt).toLocaleDateString()})]},l._id))})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"User Management"}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:c?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center",children:e.jsx(A,{className:"animate-spin mx-auto"})})}):r.map(l=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[l.firstName," ",l.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:l.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("select",{value:l.role||"user",onChange:n=>b(l._id,n.target.value),disabled:i[`role-${l._id}`],className:"bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs font-bold uppercase text-slate-900 dark:text-slate-300 outline-none focus:ring-2 focus:ring-accent-500",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),i[`role-${l._id}`]&&e.jsx(A,{className:"animate-spin inline ml-2",size:12})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:l.createdAt?new Date(l.createdAt).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>P(l),className:"text-accent-600 hover:underline text-sm font-medium",children:"Inspect"})})]},l._id))})]})})]})]})},Ft=({onNotify:t})=>{const[s,r]=d.useState([]),[m,c]=d.useState(!1),[o,p]=d.useState(null),[j,v]=d.useState(!1),[N,w]=d.useState(!1),[u,i]=d.useState({}),[x,y]=d.useState({isOpen:!1,userId:null});d.useEffect(()=>{f()},[]);const f=async()=>{c(!0);try{const l=await M.getPendingRequests();r(l)}catch(l){console.error(l),t("error","Failed to fetch verifications")}finally{c(!1)}},S=async l=>{const n=l.userId||l._id;if(!n){t("error","Invalid User ID");return}i(h=>({...h,[`view-${n}`]:!0})),w(!1),v(!0);try{const h=await M.getPresignedUrl(n);p({req:l,url:h.url,userId:n})}catch(h){t("error",h.message),v(!1)}finally{i(h=>({...h,[`view-${n}`]:!1}))}},b=async l=>{i(n=>({...n,approve_id:!0}));try{(await M.approveIdentity(l)).success&&(t("success","Identity Approved"),p(null),f())}catch(n){t("error",n.message)}finally{i(n=>({...n,approve_id:!1}))}},P=async(l,n)=>{i(h=>({...h,reject_id:!0}));try{(await M.rejectIdentity(l,n)).success&&(t("success","Identity Rejected"),p(null),y({isOpen:!1,userId:null}),f())}catch(h){t("error",h.message)}finally{i(h=>({...h,reject_id:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{isOpen:x.isOpen,isProcessing:u.reject_id,onClose:()=>y(l=>({...l,isOpen:!1})),onConfirm:l=>{x.userId&&P(x.userId,l)}}),o&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-md",onClick:()=>p(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(Ae,{size:20,className:"text-emerald-500"}),"Review Identity: ",o.req.userEmail]}),e.jsx("button",{onClick:()=>p(null),children:e.jsx(H,{size:20,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-black flex items-center justify-center",children:[j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-10",children:e.jsx(A,{className:"animate-spin text-emerald-500",size:32})}),N?e.jsxs("div",{className:"text-center p-8 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-200 dark:border-red-900",children:[e.jsx(Me,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Failed to load document image."}),e.jsx("p",{className:"text-xs mt-2 opacity-70",children:"The URL may have expired or is invalid."})]}):e.jsx("img",{src:o.url,alt:"ID Document",className:"max-w-full max-h-[60vh] object-contain rounded-lg shadow-lg border border-slate-200 dark:border-slate-800",onLoad:()=>v(!1),onError:()=>{w(!0),v(!1)}})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:["User ID: ",e.jsx("span",{className:"font-mono",children:o.userId})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>y({isOpen:!0,userId:o.userId}),disabled:u.reject_id,className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>b(o.userId),disabled:u.approve_id,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[u.approve_id&&e.jsx(A,{size:16,className:"animate-spin"}),"Approve Identity"]})]})]})]})]}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"ID Verification Requests"}),m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"animate-spin text-accent-600"})}):s.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending identity checks."}):e.jsx("div",{className:"space-y-4",children:s.map((l,n)=>{var h;return e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold",children:(h=l.userEmail)==null?void 0:h[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:l.userEmail}),e.jsxs("p",{className:"text-xs text-slate-500",children:["User ID: ",l.userId||l._id]})]})]}),e.jsxs("button",{onClick:()=>S(l),disabled:u[`view-${l.userId||l._id}`],className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 font-medium transition-colors flex items-center gap-2",children:[u[`view-${l.userId||l._id}`]?e.jsx(A,{size:16,className:"animate-spin"}):e.jsx(ze,{size:16}),"Review Doc"]})]},n)})})]})},Vt=({onNotify:t})=>{const[s,r]=d.useState([]),[m,c]=d.useState(!1),[o,p]=d.useState({}),[j,v]=d.useState({isOpen:!1,userId:null});d.useEffect(()=>{N()},[]);const N=async()=>{c(!0);try{const i=await Q.getAll();r(i)}catch(i){console.error(i),t("error","Failed to fetch profiles")}finally{c(!1)}},w=async(i,x,y)=>{p(f=>({...f,[`prof_${i}`]:!0}));try{(await Q.verifyProfile(i,x,y)).success&&(t("success",`Profile ${x}`),v({isOpen:!1,userId:null}),N())}catch(f){t("error",f.message)}finally{p(f=>({...f,[`prof_${i}`]:!1}))}},u=s.filter(i=>{var x,y;return((x=i.profileVerification)==null?void 0:x.requiresReview)&&((y=i.profileVerification)==null?void 0:y.status)==="pending"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{isOpen:j.isOpen,isProcessing:j.userId?o[`prof_${j.userId}`]:!1,onClose:()=>v(i=>({...i,isOpen:!1})),onConfirm:i=>{j.userId&&w(j.userId,"rejected",i)}}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Profile Change Reviews"}),m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(A,{className:"animate-spin text-accent-600"})}):u.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending profile reviews."}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.map(i=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center font-bold text-xl text-slate-500 overflow-hidden",children:i.profilePic?e.jsx("img",{src:i.profilePic,className:"w-full h-full object-cover"}):i.firstName[0]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:[i.firstName," ",i.lastName]}),e.jsx("div",{className:"text-sm text-slate-500",children:i.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>v({isOpen:!0,userId:i._id||null}),disabled:o[`prof_${i._id}`],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>i._id&&w(i._id,"verified"),disabled:o[`prof_${i._id}`],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 flex items-center gap-2",children:[o[`prof_${i._id}`]?e.jsx(A,{size:16,className:"animate-spin"}):e.jsx(be,{size:16})," Approve"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Username"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:i.username||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Phone"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:i.phoneNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Passport ID"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:i.passportId||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Address"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:i.address||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Location"})," ",e.jsxs("span",{className:"font-medium dark:text-slate-200",children:[i.city||"-",", ",i.country||"-"]})]})]})]},i._id))})]})},R="https://api.quader864.ir/api/expert/admin",O=()=>({"Content-Type":"application/json",Accept:"application/json"}),U=async t=>{const s=t.headers.get("content-type");if(s&&s.includes("application/json")){const r=await t.json();if(!t.ok){if(r.results||r.details)return r;throw new Error(r.message||`API Error: ${t.status}`)}return r}else{const r=await t.text();throw console.error(`Non-JSON response from ${t.url}:`,r.substring(0,100)),new Error(`API Error: ${t.status} (Invalid Response Format)`)}},V={getAvailableExperts:async()=>{try{const t=await fetch(`${R}/available-experts`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(t)}catch{return console.warn("Using fallback experts list"),{success:!0,experts:[{expertId:"EA_TREND_01",expertName:"TrendScout Pro",description:"Trend following EA",isActive:!0},{expertId:"EA_SCALP_X",expertName:"Scalp Master X",description:"High frequency scalper",isActive:!0},{expertId:"EA_GRID_V2",expertName:"Grid Logic V2",description:"Grid system with hedging",isActive:!1}]}}},addExpert:async t=>{try{const s=await fetch(`${R}/add-expert`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify(t)});return await U(s)}catch(s){throw s}},searchUsers:async(t,s=1,r=20)=>{try{const m=new URLSearchParams({q:t,page:String(s),limit:String(r)}),c=await fetch(`${R}/users-search?${m.toString()}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(c)}catch(m){return console.error("User search error:",m),{success:!1,users:[],total:0}}},addUser:async t=>{try{const s=await fetch(`${R}/add-user`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify(t)});return await U(s)}catch(s){throw s}},removeUser:async(t,s)=>{try{const r=await fetch(`${R}/remove-user`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:t,expertId:s})});return await U(r)}catch(r){throw r}},updateUser:async(t,s,r)=>{try{const m=await fetch(`${R}/update-user`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:t,expertId:s,updates:r})});return await U(m)}catch(m){throw m}},getUsers:async t=>{try{const s=new URLSearchParams;t!=null&&t.expertId&&s.append("expertId",t.expertId),t!=null&&t.licenseType&&s.append("licenseType",t.licenseType),(t==null?void 0:t.isActive)!==void 0&&s.append("isActive",String(t.isActive));const r=await fetch(`${R}/users?${s.toString()}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(r)}catch(s){throw console.error("Fetch expert users failed:",s),s}},getUserDetails:async t=>{try{const s=await fetch(`${R}/user/${encodeURIComponent(t)}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(s)}catch(s){throw s}},toggleAccess:async(t,s,r)=>{try{const m=await fetch(`${R}/toggle-access`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:t,expertId:s,isActive:r})});return await U(m)}catch(m){throw m}},getStats:async t=>{try{const s=new URLSearchParams;t&&s.append("expertId",t);const r=await fetch(`${R}/usage-stats?${s.toString()}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(r)}catch(s){throw s}}},Bt=({onNotify:t})=>{const[s,r]=d.useState([]),[m,c]=d.useState(null),[o,p]=d.useState([]),[j,v]=d.useState(!1),[N,w]=d.useState(!1),[u,i]=d.useState(!1),[x,y]=d.useState({}),[f,S]=d.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[b,P]=d.useState("add"),[l,n]=d.useState({userEmail:"",expertId:"",expertName:"",licenseType:"basic",expirationDate:"",maxAccounts:1,isActive:!0,notes:"",subStatus:"active",subPlan:"professional",subPeriodEnd:"",subPaymentMethod:"stripe"}),[h,k]=d.useState([]),[_,J]=d.useState(""),[te,Y]=d.useState([]),[L,X]=d.useState(!1),[se,ne]=d.useState("partial"),[oe,ce]=d.useState(null),W=d.useRef(null),[Gt,fe]=d.useState("create"),[Jt,je]=d.useState(!1),[qt,De]=d.useState(""),[Ht,ye]=d.useState({expertId:"",name:"",description:"",metadata:"{}",isActive:!0}),[Qt,ve]=d.useState(null);d.useEffect(()=>{q()},[]);const q=async()=>{v(!0);try{const[a,g,C]=await Promise.all([V.getUsers(),V.getStats(),V.getAvailableExperts()]);r(a.users),c(g.stats),p(C.experts||[])}catch(a){console.error("Expert Data Fetch Error",a),t("error","Failed to load expert data: "+a.message)}finally{v(!1)}};d.useEffect(()=>(W.current&&clearTimeout(W.current),_.trim().length>=2?(X(!0),W.current=setTimeout(async()=>{try{const a=await V.searchUsers(_);Y(a.users)}catch(a){console.error("Search error",a)}finally{X(!1)}},400)):(Y([]),X(!1)),()=>{W.current&&clearTimeout(W.current)}),[_]);const Fe=a=>{const g=o.find(C=>C.expertId===a);n(C=>({...C,expertId:a,expertName:g?g.expertName:C.expertName}))},Ve=a=>{h.find(g=>g.email===a.email)||k(g=>[...g,a]),J(""),Y([])},Be=a=>{k(g=>g.filter(C=>C.email!==a))},Ge=()=>{n({userEmail:"",expertId:o.length>0?o[0].expertId:"",expertName:o.length>0?o[0].expertName:"",licenseType:"basic",expirationDate:"",maxAccounts:1,isActive:!0,notes:"",subStatus:"active",subPlan:"professional",subPeriodEnd:"",subPaymentMethod:"stripe"}),k([]),J(""),P("add"),ne("partial"),ce(null),w(!0)},Je=(a,g)=>{var C,I,$,T;n({userEmail:a.email,expertId:g.expertId,expertName:g.expertName,licenseType:g.licenseType,expirationDate:g.expirationDate?new Date(g.expirationDate).toISOString().split("T")[0]:"",maxAccounts:g.maxAccounts||1,isActive:g.isActive,notes:"",subStatus:((C=g.subscription)==null?void 0:C.status)||"active",subPlan:((I=g.subscription)==null?void 0:I.plan)||"professional",subPeriodEnd:($=g.subscription)!=null&&$.currentPeriodEnd?new Date(g.subscription.currentPeriodEnd).toISOString().split("T")[0]:"",subPaymentMethod:((T=g.subscription)==null?void 0:T.paymentMethod)||"stripe"}),k([{email:a.email,firstName:a.firstName||"",lastName:a.lastName||""}]),P("edit"),ce(null),w(!0)},qe=async a=>{a.preventDefault(),y(g=>({...g,expert_submit:!0}));try{const g={status:l.subStatus,plan:l.subPlan,currentPeriodEnd:l.subPeriodEnd||void 0,paymentMethod:l.subPaymentMethod},C={licenseType:l.licenseType,expirationDate:l.expirationDate||void 0,maxAccounts:l.maxAccounts,isActive:l.isActive,subscription:g};if(b==="add"){const I=h.map(xe=>({userEmail:xe.email,expertId:l.expertId,expertName:l.expertName,updates:C,notes:l.notes}));if(I.length===0)if(l.userEmail)I.push({userEmail:l.userEmail,expertId:l.expertId,expertName:l.expertName,updates:C,notes:l.notes});else throw new Error("Please select at least one user.");const $={items:I,atomic:se==="atomic"},T=await V.addUser($);T.results?(ce(T.results),(T.success||T.results.some(xe=>xe.success))&&q()):T.success&&(t("success",T.message||`Access granted to ${I.length} users.`),w(!1),q())}else{const I=await V.updateUser(l.userEmail,l.expertId,C);I.success&&(t("success",I.message),w(!1),q())}}catch(g){t("error",g.message||"Operation failed")}finally{y(g=>({...g,expert_submit:!1}))}},He=async(a,g,C)=>{const I=`toggle_${a}_${g}`;y($=>({...$,[I]:!0}));try{const $=await V.toggleAccess(a,g,!C);$.success&&(t("success",$.message),q())}catch($){t("error",$.message)}finally{y($=>({...$,[I]:!1}))}},Qe=(a,g)=>{S({isOpen:!0,title:"Remove Expert Access",message:`Are you sure you want to remove expert ${g} from user ${a}?`,isLoading:!1,onConfirm:async()=>{S(C=>({...C,isLoading:!0}));try{const C=await V.removeUser(a,g);C.success&&(t("success",C.message),q(),S(I=>({...I,isOpen:!1})))}catch(C){t("error",C.message),S(I=>({...I,isLoading:!1}))}}})},Ne=()=>{ye({expertId:"",name:"",description:"",metadata:`{
  "category": "scalper"
}`,isActive:!0}),De(`[
  { "expertId": "EXP_1", "name": "Expert One" },
  { "expertId": "EXP_2", "name": "Expert Two" }
]`),fe("create"),je(!1),ve(null),i(!0)},Ye=a=>{ye({expertId:a.expertId,name:a.expertName,description:a.description||"",metadata:JSON.stringify(a.metadata||{},null,2),isActive:a.isActive!==!1}),fe("edit"),je(!1),ve(null),i(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(pe,{isOpen:f.isOpen,title:f.title,message:f.message,isLoading:f.isLoading,onClose:()=>S(a=>({...a,isOpen:!1})),onConfirm:f.onConfirm}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Expert Access Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ne,className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg font-bold flex items-center gap-2 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(we,{size:18})," Manage Catalog"]}),e.jsxs("button",{onClick:Ge,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold flex items-center gap-2 hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20",children:[e.jsx(Re,{size:18})," Grant Access"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(we,{size:18,className:"text-accent-500"})," Available Expert Catalog"]}),e.jsxs("button",{onClick:Ne,className:"text-xs font-bold text-accent-600 hover:underline flex items-center gap-1",children:[e.jsx(lt,{size:12})," Add New"]})]}),j?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(a=>e.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-950 animate-pulse",children:[e.jsx("div",{className:"h-5 bg-slate-200 dark:bg-slate-800 rounded w-3/4 mb-3"}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-800 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-12 bg-slate-200 dark:bg-slate-800 rounded w-full"})]},a))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.length>0?o.map(a=>e.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-950 hover:border-accent-500/50 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-900 dark:text-white",children:a.expertName}),e.jsx("span",{className:`w-2 h-2 rounded-full ${a.isActive!==!1?"bg-emerald-500":"bg-red-500"}`,title:a.isActive!==!1?"Active":"Inactive"})]}),e.jsx("p",{className:"text-xs text-slate-500 font-mono mb-2",children:a.expertId}),a.description&&e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-3 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex justify-end opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("button",{onClick:()=>Ye(a),className:"text-xs font-medium text-accent-600 hover:text-accent-700 dark:hover:text-accent-400 flex items-center gap-1",children:[e.jsx(ee,{size:12})," Edit"]})})]},a.expertId)):e.jsx("div",{className:"col-span-full text-center py-8 text-slate-500 text-sm",children:"No experts defined in catalog."})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Licenses"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:(m==null?void 0:m.totalUsers)||0})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Active Users"}),e.jsx("div",{className:"text-2xl font-black text-emerald-600 dark:text-emerald-400 mt-1",children:(m==null?void 0:m.activeUsers)||0})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Trades"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:((m==null?void 0:m.totalTrades)||0).toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"System Profit"}),e.jsxs("div",{className:"text-2xl font-black text-green-600 dark:text-green-400 mt-1",children:["$",((m==null?void 0:m.totalProfit)||0).toLocaleString()]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px]",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Expert System"}),e.jsx("th",{className:"px-6 py-4",children:"License"}),e.jsx("th",{className:"px-6 py-4",children:"Subscription"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:j?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsx(A,{className:"animate-spin mx-auto text-emerald-600"})})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-500",children:"No active expert licenses found."})}):s.map(a=>a.experts.map((g,C)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[a.firstName," ",a.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:a.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:g.expertName}),e.jsx("div",{className:"text-xs text-slate-500 font-mono",children:g.expertId})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex px-2 py-1 rounded text-xs font-bold uppercase bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700",children:g.licenseType})}),e.jsx("td",{className:"px-6 py-4",children:g.subscription?e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white capitalize",children:g.subscription.plan||"No Plan"}),e.jsx("div",{className:`capitalize font-medium ${g.subscription.status==="active"?"text-emerald-500":"text-slate-400"}`,children:g.subscription.status})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"None"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-bold ${g.isActive?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${g.isActive?"bg-emerald-500":"bg-red-500"}`}),g.isActive?"Active":"Suspended"]})}),e.jsxs("td",{className:"px-6 py-4 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Je(a,g),className:"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded transition-colors",title:"Edit Access",children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:()=>He(a.email,g.expertId,g.isActive),className:`p-1.5 rounded transition-colors ${g.isActive?"text-slate-500 hover:text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/20":"text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20"}`,title:g.isActive?"Suspend":"Activate",disabled:x[`toggle_${a.email}_${g.expertId}`],children:x[`toggle_${a.email}_${g.expertId}`]?e.jsx(A,{size:16,className:"animate-spin"}):e.jsx(Oe,{size:16})}),e.jsx("button",{onClick:()=>Qe(a.email,g.expertId),className:"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Revoke Access",children:e.jsx(Ee,{size:16})})]})]},`${a.email}-${C}`)))})]})})}),N&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>w(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto shadow-2xl border border-slate-200 dark:border-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900 sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:b==="add"?"Grant Expert Access":"Edit Access"}),e.jsx("button",{onClick:()=>w(!1),children:e.jsx(H,{size:20,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"})})]}),oe?e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Batch Operation Results"}),se==="atomic"&&oe.some(a=>!a.success)&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 p-4 rounded-lg mb-4 text-sm flex gap-3",children:[e.jsx(le,{className:"shrink-0",size:20}),e.jsxs("p",{children:[e.jsx("strong",{children:"Operation Failed:"})," Strict mode was enabled and errors occurred."]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-slate-200 dark:border-slate-800 rounded-lg divide-y divide-slate-200 dark:divide-slate-800 mb-6 custom-scrollbar",children:oe.map((a,g)=>e.jsxs("div",{className:`p-3 flex items-start justify-between gap-4 ${a.success?"bg-green-50/50 dark:bg-green-900/10":"bg-red-50/50 dark:bg-red-900/10"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-white",children:a.userEmail}),e.jsx("div",{className:"text-xs text-slate-500",children:a.expertId}),!a.success&&a.error&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:a.error})]}),e.jsx("div",{className:"shrink-0 pt-1",children:a.success?e.jsx(B,{size:18,className:"text-emerald-500"}):e.jsx(le,{size:18,className:"text-red-500"})})]},g))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>w(!1),className:"px-6 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-lg font-bold",children:"Close"})})]}):e.jsxs("form",{onSubmit:qe,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Select Expert"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:l.expertId,onChange:a=>Fe(a.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white appearance-none",disabled:b==="edit",children:[o.length===0&&e.jsx("option",{value:"",children:"Loading experts..."}),o.map(a=>e.jsxs("option",{value:a.expertId,children:[a.expertName," (",a.expertId,")"]},a.expertId))]}),e.jsx(Ke,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",size:16})]})]}),b==="add"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Add Users"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:h.map(a=>e.jsxs("div",{className:"flex items-center gap-1 bg-accent-100 dark:bg-accent-900/30 text-accent-800 dark:text-accent-300 px-2 py-1 rounded-full text-xs font-medium border border-accent-200 dark:border-accent-800",children:[e.jsxs("span",{children:[a.firstName," ",a.lastName]}),e.jsx("button",{type:"button",onClick:()=>Be(a.email),className:"hover:text-red-500",children:e.jsx(H,{size:12})})]},a.email))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:_,onChange:a=>J(a.target.value),className:"w-full px-3 py-2 pl-9 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"Search by name or email..."}),e.jsx(wt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),L&&e.jsx(A,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-slate-400",size:16}),te.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg shadow-xl max-h-60 overflow-y-auto z-20",children:te.map(a=>e.jsxs("button",{type:"button",onClick:()=>Ve(a),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-800 border-b border-slate-100 dark:border-slate-800 last:border-0 flex flex-col",children:[e.jsxs("span",{className:"font-bold text-sm text-slate-800 dark:text-white",children:[a.firstName," ",a.lastName]}),e.jsx("span",{className:"text-xs text-slate-500",children:a.email})]},a.email))})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"User Email"}),e.jsx("input",{type:"email",disabled:!0,value:l.userEmail,className:"w-full px-3 py-2 bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-500 cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"License Type"}),e.jsxs("select",{value:l.licenseType,onChange:a=>n({...l,licenseType:a.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"}),e.jsx("option",{value:"trial",children:"Trial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Max Accounts"}),e.jsx("input",{type:"number",min:"1",value:l.maxAccounts,onChange:a=>n({...l,maxAccounts:parseInt(a.target.value)||1}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-200 dark:border-slate-800 space-y-4",children:[e.jsxs("h4",{className:"text-xs font-bold uppercase text-slate-500 flex items-center gap-2 mb-2",children:[e.jsx(ct,{size:14})," Subscription Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Status"}),e.jsxs("select",{value:l.subStatus,onChange:a=>n({...l,subStatus:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Plan"}),e.jsxs("select",{value:l.subPlan,onChange:a=>n({...l,subPlan:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Period End"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:l.subPeriodEnd,onChange:a=>n({...l,subPeriodEnd:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white"}),e.jsx(de,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Payment Method"}),e.jsx("input",{type:"text",placeholder:"stripe, crypto, etc.",value:l.subPaymentMethod,onChange:a=>n({...l,subPaymentMethod:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white"})]})]})]}),b==="add"&&h.length>1&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Batch Operation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ne("partial"),className:`flex-1 py-2 text-xs font-bold rounded-md border transition-all ${se==="partial"?"bg-white dark:bg-slate-800 border-accent-500 text-accent-600 dark:text-accent-400 shadow-sm":"border-transparent text-slate-500 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:"Partial"}),e.jsx("button",{type:"button",onClick:()=>ne("atomic"),className:`flex-1 py-2 text-xs font-bold rounded-md border transition-all ${se==="atomic"?"bg-white dark:bg-slate-800 border-accent-500 text-accent-600 dark:text-accent-400 shadow-sm":"border-transparent text-slate-500 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:"Strict"})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:x.expert_submit,className:"px-6 py-2 bg-accent-600 text-white rounded-lg font-bold hover:bg-accent-700 transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 flex items-center gap-2",children:[x.expert_submit?e.jsx(A,{size:18,className:"animate-spin"}):e.jsx(ue,{size:18}),b==="add"?"Grant Access":"Update Access"]})]})]})]})]})]})},is=()=>{const{user:t,logout:s,isLoading:r,checkAuth:m}=Ie(),c=et(),[o,p]=d.useState("overview"),[j,v]=d.useState({show:!1,type:"success",message:""}),[N,w]=d.useState(null),[u,i]=d.useState({isOpen:!1,postId:null}),[x,y]=d.useState({}),f=(n,h)=>{v({show:!0,type:n,message:h})};d.useEffect(()=>{!r&&!t&&c("/auth/login")},[r,t,c]);const S=async()=>{await s(),c("/")},b=async n=>{if(w(n),!n.content&&!n.contentRaw)try{const h=await z.getById(n._id);h&&w(h)}catch(h){console.error("Failed to fetch full post details",h)}},P=async n=>{y(h=>({...h,[n]:!0}));try{const h=await z.approve(n);h.success&&(w(null),f("success",h.message))}catch{f("error","An error occurred")}finally{y(h=>({...h,[n]:!1}))}},l=async(n,h)=>{y(k=>({...k,[n]:!0}));try{const k=await z.reject(n,h);k.success&&(w(null),i({isOpen:!1,postId:null}),f("success",k.message))}catch{f("error","An error occurred")}finally{y(k=>({...k,[n]:!1}))}};return r?e.jsx("div",{className:"min-h-screen pt-24 flex items-center justify-center bg-slate-50 dark:bg-slate-950",children:e.jsxs("div",{className:"text-slate-600 dark:text-slate-400 font-medium animate-pulse flex items-center gap-2",children:[e.jsx(A,{className:"animate-spin"})," Loading dashboard..."]})}):t?e.jsxs("div",{className:"min-h-screen pt-24 pb-12 bg-slate-50 dark:bg-slate-950 px-4 sm:px-6 lg:px-8 transition-colors duration-500",children:[e.jsx(tt,{show:j.show,type:j.type,message:j.message,onClose:()=>v(n=>({...n,show:!1}))}),N&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>w(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white",children:["Reviewing: ",N.title]}),e.jsx("button",{onClick:()=>w(null),children:e.jsx(H,{size:20,className:"text-slate-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-slate-950",children:e.jsx(st,{content:N.content||N.contentRaw,title:N.title})}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{i({isOpen:!0,postId:N._id})},className:"px-4 py-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg font-bold",children:"Reject"}),e.jsx("button",{onClick:()=>P(N._id),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700",children:"Approve & Publish"})]})]})]}),e.jsx(ie,{isOpen:u.isOpen,isProcessing:x[u.postId||""],onClose:()=>i(n=>({...n,isOpen:!1})),onConfirm:n=>{u.postId&&l(u.postId,n)}}),e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row gap-8",children:[e.jsx(_t,{user:t,activeTab:o,setActiveTab:p,onLogout:S}),e.jsxs("main",{className:"flex-1 min-w-0",children:[o==="overview"&&e.jsx(zt,{user:t,onNavigate:p}),o==="profile"&&e.jsx(Lt,{user:t,onNotify:f,refreshUser:m}),o==="blog"&&e.jsx(Rt,{user:t,onNotify:f}),o==="liked"&&e.jsx(Ot,{user:t}),o==="verification"&&e.jsx(Ut,{onNotify:f}),(t.role==="admin"||t.role==="moderator")&&o==="moderation"&&e.jsx(Tt,{onNotify:f,onViewPost:b}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[o==="users"&&e.jsx(Dt,{onNotify:f,onViewPost:b}),o==="admin_verifications"&&e.jsx(Ft,{onNotify:f}),o==="admin_profiles"&&e.jsx(Vt,{onNotify:f}),o==="expert_systems"&&e.jsx(Bt,{onNotify:f})]})]})]})]}):null};export{is as default};
