import{w as M,h as l,o as e,A as ye,q as we,K as I,N as He,U as Se,O as Qe,V as ve,L as ae,y as Ce,X as J,t as Xe,B as Ye,z as Ke}from"./index-DPo2u4xC.js";import{b as z}from"./blog-DMsYJa6l.js";import{P as W,C as xe,N as We,S as Ze}from"./ConfirmModal-fPizVar3.js";import{C as re}from"./circle-alert-CqKoqxlp.js";import{H as et}from"./heart-B4pWhdsA.js";import{S as Ae}from"./shield-BOuk6kUf.js";import{U as tt,v as L,u as q}from"./user-DLCoJB7q.js";import{C as F}from"./circle-check-big-CxsunbLo.js";import{C as me}from"./clock-BCU6O1FJ.js";import{A as Ie}from"./arrow-left-DAJw794T.js";import{L as Pe}from"./lock-DBMqP7jF.js";import{S as le}from"./save-DD91TPqv.js";import{E as st}from"./eye-off-CZaAHxj7.js";import{E as Ee}from"./eye-CcR7mqZS.js";import{U as _e}from"./upload-B_OH2K2S.js";import{T as ze}from"./trash-2-dnISkC8l.js";import{T as Le}from"./triangle-alert-HIG_Xl1a.js";import{C as he}from"./check-Db_2qDSH.js";import{P as at}from"./plus-KjCbdTAT.js";import{S as rt}from"./search-D5a_JmjX.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Me=M("badge-check",lt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],Oe=M("cpu",dt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],nt=M("file-check",it);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ct=M("file-exclamation-point",ot);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],pe=M("file-text",xt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],ht=M("hash",mt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],Ne=M("library",pt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ke=M("map-pin",bt);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],gt=M("phone",ut);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Re=M("power",ft);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],vt=M("shield-check",jt),de=({isOpen:t,onClose:r,onConfirm:g,isProcessing:h=!1})=>{const[x,i]=l.useState("");return t?e.jsx(ye,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:h?void 0:r}),e.jsxs(we.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-sm w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full",children:e.jsx(re,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Reject Post"})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 text-sm",children:"Please provide a reason for rejection. This will be visible to the author."}),e.jsx("textarea",{value:x,onChange:b=>i(b.target.value),disabled:h,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-slate-900 dark:text-white mb-6 resize-none disabled:opacity-50",rows:3,placeholder:"Reason for rejection..."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:r,disabled:h,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:()=>g(x),disabled:!x.trim()||h,className:"px-6 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg font-medium transition-colors shadow-lg shadow-red-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:h?e.jsx(I,{size:18,className:"animate-spin"}):"Reject Post"})]})]})]})}):null},Nt=({user:t,activeTab:r,setActiveTab:g,onLogout:h})=>{const x=({id:i,label:b,icon:v})=>e.jsxs("button",{onClick:()=>g(i),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${r===i?"bg-accent-600 text-white shadow-md shadow-accent-600/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(v,{size:18}),b]});return e.jsx("aside",{className:"w-full md:w-64 shrink-0",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 sticky top-24",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-xl overflow-hidden relative group shrink-0",children:t.profilePic?e.jsx("img",{src:t.profilePic,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{children:t.firstName[0]})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white truncate",title:`${t.firstName} ${t.lastName}`,children:[t.firstName," ",t.lastName]}),e.jsx("p",{className:"text-xs text-slate-500 truncate",title:t.username?`@${t.username}`:t.email,children:t.username?`@${t.username}`:t.email})]})]}),e.jsxs("nav",{className:"space-y-1",children:[e.jsx(x,{id:"overview",label:"Overview",icon:He}),e.jsx(x,{id:"profile",label:"My Profile",icon:Se}),e.jsx(x,{id:"blog",label:"My Posts",icon:pe}),e.jsx(x,{id:"liked",label:"Liked Posts",icon:et}),e.jsx(x,{id:"verification",label:"Verification",icon:vt}),(t.role==="admin"||t.role==="moderator")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-800"}),e.jsx("h4",{className:"px-4 text-xs font-bold text-slate-400 uppercase mb-2",children:"Staff Area"}),e.jsx(x,{id:"moderation",label:"Moderation Queue",icon:Ae})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{id:"admin_verifications",label:"ID Verification",icon:nt}),e.jsx(x,{id:"admin_profiles",label:"Profile Reviews",icon:Me}),e.jsx(x,{id:"expert_systems",label:"Expert Access",icon:Oe}),e.jsx(x,{id:"users",label:"User Management",icon:tt})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("button",{onClick:h,className:"w-full flex items-center gap-3 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(Qe,{size:18})," Sign Out"]})})]})})},kt=({user:t,onNavigate:r})=>{const[g,h]=l.useState(0),[x,i]=l.useState(null),[b,v]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const[y,w]=await Promise.all([z.getMyPosts(t._id||""),L.getStatus()]);h(y.length),i(w)}catch(y){console.error("Overview fetch error",y)}finally{v(!1)}})()},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Dashboard Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(Ae,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"Account Status"})]}),b?e.jsxs("div",{className:"space-y-4 flex-1 animate-pulse",children:[e.jsx("div",{className:"h-10 bg-slate-100 dark:bg-slate-800/50 rounded-lg"}),e.jsx("div",{className:"h-10 bg-slate-100 dark:bg-slate-800/50 rounded-lg"})]}):e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 1 (Email)"}),x!=null&&x.emailVerified?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(F,{size:12})," Verified"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 2 (Identity)"}),x!=null&&x.identityVerified||(x==null?void 0:x.status)===ve.FULLY_VERIFIED?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(F,{size:12})," Verified"]}):(x==null?void 0:x.identityStatus)==="pending"||(x==null?void 0:x.status)===ve.PENDING?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 px-2 py-1 rounded-full",children:[e.jsx(me,{size:12})," Pending"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg",children:e.jsx(pe,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"My Contributions"})]}),b?e.jsxs("div",{className:"space-y-2 animate-pulse",children:[e.jsx("div",{className:"h-8 w-16 bg-slate-100 dark:bg-slate-800/50 rounded"}),e.jsx("div",{className:"h-4 w-32 bg-slate-100 dark:bg-slate-800/50 rounded"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-1",children:g}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total posts created"})]}),e.jsxs(ae,{to:"/blog/editor",className:"mt-4 inline-flex items-center text-sm text-accent-600 hover:underline",children:["Write new post ",e.jsx(Ie,{className:"rotate-180 ml-1",size:14})]})]})]}),!b&&!t.username&&!t.phoneNumber&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 shadow-lg text-white flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Complete your Profile"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"Add your username and details to get verified faster."})]}),e.jsx("button",{onClick:()=>r("profile"),className:"px-6 py-2 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-50 transition-colors shadow-md whitespace-nowrap",children:"Update Profile"})]})]})},ce=({label:t,value:r,onChange:g,show:h,toggleShow:x})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:t}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Pe,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:h?"text":"password",value:r,onChange:g,className:"block w-full pl-10 pr-10 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500 dark:text-white text-slate-900 transition-colors",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:x,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:h?e.jsx(st,{className:"h-5 w-5"}):e.jsx(Ee,{className:"h-5 w-5"})})]})]}),yt=({isOpen:t,onClose:r,onSuccess:g})=>{const{changePassword:h}=Ce(),[x,i]=l.useState(""),[b,v]=l.useState(""),[k,y]=l.useState(""),[w,p]=l.useState(!1),[d,n]=l.useState(!1),[j,f]=l.useState(!1),[A,u]=l.useState(""),[N,a]=l.useState(!1);if(!t)return null;const c=async m=>{if(m.preventDefault(),u(""),console.log("[ChangePassword] Submitting form..."),b.length<8){u("New password must be at least 8 characters long.");return}if(b!==k){u("New passwords do not match.");return}if(x===b){u("New password must be different from current password.");return}a(!0);try{console.log("[ChangePassword] Calling changePassword API...");const S=await h(x,b);console.log("[ChangePassword] API Result:",S),a(!1),S.success?(g(),r(),i(""),v(""),y("")):(console.error("[ChangePassword] API Error:",S.message),u(S.message))}catch(S){console.error("[ChangePassword] Unexpected error:",S),a(!1),u("An unexpected error occurred.")}};return e.jsx(ye,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:r}),e.jsxs(we.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-md w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Pe,{size:20,className:"text-accent-600"})," Change Password"]}),e.jsx("button",{onClick:r,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(J,{size:20})})]}),A&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 flex items-start gap-3",children:[e.jsx(re,{className:"text-red-600 dark:text-red-400 shrink-0",size:20}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:A})]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx(ce,{label:"Current Password",value:x,onChange:m=>i(m.target.value),show:w,toggleShow:()=>p(!w)}),e.jsx(ce,{label:"New Password",value:b,onChange:m=>v(m.target.value),show:d,toggleShow:()=>n(!d)}),e.jsx(ce,{label:"Confirm New Password",value:k,onChange:m=>y(m.target.value),show:j,toggleShow:()=>f(!j)}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:N,className:"px-6 py-2 bg-accent-600 text-white hover:bg-accent-700 rounded-lg font-medium transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2",children:[N?e.jsx(I,{className:"animate-spin",size:18}):e.jsx(le,{size:18}),"Update Password"]})]})]})]})]})})},wt=({user:t,onNotify:r,refreshUser:g})=>{var j,f,A,u;const[h,x]=l.useState(!1),[i,b]=l.useState({}),[v,k]=l.useState({}),[y,w]=l.useState(!1),p=l.useRef(null);l.useEffect(()=>{b({username:t.username||"",phoneNumber:t.phoneNumber||"",passportId:t.passportId||"",address:t.address||"",country:t.country||"",city:t.city||""})},[t,h]);const d=async N=>{if(N.target.files&&N.target.files[0]){const a=N.target.files[0];k(c=>({...c,avatar:!0}));try{const c=await q.uploadProfilePic(a);c.success&&(r("success",c.message),await g())}catch(c){r("error",c.message)}finally{k(c=>({...c,avatar:!1}))}}},n=async N=>{N.preventDefault(),k(a=>({...a,update:!0}));try{(await q.updateProfile(i)).success&&(r("success","Profile updated successfully"),x(!1),await g())}catch(a){let c=a.message;const m=c.toLowerCase();(m.includes("duplicate")||m.includes("already exists"))&&(c="This information is already in use by another account."),r("error",c)}finally{k(a=>({...a,update:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(yt,{isOpen:y,onClose:()=>w(!1),onSuccess:()=>r("success","Password updated successfully")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Profile"}),!h&&e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(W,{size:16})," Edit Profile"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-8 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 mb-8 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-4xl border-4 border-slate-50 dark:border-slate-800 overflow-hidden",children:t.profilePic?e.jsx("img",{src:t.profilePic,alt:"Profile",className:"w-full h-full object-cover"}):t.firstName[0]}),e.jsx("input",{type:"file",ref:p,className:"hidden",accept:"image/png, image/jpeg",onChange:d}),e.jsx("button",{onClick:()=>{var N;return(N=p.current)==null?void 0:N.click()},disabled:v.avatar,className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer disabled:cursor-wait",children:v.avatar?e.jsx(I,{className:"animate-spin text-white"}):e.jsx(_e,{className:"text-white",size:24})})]}),e.jsxs("div",{className:"text-center md:text-left space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 justify-center md:justify-start",children:[e.jsxs("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[t.firstName," ",t.lastName]}),((j=t.profileVerification)==null?void 0:j.status)==="verified"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-bold rounded-full border border-blue-200 dark:border-blue-800",children:[e.jsx(Me,{size:12})," Verified Profile"]}),((f=t.profileVerification)==null?void 0:f.status)==="pending"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs font-bold rounded-full border border-yellow-200 dark:border-yellow-800",children:[e.jsx(me,{size:12})," Pending Review"]}),((A=t.profileVerification)==null?void 0:A.status)==="rejected"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-bold rounded-full border border-red-200 dark:border-red-800",title:t.profileVerification.rejectionReason||"Profile rejected",children:[e.jsx(J,{size:12})," Rejected"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 text-sm text-slate-500 dark:text-slate-400",children:[t.username&&e.jsxs("span",{className:"text-accent-600 dark:text-accent-400 font-medium",children:["@",t.username]}),t.city&&t.country&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{size:14})," ",t.city,", ",t.country]})]}),((u=t.profileVerification)==null?void 0:u.status)==="rejected"&&t.profileVerification.rejectionReason&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-600 dark:text-red-400 mt-2 text-left",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",t.profileVerification.rejectionReason]})]})]}),h?e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Username"}),e.jsx("input",{type:"text",value:i.username||"",onChange:N=>b({...i,username:N.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"@username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Phone Number"}),e.jsx("input",{type:"text",value:i.phoneNumber||"",onChange:N=>b({...i,phoneNumber:N.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Passport ID"}),e.jsx("input",{type:"text",value:i.passportId||"",onChange:N=>b({...i,passportId:N.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Address"}),e.jsx("input",{type:"text",value:i.address||"",onChange:N=>b({...i,address:N.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Country"}),e.jsx("input",{type:"text",value:i.country||"",onChange:N=>b({...i,country:N.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"City"}),e.jsx("input",{type:"text",value:i.city||"",onChange:N=>b({...i,city:N.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-900/30 rounded-lg text-sm text-yellow-800 dark:text-yellow-400 flex gap-3",children:[e.jsx(ct,{className:"shrink-0",size:20}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"}),' Updating sensitive profile information (Passport ID, Address, Phone) will require re-verification by our administrators. Your profile status will be set to "Pending Review".']})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),b({...t})},className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:v.update,className:"px-6 py-2 bg-accent-600 text-white hover:bg-accent-700 rounded-lg font-medium transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[v.update?e.jsx(I,{className:"animate-spin",size:18}):e.jsx(le,{size:18}),"Save Changes"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950 p-6 rounded-xl border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2 mb-4",children:"Contact Info"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xe,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Email"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(gt,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Phone"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.phoneNumber||"Not set"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950 p-6 rounded-xl border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2 mb-4",children:"Identity & Location"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ke,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Address"}),e.jsxs("span",{className:"text-slate-700 dark:text-slate-300",children:[t.address?t.address:"Not set",t.city&&`, ${t.city}`,t.country&&`, ${t.country}`]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ht,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Passport / National ID"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:t.passportId?`${t.passportId.substring(0,2)}${"*".repeat(Math.max(0,t.passportId.length-4))}${t.passportId.slice(-2)}`:"Not set"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Security Settings"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between p-4 bg-slate-50 dark:bg-slate-950 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 sm:mb-0",children:[e.jsx("div",{className:"p-2 bg-white dark:bg-slate-900 rounded-full border border-slate-200 dark:border-slate-800 text-slate-500",children:e.jsx(Re,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:"Password"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last changed: Never"})]})]}),e.jsx("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors shadow-sm",children:"Change Password"})]})]})]})]})},St=({user:t,onNotify:r})=>{const[g,h]=l.useState([]),[x,i]=l.useState(!0),[b,v]=l.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[k,y]=l.useState({});l.useEffect(()=>{t._id&&z.getMyPosts(t._id).then(p=>{h(p),i(!1)})},[t]);const w=p=>{v({isOpen:!0,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",isLoading:!1,onConfirm:async()=>{v(d=>({...d,isLoading:!0})),y(d=>({...d,[p]:!0}));try{const d=await z.delete(p);d.success?(r("success",d.message),h(n=>n.filter(j=>j._id!==p)),v(n=>({...n,isOpen:!1}))):(r("error",d.message),v(n=>({...n,isLoading:!1})))}catch{r("error","Failed to delete post"),v(n=>({...n,isLoading:!1}))}finally{y(d=>({...d,[p]:!1}))}}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{isOpen:b.isOpen,title:b.title,message:b.message,isLoading:b.isLoading,onClose:()=>v(p=>({...p,isOpen:!1})),onConfirm:b.onConfirm}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Posts"}),e.jsxs(ae,{to:"/blog/editor",className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(W,{size:16})," New Post"]})]}),x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):g.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:e.jsx("p",{className:"text-slate-500",children:"You haven't written any posts yet."})}):e.jsx("div",{className:"space-y-4",children:g.map(p=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:p.title}),e.jsxs("div",{className:"flex gap-2 text-xs mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded capitalize ${p.visibility==="public"?"bg-green-100 text-green-700":p.visibility==="pending"?"bg-yellow-100 text-yellow-700":p.visibility==="rejected"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"}`,children:p.visibility}),e.jsx("span",{className:"text-slate-400",children:new Date(p.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{to:`/blog/editor/${p._id}`,className:"p-2 text-slate-500 hover:text-accent-600 hover:bg-slate-100 dark:hover:bg-slate-800 rounded transition-colors",children:e.jsx(W,{size:18})}),e.jsx("button",{onClick:()=>w(p._id),className:"p-2 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",children:e.jsx(ze,{size:18})})]})]},p._id))})]})},Ct=({user:t})=>{const[r,g]=l.useState([]),[h,x]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const b=await z.getAllPublic(),v=String(t._id||""),k=String(t.user_id||""),y=new Set;Array.isArray(t.likedPosts)&&t.likedPosts.forEach(p=>{const d=typeof p=="object"&&p?p._id:p;d&&y.add(String(d))});const w=b.filter(p=>{const d=Array.isArray(p.likedBy)&&p.likedBy.some(j=>{const f=typeof j=="object"&&j?j._id||j.user_id:j,A=String(f);return v&&A===v||k&&A===k}),n=y.has(String(p._id));return d||n});g(w)}catch(b){console.error(b)}finally{x(!1)}})()},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Liked Posts"}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):r.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"You haven't liked any posts yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(i=>e.jsxs(ae,{to:`/blog/${i.slug}`,className:"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"h-48 overflow-hidden relative",children:[i.coverImageUrl?e.jsx("img",{src:i.coverImageUrl,alt:i.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(pe,{size:48})}),e.jsx("div",{className:"absolute top-2 right-2 bg-white/90 dark:bg-black/80 backdrop-blur px-2 py-1 rounded text-xs font-bold shadow-sm",children:new Date(i.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white mb-2 line-clamp-1 group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors",children:i.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:i.summary})]})]},i._id))})]})},At=({onNotify:t})=>{const[r,g]=l.useState(null),[h,x]=l.useState(!1),[i,b]=l.useState(!1),[v,k]=l.useState(""),[y,w]=l.useState(null),[p,d]=l.useState({});l.useEffect(()=>{(async()=>{x(!0);try{const N=await L.getStatus();g(N)}catch(N){console.error(N)}finally{x(!1)}})()},[]);const n=async()=>{d(u=>({...u,otp:!0}));try{const u=await L.sendEmailOtp();u.success&&(b(!0),t("success",u.message))}catch(u){t("error",u.message)}finally{d(u=>({...u,otp:!1}))}},j=async()=>{d(u=>({...u,otp_confirm:!0}));try{const u=await L.confirmEmailOtp(v);if(u.success){t("success",u.message);const N=await L.getStatus();g(N),b(!1),k("")}}catch(u){t("error",u.message)}finally{d(u=>({...u,otp_confirm:!1}))}},f=u=>{if(u.target.files&&u.target.files[0]){const N=u.target.files[0];if(N.size>5*1024*1024){t("error","File size exceeds 5MB limit.");return}if(!["image/jpeg","image/png"].includes(N.type)){t("error","Only JPG and PNG allowed.");return}w(N)}},A=async()=>{if(y){d(u=>({...u,upload:!0}));try{const u=await L.uploadIdentity(y);if(u.success){t("success",u.message),w(null);const N=await L.getStatus();g(N)}}catch(u){t("error",u.message)}finally{d(u=>({...u,upload:!1}))}}};return h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Account Verification"}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${r!=null&&r.emailVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(r==null?void 0:r.emailVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(F,{className:"text-green-500",size:24})}),e.jsx("h3",{className:"font-bold text-lg mb-2 dark:text-white",children:"Level 1: Email Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-6",children:"Required for basic commenting and posting."}),r!=null&&r.emailVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(F,{size:16})," Verified"]}):e.jsx("div",{className:"space-y-4 max-w-sm",children:i?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter OTP",className:"flex-1 px-4 py-2 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg outline-none",value:v,onChange:u=>k(u.target.value)}),e.jsx("button",{onClick:j,disabled:p.otp_confirm,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:p.otp_confirm?e.jsx(I,{className:"animate-spin"}):"Confirm"})]}):e.jsx("button",{onClick:n,disabled:p.otp,className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50",children:p.otp?e.jsx(I,{className:"animate-spin"}):"Send Verification Code"})})]}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${r!=null&&r.identityVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(r==null?void 0:r.identityVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(F,{className:"text-green-500",size:24})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Level 2: Identity Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Required for advanced features and badge."})]}),r!=null&&r.identityVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(F,{size:16})," Verified"]}):(r==null?void 0:r.identityStatus)==="pending"?e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-900/30 rounded-lg text-yellow-800 dark:text-yellow-400 flex items-start gap-3",children:[e.jsx(me,{className:"shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:"Under Review"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"Your document has been uploaded and is waiting for administrator approval."})]})]})}):e.jsxs("div",{className:"space-y-4 max-w-sm",children:[(r==null?void 0:r.rejectionReason)&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-lg text-red-800 dark:text-red-400 mb-4",children:[e.jsxs("p",{className:"font-bold text-sm flex items-center gap-2",children:[e.jsx(Le,{size:16})," Application Rejected"]}),e.jsxs("p",{className:"text-xs mt-1",children:["Reason: ",r.rejectionReason]})]}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 text-center hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors relative",children:[e.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:"image/jpeg,image/png",onChange:f}),e.jsx(_e,{className:"mx-auto text-slate-400 mb-2",size:24}),e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:y?y.name:"Click to upload ID (JPG/PNG)"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Max 5MB"})]}),y&&e.jsx("button",{onClick:A,disabled:p.upload,className:"w-full px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:p.upload?e.jsx(I,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(he,{size:18})," Submit Document"]})})]})]})]})},It=({onNotify:t,onViewPost:r})=>{const[g,h]=l.useState([]),[x,i]=l.useState(!0),[b,v]=l.useState({}),[k,y]=l.useState({isOpen:!1,postId:null});l.useEffect(()=>{w()},[]);const w=async()=>{i(!0);try{const n=await z.getModerationPosts();h(n)}catch(n){console.error(n),t("error","Failed to fetch moderation queue")}finally{i(!1)}},p=async n=>{v(j=>({...j,[n]:!0}));try{const j=await z.approve(n);j.success&&(h(f=>f.filter(A=>A._id!==n)),t("success",j.message))}catch{t("error","An error occurred")}finally{v(j=>({...j,[n]:!1}))}},d=async(n,j)=>{v(f=>({...f,[n]:!0}));try{const f=await z.reject(n,j);f.success&&(h(A=>A.filter(u=>u._id!==n)),y({isOpen:!1,postId:null}),t("success",f.message))}catch{t("error","An error occurred")}finally{v(f=>({...f,[n]:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{isOpen:k.isOpen,isProcessing:b[k.postId||""],onClose:()=>y(n=>({...n,isOpen:!1})),onConfirm:n=>{k.postId&&d(k.postId,n)}}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Moderation Queue"}),x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):g.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800 text-slate-500",children:[e.jsx(F,{className:"mx-auto mb-2 text-green-500",size:32}),e.jsx("p",{children:"All caught up! No pending posts."})]}):e.jsx("div",{className:"space-y-4",children:g.map(n=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-1",children:n.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:["By ",n.authorId&&typeof n.authorId=="object"?`${n.authorId.firstName} ${n.authorId.lastName}`:"Unknown"," • ",new Date(n.createdAt).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${n.visibility==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:n.visibility})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-6 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:n.summary}),e.jsxs("div",{className:"flex gap-3 justify-end border-t border-slate-100 dark:border-slate-800 pt-4",children:[e.jsx("button",{onClick:()=>r(n),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors text-sm",children:"Preview Content"}),e.jsx("button",{onClick:()=>y({isOpen:!0,postId:n._id}),disabled:b[n._id],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors text-sm",children:"Reject"}),e.jsxs("button",{onClick:()=>p(n._id),disabled:b[n._id],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 text-sm flex items-center gap-2",children:[b[n._id]?e.jsx(I,{className:"animate-spin",size:16}):e.jsx(he,{size:16})," Approve"]})]})]},n._id))})]})},Pt=({onNotify:t,onViewPost:r})=>{const[g,h]=l.useState([]),[x,i]=l.useState(!1),[b,v]=l.useState(null),[k,y]=l.useState({public:[],pending:[],rejected:[]}),[w,p]=l.useState(!1),[d,n]=l.useState({}),[j,f]=l.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});l.useEffect(()=>{A()},[]);const A=async()=>{i(!0);try{const a=await q.getAll();h(a)}catch(a){console.error(a),t("error","Failed to load users")}finally{i(!1)}},u=(a,c)=>{f({isOpen:!0,title:"Change User Role",message:`Are you sure you want to change this user's role to ${c}?`,isLoading:!1,onConfirm:async()=>{f(m=>({...m,isLoading:!0})),n(m=>({...m,[`role-${a}`]:!0}));try{const m=await q.updateRole(a,c);m.success?(t("success",m.message),h(S=>S.map(O=>O._id===a?{...O,role:c}:O)),f(S=>({...S,isOpen:!1}))):(t("error",m.message),f(S=>({...S,isLoading:!1})))}catch(m){t("error",m.message||"Failed to update role"),f(S=>({...S,isLoading:!1}))}finally{n(m=>({...m,[`role-${a}`]:!1}))}}})},N=async a=>{v(a),p(!0);try{const[c,m]=await Promise.all([z.getAllPublic(),z.getModerationPosts()]),S=R=>{const Q=typeof R.authorId=="object"&&R.authorId?R.authorId._id:R.authorId;return String(Q)===String(a._id)},O=c.filter(S),G=m.filter(S),Z=G.filter(R=>R.visibility==="pending"),H=G.filter(R=>R.visibility==="rejected");y({public:O,pending:Z,rejected:H})}catch(c){console.error("Error inspecting user",c),t("error","Failed to load user posts")}finally{p(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{isOpen:j.isOpen,title:j.title,message:j.message,isLoading:j.isLoading,onClose:()=>f(a=>({...a,isOpen:!1})),onConfirm:j.onConfirm}),b?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>v(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(Ie,{size:20,className:"text-slate-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[b.firstName," ",b.lastName]}),e.jsxs("div",{className:"flex gap-2 text-sm text-slate-500",children:[e.jsx("span",{children:b.email}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:b.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Public Posts"}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:k.public.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Pending Review"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-500",children:k.pending.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Rejected"}),e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-500",children:k.rejected.length})]})]}),k.public.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 font-bold border-b border-slate-200 dark:border-slate-800",children:"Recent Public Posts"}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:k.public.map(a=>e.jsxs("button",{onClick:()=>r(a),className:"w-full text-left p-4 hover:bg-slate-50 dark:hover:bg-slate-800/30 flex justify-between items-center group",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white group-hover:text-accent-600 transition-colors",children:a.title}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(a.createdAt).toLocaleDateString()})]},a._id))})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"User Management"}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center",children:e.jsx(I,{className:"animate-spin mx-auto"})})}):g.map(a=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[a.firstName," ",a.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:a.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("select",{value:a.role||"user",onChange:c=>u(a._id,c.target.value),disabled:d[`role-${a._id}`],className:"bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs font-bold uppercase text-slate-900 dark:text-slate-300 outline-none focus:ring-2 focus:ring-accent-500",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),d[`role-${a._id}`]&&e.jsx(I,{className:"animate-spin inline ml-2",size:12})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>N(a),className:"text-accent-600 hover:underline text-sm font-medium",children:"Inspect"})})]},a._id))})]})})]})]})},Et=({onNotify:t})=>{const[r,g]=l.useState([]),[h,x]=l.useState(!1),[i,b]=l.useState(null),[v,k]=l.useState(!1),[y,w]=l.useState(!1),[p,d]=l.useState({}),[n,j]=l.useState({isOpen:!1,userId:null});l.useEffect(()=>{f()},[]);const f=async()=>{x(!0);try{const a=await L.getPendingRequests();g(a)}catch(a){console.error(a),t("error","Failed to fetch verifications")}finally{x(!1)}},A=async a=>{const c=a.userId||a._id;if(!c){t("error","Invalid User ID");return}d(m=>({...m,[`view-${c}`]:!0})),w(!1),k(!0);try{const m=await L.getPresignedUrl(c);b({req:a,url:m.url,userId:c})}catch(m){t("error",m.message),k(!1)}finally{d(m=>({...m,[`view-${c}`]:!1}))}},u=async a=>{d(c=>({...c,approve_id:!0}));try{(await L.approveIdentity(a)).success&&(t("success","Identity Approved"),b(null),f())}catch(c){t("error",c.message)}finally{d(c=>({...c,approve_id:!1}))}},N=async(a,c)=>{d(m=>({...m,reject_id:!0}));try{(await L.rejectIdentity(a,c)).success&&(t("success","Identity Rejected"),b(null),j({isOpen:!1,userId:null}),f())}catch(m){t("error",m.message)}finally{d(m=>({...m,reject_id:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{isOpen:n.isOpen,isProcessing:p.reject_id,onClose:()=>j(a=>({...a,isOpen:!1})),onConfirm:a=>{n.userId&&N(n.userId,a)}}),i&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-md",onClick:()=>b(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(Se,{size:20,className:"text-emerald-500"}),"Review Identity: ",i.req.userEmail]}),e.jsx("button",{onClick:()=>b(null),children:e.jsx(J,{size:20,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-black flex items-center justify-center",children:[v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-10",children:e.jsx(I,{className:"animate-spin text-emerald-500",size:32})}),y?e.jsxs("div",{className:"text-center p-8 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-200 dark:border-red-900",children:[e.jsx(Le,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Failed to load document image."}),e.jsx("p",{className:"text-xs mt-2 opacity-70",children:"The URL may have expired or is invalid."})]}):e.jsx("img",{src:i.url,alt:"ID Document",className:"max-w-full max-h-[60vh] object-contain rounded-lg shadow-lg border border-slate-200 dark:border-slate-800",onLoad:()=>k(!1),onError:()=>{w(!0),k(!1)}})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:["User ID: ",e.jsx("span",{className:"font-mono",children:i.userId})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>j({isOpen:!0,userId:i.userId}),disabled:p.reject_id,className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>u(i.userId),disabled:p.approve_id,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[p.approve_id&&e.jsx(I,{size:16,className:"animate-spin"}),"Approve Identity"]})]})]})]})]}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"ID Verification Requests"}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):r.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending identity checks."}):e.jsx("div",{className:"space-y-4",children:r.map((a,c)=>{var m;return e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold",children:(m=a.userEmail)==null?void 0:m[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:a.userEmail}),e.jsxs("p",{className:"text-xs text-slate-500",children:["User ID: ",a.userId||a._id]})]})]}),e.jsxs("button",{onClick:()=>A(a),disabled:p[`view-${a.userId||a._id}`],className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 font-medium transition-colors flex items-center gap-2",children:[p[`view-${a.userId||a._id}`]?e.jsx(I,{size:16,className:"animate-spin"}):e.jsx(Ee,{size:16}),"Review Doc"]})]},c)})})]})},_t=({onNotify:t})=>{const[r,g]=l.useState([]),[h,x]=l.useState(!1),[i,b]=l.useState({}),[v,k]=l.useState({isOpen:!1,userId:null});l.useEffect(()=>{y()},[]);const y=async()=>{x(!0);try{const d=await q.getAll();g(d)}catch(d){console.error(d),t("error","Failed to fetch profiles")}finally{x(!1)}},w=async(d,n,j)=>{b(f=>({...f,[`prof_${d}`]:!0}));try{(await q.verifyProfile(d,n,j)).success&&(t("success",`Profile ${n}`),k({isOpen:!1,userId:null}),y())}catch(f){t("error",f.message)}finally{b(f=>({...f,[`prof_${d}`]:!1}))}},p=r.filter(d=>{var n,j;return((n=d.profileVerification)==null?void 0:n.requiresReview)&&((j=d.profileVerification)==null?void 0:j.status)==="pending"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{isOpen:v.isOpen,isProcessing:v.userId?i[`prof_${v.userId}`]:!1,onClose:()=>k(d=>({...d,isOpen:!1})),onConfirm:d=>{v.userId&&w(v.userId,"rejected",d)}}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Profile Change Reviews"}),h?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):p.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending profile reviews."}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:p.map(d=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center font-bold text-xl text-slate-500 overflow-hidden",children:d.profilePic?e.jsx("img",{src:d.profilePic,className:"w-full h-full object-cover"}):d.firstName[0]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:[d.firstName," ",d.lastName]}),e.jsx("div",{className:"text-sm text-slate-500",children:d.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k({isOpen:!0,userId:d._id||null}),disabled:i[`prof_${d._id}`],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>d._id&&w(d._id,"verified"),disabled:i[`prof_${d._id}`],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 flex items-center gap-2",children:[i[`prof_${d._id}`]?e.jsx(I,{size:16,className:"animate-spin"}):e.jsx(he,{size:16})," Approve"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Username"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.username||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Phone"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.phoneNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Passport ID"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.passportId||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Address"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.address||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Location"})," ",e.jsxs("span",{className:"font-medium dark:text-slate-200",children:[d.city||"-",", ",d.country||"-"]})]})]})]},d._id))})]})},$="https://api.quader864.ir/api/expert/admin",U=()=>({"Content-Type":"application/json",Accept:"application/json"}),D=async t=>{const r=t.headers.get("content-type");if(r&&r.includes("application/json")){const g=await t.json();if(!t.ok){if(g.results||g.details)return g;throw new Error(g.message||`API Error: ${t.status}`)}return g}else{const g=await t.text();throw console.error(`Non-JSON response from ${t.url}:`,g.substring(0,100)),new Error(`API Error: ${t.status} (Invalid Response Format)`)}},T={getAvailableExperts:async()=>{try{const t=await fetch(`${$}/available-experts`,{method:"GET",headers:U(),mode:"cors",credentials:"include"});return await D(t)}catch{return console.warn("Using fallback experts list"),{success:!0,experts:[{expertId:"EA_TREND_01",expertName:"TrendScout Pro",description:"Trend following EA",isActive:!0},{expertId:"EA_SCALP_X",expertName:"Scalp Master X",description:"High frequency scalper",isActive:!0},{expertId:"EA_GRID_V2",expertName:"Grid Logic V2",description:"Grid system with hedging",isActive:!1}]}}},addExpert:async t=>{try{const r=await fetch(`${$}/add-expert`,{method:"POST",headers:U(),mode:"cors",credentials:"include",body:JSON.stringify(t)});return await D(r)}catch(r){throw r}},searchUsers:async(t,r=1,g=20)=>{try{const h=new URLSearchParams({q:t,page:String(r),limit:String(g)}),x=await fetch(`${$}/users-search?${h.toString()}`,{method:"GET",headers:U(),mode:"cors",credentials:"include"});return await D(x)}catch(h){return console.error("User search error:",h),{success:!1,users:[],total:0}}},addUser:async t=>{try{const r=await fetch(`${$}/add-user`,{method:"POST",headers:U(),mode:"cors",credentials:"include",body:JSON.stringify(t)});return await D(r)}catch(r){throw r}},removeUser:async(t,r)=>{try{const g=await fetch(`${$}/remove-user`,{method:"POST",headers:U(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:t,expertId:r})});return await D(g)}catch(g){throw g}},updateUser:async(t,r,g)=>{try{const h=await fetch(`${$}/update-user`,{method:"POST",headers:U(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:t,expertId:r,updates:g})});return await D(h)}catch(h){throw h}},getUsers:async t=>{try{const r=new URLSearchParams;t!=null&&t.expertId&&r.append("expertId",t.expertId),t!=null&&t.licenseType&&r.append("licenseType",t.licenseType),(t==null?void 0:t.isActive)!==void 0&&r.append("isActive",String(t.isActive));const g=await fetch(`${$}/users?${r.toString()}`,{method:"GET",headers:U(),mode:"cors",credentials:"include"});return await D(g)}catch(r){throw console.error("Fetch expert users failed:",r),r}},getUserDetails:async t=>{try{const r=await fetch(`${$}/user/${encodeURIComponent(t)}`,{method:"GET",headers:U(),mode:"cors",credentials:"include"});return await D(r)}catch(r){throw r}},toggleAccess:async(t,r,g)=>{try{const h=await fetch(`${$}/toggle-access`,{method:"POST",headers:U(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:t,expertId:r,isActive:g})});return await D(h)}catch(h){throw h}},getStats:async t=>{try{const r=new URLSearchParams;t&&r.append("expertId",t);const g=await fetch(`${$}/usage-stats?${r.toString()}`,{method:"GET",headers:U(),mode:"cors",credentials:"include"});return await D(g)}catch(r){throw r}}},zt=({onNotify:t})=>{const[r,g]=l.useState([]),[h,x]=l.useState(null),[i,b]=l.useState([]),[v,k]=l.useState(!1),[y,w]=l.useState(!1),[p,d]=l.useState(!1),[n,j]=l.useState({}),[f,A]=l.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[u,N]=l.useState("add"),[a,c]=l.useState({userEmail:"",expertId:"",expertName:"",licenseType:"basic",expirationDate:"",maxAccounts:1,isActive:!0,notes:""}),[m,S]=l.useState([]),[O,G]=l.useState(""),[Z,H]=l.useState([]),[R,Q]=l.useState(!1),[X,ie]=l.useState("partial"),[ne,oe]=l.useState(null),Y=l.useRef(null),[ee,be]=l.useState("create"),[te,se]=l.useState(!1),[ue,ge]=l.useState(""),[E,B]=l.useState({expertId:"",name:"",description:"",metadata:"{}",isActive:!0}),[fe,K]=l.useState(null);l.useEffect(()=>{V()},[]);const V=async()=>{k(!0);try{const[s,o,C]=await Promise.all([T.getUsers(),T.getStats(),T.getAvailableExperts()]);g(s.users),x(o.stats),b(C.experts||[])}catch(s){console.error("Expert Data Fetch Error",s),t("error","Failed to load expert data: "+s.message)}finally{k(!1)}};l.useEffect(()=>(Y.current&&clearTimeout(Y.current),O.trim().length>=2?(Q(!0),Y.current=setTimeout(async()=>{try{const s=await T.searchUsers(O);H(s.users)}catch(s){console.error("Search error",s)}finally{Q(!1)}},400)):(H([]),Q(!1)),()=>{Y.current&&clearTimeout(Y.current)}),[O]);const $e=s=>{const o=i.find(C=>C.expertId===s);c(C=>({...C,expertId:s,expertName:o?o.expertName:C.expertName}))},Ue=s=>{m.find(o=>o.email===s.email)||S(o=>[...o,s]),G(""),H([])},De=s=>{S(o=>o.filter(C=>C.email!==s))},Te=()=>{c({userEmail:"",expertId:i.length>0?i[0].expertId:"",expertName:i.length>0?i[0].expertName:"",licenseType:"basic",expirationDate:"",maxAccounts:1,isActive:!0,notes:""}),S([]),G(""),N("add"),ie("partial"),oe(null),w(!0)},Ve=(s,o)=>{c({userEmail:s.email,expertId:o.expertId,expertName:o.expertName,licenseType:o.licenseType,expirationDate:o.expirationDate?new Date(o.expirationDate).toISOString().split("T")[0]:"",maxAccounts:o.maxAccounts||1,isActive:o.isActive,notes:""}),S([{email:s.email,firstName:s.firstName||"",lastName:s.lastName||""}]),N("edit"),oe(null),w(!0)},Fe=async s=>{s.preventDefault(),j(o=>({...o,expert_submit:!0}));try{if(u==="add"){const o=m.map(_=>({userEmail:_.email,expertId:a.expertId,expertName:a.expertName,licenseType:a.licenseType,expirationDate:a.expirationDate,maxAccounts:a.maxAccounts,notes:a.notes}));if(o.length===0)if(a.userEmail)o.push({userEmail:a.userEmail,expertId:a.expertId,expertName:a.expertName,licenseType:a.licenseType,expirationDate:a.expirationDate,maxAccounts:a.maxAccounts,notes:a.notes});else throw new Error("Please select at least one user.");const C={items:o,atomic:X==="atomic"},P=await T.addUser(C);P.results?(oe(P.results),(P.success||P.results.some(_=>_.success))&&V()):P.success&&(t("success",P.message||`Access granted to ${o.length} users.`),w(!1),V())}else{const o=await T.updateUser(a.userEmail,a.expertId,{expertName:a.expertName,licenseType:a.licenseType,expirationDate:a.expirationDate,maxAccounts:a.maxAccounts,isActive:a.isActive});o.success&&(t("success",o.message),w(!1),V())}}catch(o){t("error",o.message||"Operation failed")}finally{j(o=>({...o,expert_submit:!1}))}},Be=async(s,o,C)=>{const P=`toggle_${s}_${o}`;j(_=>({..._,[P]:!0}));try{const _=await T.toggleAccess(s,o,!C);_.success&&(t("success",_.message),V())}catch(_){t("error",_.message)}finally{j(_=>({..._,[P]:!1}))}},Je=(s,o)=>{A({isOpen:!0,title:"Remove Expert Access",message:`Are you sure you want to remove expert ${o} from user ${s}?`,isLoading:!1,onConfirm:async()=>{A(C=>({...C,isLoading:!0}));try{const C=await T.removeUser(s,o);C.success&&(t("success",C.message),V(),A(P=>({...P,isOpen:!1})))}catch(C){t("error",C.message),A(P=>({...P,isLoading:!1}))}}})},je=()=>{B({expertId:"",name:"",description:"",metadata:`{
  "category": "scalper"
}`,isActive:!0}),ge(`[
  { "expertId": "EXP_1", "name": "Expert One" },
  { "expertId": "EXP_2", "name": "Expert Two" }
]`),be("create"),se(!1),K(null),d(!0)},Ge=s=>{B({expertId:s.expertId,name:s.expertName,description:s.description||"",metadata:JSON.stringify(s.metadata||{},null,2),isActive:s.isActive!==!1}),be("edit"),se(!1),K(null),d(!0)},qe=async s=>{s.preventDefault(),K(null),j(o=>({...o,catalog_submit:!0}));try{if(te){let o=[];try{if(o=JSON.parse(ue),!Array.isArray(o))throw new Error("Input must be a JSON array")}catch{throw new Error("Invalid JSON format for batch input.")}const C=await T.addExpert({items:o});if(C.success)t("success","Batch operation successful"),d(!1),V();else if(C.details)K(C.details),t("error","Validation errors occurred in batch");else throw new Error(C.message||"Operation failed")}else{let o={};try{o=JSON.parse(E.metadata)}catch{throw new Error("Invalid JSON in Metadata field")}const C={expertId:E.expertId,name:E.name,description:E.description,metadata:o,isActive:E.isActive},P=await T.addExpert(C);if(P.success)t("success",`Expert ${ee==="create"?"created":"updated"} successfully`),d(!1),V();else if(P.details)K(P.details),t("error","Validation errors occurred");else throw new Error(P.message||"Operation failed")}}catch(o){t("error",o.message)}finally{j(o=>({...o,catalog_submit:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{isOpen:f.isOpen,title:f.title,message:f.message,isLoading:f.isLoading,onClose:()=>A(s=>({...s,isOpen:!1})),onConfirm:f.onConfirm}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Expert Access Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:je,className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg font-bold flex items-center gap-2 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(Ne,{size:18})," Manage Catalog"]}),e.jsxs("button",{onClick:Te,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold flex items-center gap-2 hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20",children:[e.jsx(Oe,{size:18})," Grant Access"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{size:18,className:"text-accent-500"})," Available Expert Catalog"]}),e.jsxs("button",{onClick:je,className:"text-xs font-bold text-accent-600 hover:underline flex items-center gap-1",children:[e.jsx(at,{size:12})," Add New"]})]}),v?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-950 animate-pulse",children:[e.jsx("div",{className:"h-5 bg-slate-200 dark:bg-slate-800 rounded w-3/4 mb-3"}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-800 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-10 bg-slate-200 dark:bg-slate-800 rounded w-full"})]},s))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.length>0?i.map(s=>e.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-950 hover:border-accent-500/50 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-900 dark:text-white",children:s.expertName}),e.jsx("span",{className:`w-2 h-2 rounded-full ${s.isActive!==!1?"bg-emerald-500":"bg-red-500"}`,title:s.isActive!==!1?"Active":"Inactive"})]}),e.jsx("p",{className:"text-xs text-slate-500 font-mono mb-2",children:s.expertId}),s.description&&e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-3 line-clamp-2",children:s.description}),e.jsx("div",{className:"flex justify-end opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("button",{onClick:()=>Ge(s),className:"text-xs font-medium text-accent-600 hover:text-accent-700 dark:hover:text-accent-400 flex items-center gap-1",children:[e.jsx(W,{size:12})," Edit"]})})]},s.expertId)):e.jsx("div",{className:"col-span-full text-center py-8 text-slate-500 text-sm",children:"No experts defined in catalog."})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Licenses"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:(h==null?void 0:h.totalUsers)||0})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Active Users"}),e.jsx("div",{className:"text-2xl font-black text-emerald-600 dark:text-emerald-400 mt-1",children:(h==null?void 0:h.activeUsers)||0})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Trades"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:((h==null?void 0:h.totalTrades)||0).toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"System Profit"}),e.jsxs("div",{className:"text-2xl font-black text-green-600 dark:text-green-400 mt-1",children:["$",((h==null?void 0:h.totalProfit)||0).toLocaleString()]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px]",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Expert System"}),e.jsx("th",{className:"px-6 py-4",children:"License"}),e.jsx("th",{className:"px-6 py-4",children:"Expires"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsx(I,{className:"animate-spin mx-auto text-emerald-600"})})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-500",children:"No active expert licenses found."})}):r.map(s=>s.experts.map((o,C)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[s.firstName," ",s.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:s.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:o.expertName}),e.jsx("div",{className:"text-xs text-slate-500 font-mono",children:o.expertId})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex px-2 py-1 rounded text-xs font-bold uppercase bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700",children:o.licenseType})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-400",children:o.expirationDate?new Date(o.expirationDate).toLocaleDateString():"Lifetime"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-bold ${o.isActive?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${o.isActive?"bg-emerald-500":"bg-red-500"}`}),o.isActive?"Active":"Suspended"]})}),e.jsxs("td",{className:"px-6 py-4 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Ve(s,o),className:"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded transition-colors",title:"Edit Access",children:e.jsx(W,{size:16})}),e.jsx("button",{onClick:()=>Be(s.email,o.expertId,o.isActive),className:`p-1.5 rounded transition-colors ${o.isActive?"text-slate-500 hover:text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/20":"text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20"}`,title:o.isActive?"Suspend":"Activate",disabled:n[`toggle_${s.email}_${o.expertId}`],children:n[`toggle_${s.email}_${o.expertId}`]?e.jsx(I,{size:16,className:"animate-spin"}):e.jsx(Re,{size:16})}),e.jsx("button",{onClick:()=>Je(s.email,o.expertId),className:"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Revoke Access",children:e.jsx(ze,{size:16})})]})]},`${s.email}-${C}`)))})]})})}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>w(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl border border-slate-200 dark:border-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900 sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:u==="add"?"Grant Expert Access":"Edit Access"}),e.jsx("button",{onClick:()=>w(!1),children:e.jsx(J,{size:20,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"})})]}),ne?e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Batch Operation Results"}),X==="atomic"&&ne.some(s=>!s.success)&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 p-4 rounded-lg mb-4 text-sm flex gap-3",children:[e.jsx(re,{className:"shrink-0",size:20}),e.jsxs("p",{children:[e.jsx("strong",{children:"Operation Failed:"})," No changes were applied because strict mode was enabled and errors occurred."]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-slate-200 dark:border-slate-800 rounded-lg divide-y divide-slate-200 dark:divide-slate-800 mb-6 custom-scrollbar",children:ne.map((s,o)=>e.jsxs("div",{className:`p-3 flex items-start justify-between gap-4 ${s.success?"bg-green-50/50 dark:bg-green-900/10":"bg-red-50/50 dark:bg-red-900/10"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-white",children:s.userEmail}),e.jsx("div",{className:"text-xs text-slate-500",children:s.expertId}),!s.success&&s.error&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:s.error})]}),e.jsx("div",{className:"shrink-0 pt-1",children:s.success?e.jsx(F,{size:18,className:"text-emerald-500"}):e.jsx(re,{size:18,className:"text-red-500"})})]},o))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>w(!1),className:"px-6 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-lg font-bold",children:"Close"})})]}):e.jsxs("form",{onSubmit:Fe,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Select Expert"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:a.expertId,onChange:s=>$e(s.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white appearance-none",disabled:u==="edit",children:[i.length===0&&e.jsx("option",{value:"",children:"Loading experts..."}),i.map(s=>e.jsxs("option",{value:s.expertId,children:[s.expertName," (",s.expertId,")"]},s.expertId)),!i.find(s=>s.expertId===a.expertId)&&a.expertId&&e.jsx("option",{value:a.expertId,children:a.expertId})]}),e.jsx(Ye,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",size:16})]})]}),u==="add"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Add Users"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:m.map(s=>e.jsxs("div",{className:"flex items-center gap-1 bg-accent-100 dark:bg-accent-900/30 text-accent-800 dark:text-accent-300 px-2 py-1 rounded-full text-xs font-medium border border-accent-200 dark:border-accent-800",children:[e.jsxs("span",{children:[s.firstName," ",s.lastName]}),e.jsx("button",{type:"button",onClick:()=>De(s.email),className:"hover:text-red-500",children:e.jsx(J,{size:12})})]},s.email))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:O,onChange:s=>G(s.target.value),className:"w-full px-3 py-2 pl-9 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"Search by name or email..."}),e.jsx(rt,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),R&&e.jsx(I,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-slate-400",size:16}),Z.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg shadow-xl max-h-60 overflow-y-auto z-20",children:Z.map(s=>e.jsxs("button",{type:"button",onClick:()=>Ue(s),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-800 border-b border-slate-100 dark:border-slate-800 last:border-0 flex flex-col",children:[e.jsxs("span",{className:"font-bold text-sm text-slate-800 dark:text-white",children:[s.firstName," ",s.lastName]}),e.jsx("span",{className:"text-xs text-slate-500",children:s.email})]},s.email))})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"User Email"}),e.jsx("input",{type:"email",disabled:!0,value:a.userEmail,className:"w-full px-3 py-2 bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-500 cursor-not-allowed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"License Type"}),e.jsxs("select",{value:a.licenseType,onChange:s=>c({...a,licenseType:s.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"}),e.jsx("option",{value:"trial",children:"Trial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Max Accounts"}),e.jsx("input",{type:"number",min:"1",value:a.maxAccounts,onChange:s=>c({...a,maxAccounts:parseInt(s.target.value)||1}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Expiration Date (Optional)"}),e.jsx("input",{type:"date",value:a.expirationDate,onChange:s=>c({...a,expirationDate:s.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),u==="add"&&m.length>1&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Batch Operation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ie("partial"),className:`flex-1 py-2 text-xs font-bold rounded-md border transition-all ${X==="partial"?"bg-white dark:bg-slate-800 border-accent-500 text-accent-600 dark:text-accent-400 shadow-sm":"border-transparent text-slate-500 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:"Partial (Default)"}),e.jsx("button",{type:"button",onClick:()=>ie("atomic"),className:`flex-1 py-2 text-xs font-bold rounded-md border transition-all ${X==="atomic"?"bg-white dark:bg-slate-800 border-accent-500 text-accent-600 dark:text-accent-400 shadow-sm":"border-transparent text-slate-500 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:"Strict (Atomic)"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2 leading-relaxed",children:X==="partial"?"Continue even if some items fail. Successful items will be added.":"All items must succeed. If any error occurs, no changes will be applied."})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:n.expert_submit,className:"px-6 py-2 bg-accent-600 text-white rounded-lg font-bold hover:bg-accent-700 transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 flex items-center gap-2",children:[n.expert_submit?e.jsx(I,{size:18,className:"animate-spin"}):e.jsx(le,{size:18}),u==="add"?"Grant Access":"Update Access"]})]})]})]})]}),p&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>d(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border border-slate-200 dark:border-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900 sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:ee==="create"?"Add New Expert":"Edit Expert"}),e.jsx("button",{onClick:()=>d(!1),children:e.jsx(J,{size:20,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"})})]}),e.jsxs("div",{className:"p-6",children:[ee==="create"&&e.jsxs("div",{className:"flex gap-2 mb-6 bg-slate-100 dark:bg-slate-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>se(!1),className:`flex-1 py-2 text-sm font-medium rounded-md transition-all ${te?"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300":"bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white"}`,children:"Single Entry"}),e.jsx("button",{onClick:()=>se(!0),className:`flex-1 py-2 text-sm font-medium rounded-md transition-all ${te?"bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:"Batch Upload"})]}),e.jsxs("form",{onSubmit:qe,className:"space-y-4",children:[fe&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 rounded-lg mb-4",children:[e.jsx("h4",{className:"text-red-700 dark:text-red-400 font-bold text-sm mb-2",children:"Validation Errors"}),e.jsx("ul",{className:"list-disc list-inside text-xs text-red-600 dark:text-red-300 space-y-1",children:fe.map((s,o)=>e.jsx("li",{children:s.message||JSON.stringify(s)},o))})]}),te?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-2",children:"JSON Array (Expert Objects)"}),e.jsx("textarea",{value:ue,onChange:s=>ge(s.target.value),className:"w-full h-64 px-4 py-3 bg-slate-50 dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white font-mono text-xs",placeholder:`[
  { "expertId": "...", "name": "..." },
  ...
]`}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Paste a JSON array of expert definitions. Each object must have at least 'expertId'."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:["Expert ID ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",required:!0,disabled:ee==="edit",value:E.expertId,onChange:s=>B({...E,expertId:s.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white disabled:opacity-60 disabled:cursor-not-allowed",placeholder:"EA_001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Name"}),e.jsx("input",{type:"text",value:E.name,onChange:s=>B({...E,name:s.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"Super Trader"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:E.description,onChange:s=>B({...E,description:s.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",rows:3,placeholder:"Short description of the expert..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Metadata (JSON)"}),e.jsx("textarea",{value:E.metadata,onChange:s=>B({...E,metadata:s.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-950 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white font-mono text-xs",rows:5,placeholder:"{}"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:E.isActive,onChange:s=>B({...E,isActive:s.target.checked}),className:"w-4 h-4 text-accent-600 rounded focus:ring-accent-500 border-gray-300"}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:"Active"})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3 border-t border-slate-100 dark:border-slate-800 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:n.catalog_submit,className:"px-6 py-2 bg-accent-600 text-white rounded-lg font-bold hover:bg-accent-700 transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 flex items-center gap-2",children:[n.catalog_submit?e.jsx(I,{size:18,className:"animate-spin"}):e.jsx(le,{size:18}),"Save Expert"]})]})]})]})]})]})]})},Zt=()=>{const{user:t,logout:r,isLoading:g,checkAuth:h}=Ce(),x=Ke(),[i,b]=l.useState("overview"),[v,k]=l.useState({show:!1,type:"success",message:""}),[y,w]=l.useState(null),[p,d]=l.useState({isOpen:!1,postId:null}),[n,j]=l.useState({}),f=(c,m)=>{k({show:!0,type:c,message:m})};l.useEffect(()=>{!g&&!t&&x("/auth/login")},[g,t,x]);const A=async()=>{await r(),x("/")},u=async c=>{if(w(c),!c.content&&!c.contentRaw)try{const m=await z.getById(c._id);m&&w(m)}catch(m){console.error("Failed to fetch full post details",m)}},N=async c=>{j(m=>({...m,[c]:!0}));try{const m=await z.approve(c);m.success&&(w(null),f("success",m.message))}catch{f("error","An error occurred")}finally{j(m=>({...m,[c]:!1}))}},a=async(c,m)=>{j(S=>({...S,[c]:!0}));try{const S=await z.reject(c,m);S.success&&(w(null),d({isOpen:!1,postId:null}),f("success",S.message))}catch{f("error","An error occurred")}finally{j(S=>({...S,[c]:!1}))}};return g?e.jsx("div",{className:"min-h-screen pt-24 flex items-center justify-center bg-slate-50 dark:bg-slate-950",children:e.jsxs("div",{className:"text-slate-600 dark:text-slate-400 font-medium animate-pulse flex items-center gap-2",children:[e.jsx(I,{className:"animate-spin"})," Loading dashboard..."]})}):t?e.jsxs("div",{className:"min-h-screen pt-24 pb-12 bg-slate-50 dark:bg-slate-950 px-4 sm:px-6 lg:px-8 transition-colors duration-500",children:[e.jsx(We,{show:v.show,type:v.type,message:v.message,onClose:()=>k(c=>({...c,show:!1}))}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>w(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white",children:["Reviewing: ",y.title]}),e.jsx("button",{onClick:()=>w(null),children:e.jsx(J,{size:20,className:"text-slate-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-slate-950",children:e.jsx(Ze,{content:y.content||y.contentRaw,title:y.title})}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{d({isOpen:!0,postId:y._id})},className:"px-4 py-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg font-bold",children:"Reject"}),e.jsx("button",{onClick:()=>N(y._id),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700",children:"Approve & Publish"})]})]})]}),e.jsx(de,{isOpen:p.isOpen,isProcessing:n[p.postId||""],onClose:()=>d(c=>({...c,isOpen:!1})),onConfirm:c=>{p.postId&&a(p.postId,c)}}),e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row gap-8",children:[e.jsx(Nt,{user:t,activeTab:i,setActiveTab:b,onLogout:A}),e.jsxs("main",{className:"flex-1 min-w-0",children:[i==="overview"&&e.jsx(kt,{user:t,onNavigate:b}),i==="profile"&&e.jsx(wt,{user:t,onNotify:f,refreshUser:h}),i==="blog"&&e.jsx(St,{user:t,onNotify:f}),i==="liked"&&e.jsx(Ct,{user:t}),i==="verification"&&e.jsx(At,{onNotify:f}),(t.role==="admin"||t.role==="moderator")&&i==="moderation"&&e.jsx(It,{onNotify:f,onViewPost:u}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[i==="users"&&e.jsx(Pt,{onNotify:f,onViewPost:u}),i==="admin_verifications"&&e.jsx(Et,{onNotify:f}),i==="admin_profiles"&&e.jsx(_t,{onNotify:f}),i==="expert_systems"&&e.jsx(zt,{onNotify:f})]})]})]})]}):null};export{Zt as default};
