import{w as L,h as l,o as e,A as je,q as ve,K as I,N as Be,U as Ne,O as Ge,V as ue,L as W,y as ke,X as G,t as qe,B as Je,z as He}from"./index-BNagajia.js";import{b as z}from"./blog-DMsYJa6l.js";import{P as X,C as ie,N as Qe,S as Xe}from"./ConfirmModal-CclFgGa5.js";import{C as Z}from"./circle-alert-VLrjnfAv.js";import{H as Ye}from"./heart-CepwWBeO.js";import{S as ye}from"./shield-BWt-idVk.js";import{U as Ke,v as M,u as q}from"./user-Dy61dxVq.js";import{C as V}from"./circle-check-big-DRp-lrv1.js";import{C as ee}from"./clock-BafyxmHM.js";import{A as we}from"./arrow-left-PU8TkJSw.js";import{L as Se}from"./lock-BRjXG1rg.js";import{S as ne}from"./save-D2w2tZBR.js";import{E as We}from"./eye-off-D8nM-mKX.js";import{E as Ce}from"./eye-CGwuSLnJ.js";import{U as Pe}from"./upload-DdB3Ybkx.js";import{T as Ie}from"./trash-2-Bb3UOPaz.js";import{T as Ae}from"./triangle-alert-Dy_BZIrw.js";import{C as oe}from"./check-xMz3vKCC.js";import{P as Ze}from"./plus-VvZXic5K.js";import{S as es}from"./search-CQktDQIK.js";import{C as ss}from"./credit-card-Bt64NQTF.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ee=L("badge-check",ts);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],_e=L("cpu",as);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],ls=L("file-check",rs);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],is=L("file-exclamation-point",ds);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ce=L("file-text",ns);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],cs=L("hash",os);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]],ge=L("library",xs);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],fe=L("map-pin",ms);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ps=L("phone",hs);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],ze=L("power",bs);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],gs=L("shield-check",us),se=({isOpen:s,onClose:t,onConfirm:u,isProcessing:m=!1})=>{const[x,n]=l.useState("");return s?e.jsx(je,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:m?void 0:t}),e.jsxs(ve.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-sm w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full",children:e.jsx(Z,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Reject Post"})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-4 text-sm",children:"Please provide a reason for rejection. This will be visible to the author."}),e.jsx("textarea",{value:x,onChange:h=>n(h.target.value),disabled:m,className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-red-500 outline-none text-slate-900 dark:text-white mb-6 resize-none disabled:opacity-50",rows:3,placeholder:"Reason for rejection..."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:t,disabled:m,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:()=>u(x),disabled:!x.trim()||m,className:"px-6 py-2 bg-red-600 text-white hover:bg-red-700 rounded-lg font-medium transition-colors shadow-lg shadow-red-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:m?e.jsx(I,{size:18,className:"animate-spin"}):"Reject Post"})]})]})]})}):null},fs=({user:s,activeTab:t,setActiveTab:u,onLogout:m})=>{const x=({id:n,label:h,icon:v})=>e.jsxs("button",{onClick:()=>u(n),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${t===n?"bg-accent-600 text-white shadow-md shadow-accent-600/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(v,{size:18}),h]});return e.jsx("aside",{className:"w-full md:w-64 shrink-0",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 sticky top-24",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-xl overflow-hidden relative group shrink-0",children:s.profilePic?e.jsx("img",{src:s.profilePic,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("span",{children:s.firstName[0]})}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white truncate",title:`${s.firstName} ${s.lastName}`,children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-xs text-slate-500 truncate",title:s.username?`@${s.username}`:s.email,children:s.username?`@${s.username}`:s.email})]})]}),e.jsxs("nav",{className:"space-y-1",children:[e.jsx(x,{id:"overview",label:"Overview",icon:Be}),e.jsx(x,{id:"profile",label:"My Profile",icon:Ne}),e.jsx(x,{id:"blog",label:"My Posts",icon:ce}),e.jsx(x,{id:"liked",label:"Liked Posts",icon:Ye}),e.jsx(x,{id:"verification",label:"Verification",icon:gs}),(s.role==="admin"||s.role==="moderator")&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-800"}),e.jsx("h4",{className:"px-4 text-xs font-bold text-slate-400 uppercase mb-2",children:"Staff Area"}),e.jsx(x,{id:"moderation",label:"Moderation Queue",icon:ye})]}),s.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{id:"admin_verifications",label:"ID Verification",icon:ls}),e.jsx(x,{id:"admin_profiles",label:"Profile Reviews",icon:Ee}),e.jsx(x,{id:"expert_systems",label:"Expert Access",icon:_e}),e.jsx(x,{id:"users",label:"User Management",icon:Ke})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-slate-100 dark:border-slate-800",children:e.jsxs("button",{onClick:m,className:"w-full flex items-center gap-3 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[e.jsx(Ge,{size:18})," Sign Out"]})})]})})},js=({user:s,onNavigate:t})=>{const[u,m]=l.useState(0),[x,n]=l.useState(null),[h,v]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const[y,w]=await Promise.all([z.getMyPosts(s._id||""),M.getStatus()]);m(y.length),n(w)}catch(y){console.error("Overview fetch error",y)}finally{v(!1)}})()},[s]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Dashboard Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg",children:e.jsx(ye,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"Account Status"})]}),h?e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsx("div",{className:"h-12 bg-slate-100 dark:bg-slate-800/50 rounded-lg animate-pulse"}),e.jsx("div",{className:"h-12 bg-slate-100 dark:bg-slate-800/50 rounded-lg animate-pulse"})]}):e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 1 (Email)"}),x!=null&&x.emailVerified?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(V,{size:12})," Verified"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800",children:[e.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Level 2 (Identity)"}),x!=null&&x.identityVerified||(x==null?void 0:x.status)===ue.FULLY_VERIFIED?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full",children:[e.jsx(V,{size:12})," Verified"]}):(x==null?void 0:x.identityStatus)==="pending"||(x==null?void 0:x.status)===ue.PENDING?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs font-bold text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 px-2 py-1 rounded-full",children:[e.jsx(ee,{size:12})," Pending"]}):e.jsx("span",{className:"flex items-center gap-1.5 text-xs font-bold text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full",children:"Unverified"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg",children:e.jsx(ce,{size:20})}),e.jsx("h3",{className:"font-semibold text-slate-700 dark:text-slate-300",children:"My Contributions"})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 w-20 bg-slate-100 dark:bg-slate-800/50 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-32 bg-slate-100 dark:bg-slate-800/50 rounded animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-1",children:u}),e.jsx("p",{className:"text-sm text-slate-500",children:"Total posts created"})]}),e.jsxs(W,{to:"/blog/editor",className:"mt-4 inline-flex items-center text-sm text-accent-600 hover:underline",children:["Write new post ",e.jsx(we,{className:"rotate-180 ml-1",size:14})]})]})]}),!h&&!s.username&&!s.phoneNumber&&e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 shadow-lg text-white flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-1",children:"Complete your Profile"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"Add your username and details to get verified faster."})]}),e.jsx("button",{onClick:()=>t("profile"),className:"px-6 py-2 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-50 transition-colors shadow-md whitespace-nowrap",children:"Update Profile"})]})]})},de=({label:s,value:t,onChange:u,show:m,toggleShow:x})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:s}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Se,{className:"h-5 w-5 text-slate-400"})}),e.jsx("input",{type:m?"text":"password",value:t,onChange:u,className:"block w-full pl-10 pr-10 py-2.5 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500 dark:text-white text-slate-900 transition-colors",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:x,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:m?e.jsx(We,{className:"h-5 w-5"}):e.jsx(Ce,{className:"h-5 w-5"})})]})]}),vs=({isOpen:s,onClose:t,onSuccess:u})=>{const{changePassword:m}=ke(),[x,n]=l.useState(""),[h,v]=l.useState(""),[k,y]=l.useState(""),[w,p]=l.useState(!1),[d,o]=l.useState(!1),[j,f]=l.useState(!1),[S,b]=l.useState(""),[C,r]=l.useState(!1);if(!s)return null;const i=async c=>{if(c.preventDefault(),b(""),console.log("[ChangePassword] Submitting form..."),h.length<8){b("New password must be at least 8 characters long.");return}if(h!==k){b("New passwords do not match.");return}if(x===h){b("New password must be different from current password.");return}r(!0);try{console.log("[ChangePassword] Calling changePassword API...");const N=await m(x,h);console.log("[ChangePassword] API Result:",N),r(!1),N.success?(u(),t(),n(""),v(""),y("")):(console.error("[ChangePassword] API Error:",N.message),b(N.message))}catch(N){console.error("[ChangePassword] Unexpected error:",N),r(!1),b("An unexpected error occurred.")}};return e.jsx(je,{children:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:t}),e.jsxs(ve.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-md w-full border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Se,{size:20,className:"text-accent-600"})," Change Password"]}),e.jsx("button",{onClick:t,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors",children:e.jsx(G,{size:20})})]}),S&&e.jsxs("div",{className:"mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 flex items-start gap-3",children:[e.jsx(Z,{className:"text-red-600 dark:text-red-400 shrink-0",size:20}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:S})]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsx(de,{label:"Current Password",value:x,onChange:c=>n(c.target.value),show:w,toggleShow:()=>p(!w)}),e.jsx(de,{label:"New Password",value:h,onChange:c=>v(c.target.value),show:d,toggleShow:()=>o(!d)}),e.jsx(de,{label:"Confirm New Password",value:k,onChange:c=>y(c.target.value),show:j,toggleShow:()=>f(!j)}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:C,className:"px-6 py-2 bg-accent-600 text-white hover:bg-accent-700 rounded-lg font-medium transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 disabled:cursor-not-allowed flex items-center gap-2",children:[C?e.jsx(I,{className:"animate-spin",size:18}):e.jsx(ne,{size:18}),"Update Password"]})]})]})]})]})})},Ns=({user:s,onNotify:t,refreshUser:u})=>{var S,b,C,r;const[m,x]=l.useState(!1),[n,h]=l.useState({}),[v,k]=l.useState({}),[y,w]=l.useState(!0),[p,d]=l.useState(!1),o=l.useRef(null);l.useEffect(()=>{h({username:s.username||"",phoneNumber:s.phoneNumber||"",passportId:s.passportId||"",address:s.address||"",country:s.country||"",city:s.city||""});const i=setTimeout(()=>w(!1),300);return()=>clearTimeout(i)},[s,m]);const j=async i=>{if(i.target.files&&i.target.files[0]){const c=i.target.files[0];k(N=>({...N,avatar:!0}));try{const N=await q.uploadProfilePic(c);N.success&&(t("success",N.message),await u())}catch(N){t("error",N.message)}finally{k(N=>({...N,avatar:!1}))}}},f=async i=>{i.preventDefault(),k(c=>({...c,update:!0}));try{(await q.updateProfile(n)).success&&(t("success","Profile updated successfully"),x(!1),await u())}catch(c){let N=c.message;const E=N.toLowerCase();(E.includes("duplicate")||E.includes("already exists"))&&(N="This information is already in use by another account."),t("error",N)}finally{k(c=>({...c,update:!1}))}};return y?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"h-8 w-40 bg-slate-200 dark:bg-slate-800 rounded animate-pulse"})}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-8 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 mb-8 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-200 dark:bg-slate-800 animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-6 w-1/3 bg-slate-200 dark:bg-slate-800 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-1/4 bg-slate-200 dark:bg-slate-800 rounded animate-pulse"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsx("div",{className:"h-40 bg-slate-100 dark:bg-slate-800/50 rounded-xl animate-pulse"}),e.jsx("div",{className:"h-40 bg-slate-100 dark:bg-slate-800/50 rounded-xl animate-pulse"})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(vs,{isOpen:p,onClose:()=>d(!1),onSuccess:()=>t("success","Password updated successfully")}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Profile"}),!m&&e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(X,{size:16})," Edit Profile"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-8 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-8 mb-8 pb-8 border-b border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400 flex items-center justify-center font-bold text-4xl border-4 border-slate-50 dark:border-slate-800 overflow-hidden",children:s.profilePic?e.jsx("img",{src:s.profilePic,alt:"Profile",className:"w-full h-full object-cover"}):s.firstName[0]}),e.jsx("input",{type:"file",ref:o,className:"hidden",accept:"image/png, image/jpeg",onChange:j}),e.jsx("button",{onClick:()=>{var i;return(i=o.current)==null?void 0:i.click()},disabled:v.avatar,className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer disabled:cursor-wait",children:v.avatar?e.jsx(I,{className:"animate-spin text-white"}):e.jsx(Pe,{className:"text-white",size:24})})]}),e.jsxs("div",{className:"text-center md:text-left space-y-2 flex-1",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 justify-center md:justify-start",children:[e.jsxs("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[s.firstName," ",s.lastName]}),((S=s.profileVerification)==null?void 0:S.status)==="verified"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-bold rounded-full border border-blue-200 dark:border-blue-800",children:[e.jsx(Ee,{size:12})," Verified Profile"]}),((b=s.profileVerification)==null?void 0:b.status)==="pending"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs font-bold rounded-full border border-yellow-200 dark:border-yellow-800",children:[e.jsx(ee,{size:12})," Pending Review"]}),((C=s.profileVerification)==null?void 0:C.status)==="rejected"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-bold rounded-full border border-red-200 dark:border-red-800",title:s.profileVerification.rejectionReason||"Profile rejected",children:[e.jsx(G,{size:12})," Rejected"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 text-sm text-slate-500 dark:text-slate-400",children:[s.username&&e.jsxs("span",{className:"text-accent-600 dark:text-accent-400 font-medium",children:["@",s.username]}),s.city&&s.country&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{size:14})," ",s.city,", ",s.country]})]}),((r=s.profileVerification)==null?void 0:r.status)==="rejected"&&s.profileVerification.rejectionReason&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-600 dark:text-red-400 mt-2 text-left",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",s.profileVerification.rejectionReason]})]})]}),m?e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Username"}),e.jsx("input",{type:"text",value:n.username||"",onChange:i=>h({...n,username:i.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"@username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Phone Number"}),e.jsx("input",{type:"text",value:n.phoneNumber||"",onChange:i=>h({...n,phoneNumber:i.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Passport ID"}),e.jsx("input",{type:"text",value:n.passportId||"",onChange:i=>h({...n,passportId:i.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Address"}),e.jsx("input",{type:"text",value:n.address||"",onChange:i=>h({...n,address:i.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Country"}),e.jsx("input",{type:"text",value:n.country||"",onChange:i=>h({...n,country:i.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"City"}),e.jsx("input",{type:"text",value:n.city||"",onChange:i=>h({...n,city:i.target.value}),className:"w-full px-4 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-900/30 rounded-lg text-sm text-yellow-800 dark:text-yellow-400 flex gap-3",children:[e.jsx(is,{className:"shrink-0",size:20}),e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"}),' Updating sensitive profile information (Passport ID, Address, Phone) will require re-verification by our administrators. Your profile status will be set to "Pending Review".']})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),h({...s})},className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:v.update,className:"px-6 py-2 bg-accent-600 text-white hover:bg-accent-700 rounded-lg font-medium transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[v.update?e.jsx(I,{className:"animate-spin",size:18}):e.jsx(ne,{size:18}),"Save Changes"]})]})]})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950 p-6 rounded-xl border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2 mb-4",children:"Contact Info"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(qe,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Email"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:s.email})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ps,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Phone"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:s.phoneNumber||"Not set"})]})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-950 p-6 rounded-xl border border-slate-100 dark:border-slate-800 space-y-4",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white border-b border-slate-200 dark:border-slate-800 pb-2 mb-4",children:"Identity & Location"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Address"}),e.jsxs("span",{className:"text-slate-700 dark:text-slate-300",children:[s.address?s.address:"Not set",s.city&&`, ${s.city}`,s.country&&`, ${s.country}`]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(cs,{className:"text-slate-400 mt-0.5",size:18}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs text-slate-500 uppercase font-bold",children:"Passport / National ID"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:s.passportId?`${s.passportId.substring(0,2)}${"*".repeat(Math.max(0,s.passportId.length-4))}${s.passportId.slice(-2)}`:"Not set"})]})]})]})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Security Settings"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between p-4 bg-slate-50 dark:bg-slate-950 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 sm:mb-0",children:[e.jsx("div",{className:"p-2 bg-white dark:bg-slate-900 rounded-full border border-slate-200 dark:border-slate-800 text-slate-500",children:e.jsx(ze,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:"Password"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Last changed: Never"})]})]}),e.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors shadow-sm",children:"Change Password"})]})]})]})]})},ks=({user:s,onNotify:t})=>{const[u,m]=l.useState([]),[x,n]=l.useState(!0),[h,v]=l.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[k,y]=l.useState({});l.useEffect(()=>{s._id&&z.getMyPosts(s._id).then(p=>{m(p),n(!1)})},[s]);const w=p=>{v({isOpen:!0,title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",isLoading:!1,onConfirm:async()=>{v(d=>({...d,isLoading:!0})),y(d=>({...d,[p]:!0}));try{const d=await z.delete(p);d.success?(t("success",d.message),m(o=>o.filter(j=>j._id!==p)),v(o=>({...o,isOpen:!1}))):(t("error",d.message),v(o=>({...o,isLoading:!1})))}catch{t("error","Failed to delete post"),v(o=>({...o,isLoading:!1}))}finally{y(d=>({...d,[p]:!1}))}}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{isOpen:h.isOpen,title:h.title,message:h.message,isLoading:h.isLoading,onClose:()=>v(p=>({...p,isOpen:!1})),onConfirm:h.onConfirm}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"My Posts"}),e.jsxs(W,{to:"/blog/editor",className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(X,{size:16})," New Post"]})]}),x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):u.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:e.jsx("p",{className:"text-slate-500",children:"You haven't written any posts yet."})}):e.jsx("div",{className:"space-y-4",children:u.map(p=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:p.title}),e.jsxs("div",{className:"flex gap-2 text-xs mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded capitalize ${p.visibility==="public"?"bg-green-100 text-green-700":p.visibility==="pending"?"bg-yellow-100 text-yellow-700":p.visibility==="rejected"?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"}`,children:p.visibility}),e.jsx("span",{className:"text-slate-400",children:new Date(p.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{to:`/blog/editor/${p._id}`,className:"p-2 text-slate-500 hover:text-accent-600 hover:bg-slate-100 dark:hover:bg-slate-800 rounded transition-colors",children:e.jsx(X,{size:18})}),e.jsx("button",{onClick:()=>w(p._id),className:"p-2 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",children:e.jsx(Ie,{size:18})})]})]},p._id))})]})},ys=({user:s})=>{const[t,u]=l.useState([]),[m,x]=l.useState(!0);return l.useEffect(()=>{(async()=>{try{const h=await z.getAllPublic(),v=String(s._id||""),k=String(s.user_id||""),y=new Set;Array.isArray(s.likedPosts)&&s.likedPosts.forEach(p=>{const d=typeof p=="object"&&p?p._id:p;d&&y.add(String(d))});const w=h.filter(p=>{const d=Array.isArray(p.likedBy)&&p.likedBy.some(j=>{const f=typeof j=="object"&&j?j._id||j.user_id:j,S=String(f);return v&&S===v||k&&S===k}),o=y.has(String(p._id));return d||o});u(w)}catch(h){console.error(h)}finally{x(!1)}})()},[s]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Liked Posts"}),m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):t.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"You haven't liked any posts yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.map(n=>e.jsxs(W,{to:`/blog/${n.slug}`,className:"group bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden hover:shadow-lg transition-all",children:[e.jsxs("div",{className:"h-48 overflow-hidden relative",children:[n.coverImageUrl?e.jsx("img",{src:n.coverImageUrl,alt:n.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}):e.jsx("div",{className:"w-full h-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-400",children:e.jsx(ce,{size:48})}),e.jsx("div",{className:"absolute top-2 right-2 bg-white/90 dark:bg-black/80 backdrop-blur px-2 py-1 rounded text-xs font-bold shadow-sm",children:new Date(n.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-900 dark:text-white mb-2 line-clamp-1 group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors",children:n.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:n.summary})]})]},n._id))})]})},ws=({onNotify:s})=>{const[t,u]=l.useState(null),[m,x]=l.useState(!1),[n,h]=l.useState(!1),[v,k]=l.useState(""),[y,w]=l.useState(null),[p,d]=l.useState({});l.useEffect(()=>{(async()=>{x(!0);try{const C=await M.getStatus();u(C)}catch(C){console.error(C)}finally{x(!1)}})()},[]);const o=async()=>{d(b=>({...b,otp:!0}));try{const b=await M.sendEmailOtp();b.success&&(h(!0),s("success",b.message))}catch(b){s("error",b.message)}finally{d(b=>({...b,otp:!1}))}},j=async()=>{d(b=>({...b,otp_confirm:!0}));try{const b=await M.confirmEmailOtp(v);if(b.success){s("success",b.message);const C=await M.getStatus();u(C),h(!1),k("")}}catch(b){s("error",b.message)}finally{d(b=>({...b,otp_confirm:!1}))}},f=b=>{if(b.target.files&&b.target.files[0]){const C=b.target.files[0];if(C.size>5*1024*1024){s("error","File size exceeds 5MB limit.");return}if(!["image/jpeg","image/png"].includes(C.type)){s("error","Only JPG and PNG allowed.");return}w(C)}},S=async()=>{if(y){d(b=>({...b,upload:!0}));try{const b=await M.uploadIdentity(y);if(b.success){s("success",b.message),w(null);const C=await M.getStatus();u(C)}}catch(b){s("error",b.message)}finally{d(b=>({...b,upload:!1}))}}};return m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin"})}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Account Verification"}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${t!=null&&t.emailVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(t==null?void 0:t.emailVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(V,{className:"text-green-500",size:24})}),e.jsx("h3",{className:"font-bold text-lg mb-2 dark:text-white",children:"Level 1: Email Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-6",children:"Required for basic commenting and posting."}),t!=null&&t.emailVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(V,{size:16})," Verified"]}):e.jsx("div",{className:"space-y-4 max-w-sm",children:n?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter OTP",className:"flex-1 px-4 py-2 bg-slate-50 dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg outline-none",value:v,onChange:b=>k(b.target.value)}),e.jsx("button",{onClick:j,disabled:p.otp_confirm,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:p.otp_confirm?e.jsx(I,{className:"animate-spin"}):"Confirm"})]}):e.jsx("button",{onClick:o,disabled:p.otp,className:"px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50",children:p.otp?e.jsx(I,{className:"animate-spin"}):"Send Verification Code"})})]}),e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-6 rounded-xl border ${t!=null&&t.identityVerified?"border-green-200 dark:border-green-900/50":"border-slate-200 dark:border-slate-800"} relative overflow-hidden`,children:[(t==null?void 0:t.identityVerified)&&e.jsx("div",{className:"absolute top-0 right-0 p-4",children:e.jsx(V,{className:"text-green-500",size:24})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"Level 2: Identity Verification"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Required for advanced features and badge."})]}),t!=null&&t.identityVerified?e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full text-sm font-bold",children:[e.jsx(V,{size:16})," Verified"]}):(t==null?void 0:t.identityStatus)==="pending"?e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-100 dark:border-yellow-900/30 rounded-lg text-yellow-800 dark:text-yellow-400 flex items-start gap-3",children:[e.jsx(ee,{className:"shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:"Under Review"}),e.jsx("p",{className:"text-xs mt-1 opacity-90",children:"Your document has been uploaded and is waiting for administrator approval."})]})]})}):e.jsxs("div",{className:"space-y-4 max-w-sm",children:[(t==null?void 0:t.rejectionReason)&&e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-lg text-red-800 dark:text-red-400 mb-4",children:[e.jsxs("p",{className:"font-bold text-sm flex items-center gap-2",children:[e.jsx(Ae,{size:16})," Application Rejected"]}),e.jsxs("p",{className:"text-xs mt-1",children:["Reason: ",t.rejectionReason]})]}),e.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-6 text-center hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors relative",children:[e.jsx("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:"image/jpeg,image/png",onChange:f}),e.jsx(Pe,{className:"mx-auto text-slate-400 mb-2",size:24}),e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:y?y.name:"Click to upload ID (JPG/PNG)"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Max 5MB"})]}),y&&e.jsx("button",{onClick:S,disabled:p.upload,className:"w-full px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:p.upload?e.jsx(I,{className:"animate-spin",size:18}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:18})," Submit Document"]})})]})]})]})},Ss=({onNotify:s,onViewPost:t})=>{const[u,m]=l.useState([]),[x,n]=l.useState(!0),[h,v]=l.useState({}),[k,y]=l.useState({isOpen:!1,postId:null});l.useEffect(()=>{w()},[]);const w=async()=>{n(!0);try{const o=await z.getModerationPosts();m(o)}catch(o){console.error(o),s("error","Failed to fetch moderation queue")}finally{n(!1)}},p=async o=>{v(j=>({...j,[o]:!0}));try{const j=await z.approve(o);j.success&&(m(f=>f.filter(S=>S._id!==o)),s("success",j.message))}catch{s("error","An error occurred")}finally{v(j=>({...j,[o]:!1}))}},d=async(o,j)=>{v(f=>({...f,[o]:!0}));try{const f=await z.reject(o,j);f.success&&(m(S=>S.filter(b=>b._id!==o)),y({isOpen:!1,postId:null}),s("success",f.message))}catch{s("error","An error occurred")}finally{v(f=>({...f,[o]:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{isOpen:k.isOpen,isProcessing:h[k.postId||""],onClose:()=>y(o=>({...o,isOpen:!1})),onConfirm:o=>{k.postId&&d(k.postId,o)}}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Moderation Queue"}),x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):u.length===0?e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800 text-slate-500",children:[e.jsx(V,{className:"mx-auto mb-2 text-green-500",size:32}),e.jsx("p",{children:"All caught up! No pending posts."})]}):e.jsx("div",{className:"space-y-4",children:u.map(o=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-1",children:o.title}),e.jsxs("p",{className:"text-sm text-slate-500",children:["By ",o.authorId&&typeof o.authorId=="object"?`${o.authorId.firstName} ${o.authorId.lastName}`:"Unknown"," • ",new Date(o.createdAt).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase ${o.visibility==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:o.visibility})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm mb-6 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:o.summary}),e.jsxs("div",{className:"flex gap-3 justify-end border-t border-slate-100 dark:border-slate-800 pt-4",children:[e.jsx("button",{onClick:()=>t(o),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors text-sm",children:"Preview Content"}),e.jsx("button",{onClick:()=>y({isOpen:!0,postId:o._id}),disabled:h[o._id],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors text-sm",children:"Reject"}),e.jsxs("button",{onClick:()=>p(o._id),disabled:h[o._id],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 text-sm flex items-center gap-2",children:[h[o._id]?e.jsx(I,{className:"animate-spin",size:16}):e.jsx(oe,{size:16})," Approve"]})]})]},o._id))})]})},Cs=({onNotify:s,onViewPost:t})=>{const[u,m]=l.useState([]),[x,n]=l.useState(!1),[h,v]=l.useState(null),[k,y]=l.useState({public:[],pending:[],rejected:[]}),[w,p]=l.useState(!1),[d,o]=l.useState({}),[j,f]=l.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});l.useEffect(()=>{S()},[]);const S=async()=>{n(!0);try{const r=await q.getAll();m(r)}catch(r){console.error(r),s("error","Failed to load users")}finally{n(!1)}},b=(r,i)=>{f({isOpen:!0,title:"Change User Role",message:`Are you sure you want to change this user's role to ${i}?`,isLoading:!1,onConfirm:async()=>{f(c=>({...c,isLoading:!0})),o(c=>({...c,[`role-${r}`]:!0}));try{const c=await q.updateRole(r,i);c.success?(s("success",c.message),m(N=>N.map(E=>E._id===r?{...E,role:i}:E)),f(N=>({...N,isOpen:!1}))):(s("error",c.message),f(N=>({...N,isLoading:!1})))}catch(c){s("error",c.message||"Failed to update role"),f(N=>({...N,isLoading:!1}))}finally{o(c=>({...c,[`role-${r}`]:!1}))}}})},C=async r=>{v(r),p(!0);try{const[i,c]=await Promise.all([z.getAllPublic(),z.getModerationPosts()]),N=R=>{const H=typeof R.authorId=="object"&&R.authorId?R.authorId._id:R.authorId;return String(H)===String(r._id)},E=i.filter(N),F=c.filter(N),Y=F.filter(R=>R.visibility==="pending"),J=F.filter(R=>R.visibility==="rejected");y({public:E,pending:Y,rejected:J})}catch(i){console.error("Error inspecting user",i),s("error","Failed to load user posts")}finally{p(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{isOpen:j.isOpen,title:j.title,message:j.message,isLoading:j.isLoading,onClose:()=>f(r=>({...r,isOpen:!1})),onConfirm:j.onConfirm}),h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>v(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(we,{size:20,className:"text-slate-500"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[h.firstName," ",h.lastName]}),e.jsxs("div",{className:"flex gap-2 text-sm text-slate-500",children:[e.jsx("span",{children:h.email}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"capitalize",children:h.role})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Public Posts"}),e.jsx("div",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:k.public.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Pending Review"}),e.jsx("div",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-500",children:k.pending.length})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("h3",{className:"font-bold text-slate-500 uppercase text-xs mb-2",children:"Rejected"}),e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-500",children:k.rejected.length})]})]}),k.public.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 font-bold border-b border-slate-200 dark:border-slate-800",children:"Recent Public Posts"}),e.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:k.public.map(r=>e.jsxs("button",{onClick:()=>t(r),className:"w-full text-left p-4 hover:bg-slate-50 dark:hover:bg-slate-800/30 flex justify-between items-center group",children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-white group-hover:text-accent-600 transition-colors",children:r.title}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(r.createdAt).toLocaleDateString()})]},r._id))})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"User Management"}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Role"}),e.jsx("th",{className:"px-6 py-4",children:"Joined"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center",children:e.jsx(I,{className:"animate-spin mx-auto"})})}):u.map(r=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[r.firstName," ",r.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:r.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("select",{value:r.role||"user",onChange:i=>b(r._id,i.target.value),disabled:d[`role-${r._id}`],className:"bg-slate-100 dark:bg-slate-950 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-xs font-bold uppercase text-slate-900 dark:text-slate-300 outline-none focus:ring-2 focus:ring-accent-500",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"moderator",children:"Moderator"}),e.jsx("option",{value:"admin",children:"Admin"})]}),d[`role-${r._id}`]&&e.jsx(I,{className:"animate-spin inline ml-2",size:12})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-500",children:r.createdAt?new Date(r.createdAt).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>C(r),className:"text-accent-600 hover:underline text-sm font-medium",children:"Inspect"})})]},r._id))})]})})]})]})},Ps=({onNotify:s})=>{const[t,u]=l.useState([]),[m,x]=l.useState(!1),[n,h]=l.useState(null),[v,k]=l.useState(!1),[y,w]=l.useState(!1),[p,d]=l.useState({}),[o,j]=l.useState({isOpen:!1,userId:null});l.useEffect(()=>{f()},[]);const f=async()=>{x(!0);try{const r=await M.getPendingRequests();u(r)}catch(r){console.error(r),s("error","Failed to fetch verifications")}finally{x(!1)}},S=async r=>{const i=r.userId||r._id;if(!i){s("error","Invalid User ID");return}d(c=>({...c,[`view-${i}`]:!0})),w(!1),k(!0);try{const c=await M.getPresignedUrl(i);h({req:r,url:c.url,userId:i})}catch(c){s("error",c.message),k(!1)}finally{d(c=>({...c,[`view-${i}`]:!1}))}},b=async r=>{d(i=>({...i,approve_id:!0}));try{(await M.approveIdentity(r)).success&&(s("success","Identity Approved"),h(null),f())}catch(i){s("error",i.message)}finally{d(i=>({...i,approve_id:!1}))}},C=async(r,i)=>{d(c=>({...c,reject_id:!0}));try{(await M.rejectIdentity(r,i)).success&&(s("success","Identity Rejected"),h(null),j({isOpen:!1,userId:null}),f())}catch(c){s("error",c.message)}finally{d(c=>({...c,reject_id:!1}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{isOpen:o.isOpen,isProcessing:p.reject_id,onClose:()=>j(r=>({...r,isOpen:!1})),onConfirm:r=>{o.userId&&C(o.userId,r)}}),n&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/90 backdrop-blur-md",onClick:()=>h(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{size:20,className:"text-emerald-500"}),"Review Identity: ",n.req.userEmail]}),e.jsx("button",{onClick:()=>h(null),children:e.jsx(G,{size:20,className:"text-slate-500"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-black flex items-center justify-center",children:[v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 z-10",children:e.jsx(I,{className:"animate-spin text-emerald-500",size:32})}),y?e.jsxs("div",{className:"text-center p-8 text-red-500 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-200 dark:border-red-900",children:[e.jsx(Ae,{size:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Failed to load document image."}),e.jsx("p",{className:"text-xs mt-2 opacity-70",children:"The URL may have expired or is invalid."})]}):e.jsx("img",{src:n.url,alt:"ID Document",className:"max-w-full max-h-[60vh] object-contain rounded-lg shadow-lg border border-slate-200 dark:border-slate-800",onLoad:()=>k(!1),onError:()=>{w(!0),k(!1)}})]}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:["User ID: ",e.jsx("span",{className:"font-mono",children:n.userId})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>j({isOpen:!0,userId:n.userId}),disabled:p.reject_id,className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>b(n.userId),disabled:p.approve_id,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 disabled:opacity-70 disabled:cursor-wait flex items-center gap-2",children:[p.approve_id&&e.jsx(I,{size:16,className:"animate-spin"}),"Approve Identity"]})]})]})]})]}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"ID Verification Requests"}),m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):t.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending identity checks."}):e.jsx("div",{className:"space-y-4",children:t.map((r,i)=>{var c;return e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 flex items-center justify-center font-bold",children:(c=r.userEmail)==null?void 0:c[0].toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:r.userEmail}),e.jsxs("p",{className:"text-xs text-slate-500",children:["User ID: ",r.userId||r._id]})]})]}),e.jsxs("button",{onClick:()=>S(r),disabled:p[`view-${r.userId||r._id}`],className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 font-medium transition-colors flex items-center gap-2",children:[p[`view-${r.userId||r._id}`]?e.jsx(I,{size:16,className:"animate-spin"}):e.jsx(Ce,{size:16}),"Review Doc"]})]},i)})})]})},Is=({onNotify:s})=>{const[t,u]=l.useState([]),[m,x]=l.useState(!1),[n,h]=l.useState({}),[v,k]=l.useState({isOpen:!1,userId:null});l.useEffect(()=>{y()},[]);const y=async()=>{x(!0);try{const d=await q.getAll();u(d)}catch(d){console.error(d),s("error","Failed to fetch profiles")}finally{x(!1)}},w=async(d,o,j)=>{h(f=>({...f,[`prof_${d}`]:!0}));try{(await q.verifyProfile(d,o,j)).success&&(s("success",`Profile ${o}`),k({isOpen:!1,userId:null}),y())}catch(f){s("error",f.message)}finally{h(f=>({...f,[`prof_${d}`]:!1}))}},p=t.filter(d=>{var o,j;return((o=d.profileVerification)==null?void 0:o.requiresReview)&&((j=d.profileVerification)==null?void 0:j.status)==="pending"});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{isOpen:v.isOpen,isProcessing:v.userId?n[`prof_${v.userId}`]:!1,onClose:()=>k(d=>({...d,isOpen:!1})),onConfirm:d=>{v.userId&&w(v.userId,"rejected",d)}}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Profile Change Reviews"}),m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(I,{className:"animate-spin text-accent-600"})}):p.length===0?e.jsx("div",{className:"text-center py-12 text-slate-500 bg-white dark:bg-slate-900 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:"No pending profile reviews."}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:p.map(d=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center font-bold text-xl text-slate-500 overflow-hidden",children:d.profilePic?e.jsx("img",{src:d.profilePic,className:"w-full h-full object-cover"}):d.firstName[0]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white",children:[d.firstName," ",d.lastName]}),e.jsx("div",{className:"text-sm text-slate-500",children:d.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k({isOpen:!0,userId:d._id||null}),disabled:n[`prof_${d._id}`],className:"px-4 py-2 bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400 rounded-lg font-bold hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:"Reject"}),e.jsxs("button",{onClick:()=>d._id&&w(d._id,"verified"),disabled:n[`prof_${d._id}`],className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20 flex items-center gap-2",children:[n[`prof_${d._id}`]?e.jsx(I,{size:16,className:"animate-spin"}):e.jsx(oe,{size:16})," Approve"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-slate-50 dark:bg-slate-950 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Username"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.username||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Phone"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.phoneNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Passport ID"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.passportId||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Address"})," ",e.jsx("span",{className:"font-medium dark:text-slate-200",children:d.address||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-slate-500 block",children:"Location"})," ",e.jsxs("span",{className:"font-medium dark:text-slate-200",children:[d.city||"-",", ",d.country||"-"]})]})]})]},d._id))})]})},$="https://api.quader864.ir/api/expert/admin",O=()=>({"Content-Type":"application/json",Accept:"application/json"}),U=async s=>{const t=s.headers.get("content-type");if(t&&t.includes("application/json")){const u=await s.json();if(!s.ok){if(u.results||u.details)return u;throw new Error(u.message||`API Error: ${s.status}`)}return u}else{const u=await s.text();throw console.error(`Non-JSON response from ${s.url}:`,u.substring(0,100)),new Error(`API Error: ${s.status} (Invalid Response Format)`)}},T={getAvailableExperts:async()=>{try{const s=await fetch(`${$}/available-experts`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(s)}catch{return console.warn("Using fallback experts list"),{success:!0,experts:[{expertId:"EA_TREND_01",expertName:"TrendScout Pro",description:"Trend following EA",isActive:!0},{expertId:"EA_SCALP_X",expertName:"Scalp Master X",description:"High frequency scalper",isActive:!0},{expertId:"EA_GRID_V2",expertName:"Grid Logic V2",description:"Grid system with hedging",isActive:!1}]}}},addExpert:async s=>{try{const t=await fetch(`${$}/add-expert`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify(s)});return await U(t)}catch(t){throw t}},searchUsers:async(s,t=1,u=20)=>{try{const m=new URLSearchParams({q:s,page:String(t),limit:String(u)}),x=await fetch(`${$}/users-search?${m.toString()}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(x)}catch(m){return console.error("User search error:",m),{success:!1,users:[],total:0}}},addUser:async s=>{try{const t=await fetch(`${$}/add-user`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify(s)});return await U(t)}catch(t){throw t}},removeUser:async(s,t)=>{try{const u=await fetch(`${$}/remove-user`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:s,expertId:t})});return await U(u)}catch(u){throw u}},updateUser:async(s,t,u)=>{try{const m=await fetch(`${$}/update-user`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:s,expertId:t,updates:u})});return await U(m)}catch(m){throw m}},getUsers:async s=>{try{const t=new URLSearchParams;s!=null&&s.expertId&&t.append("expertId",s.expertId),s!=null&&s.licenseType&&t.append("licenseType",s.licenseType),(s==null?void 0:s.isActive)!==void 0&&t.append("isActive",String(s.isActive));const u=await fetch(`${$}/users?${t.toString()}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(u)}catch(t){throw console.error("Fetch expert users failed:",t),t}},getUserDetails:async s=>{try{const t=await fetch(`${$}/user/${encodeURIComponent(s)}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(t)}catch(t){throw t}},toggleAccess:async(s,t,u)=>{try{const m=await fetch(`${$}/toggle-access`,{method:"POST",headers:O(),mode:"cors",credentials:"include",body:JSON.stringify({userEmail:s,expertId:t,isActive:u})});return await U(m)}catch(m){throw m}},getStats:async s=>{try{const t=new URLSearchParams;s&&t.append("expertId",s);const u=await fetch(`${$}/usage-stats?${t.toString()}`,{method:"GET",headers:O(),mode:"cors",credentials:"include"});return await U(u)}catch(t){throw t}}},As=({onNotify:s})=>{const[t,u]=l.useState([]),[m,x]=l.useState(null),[n,h]=l.useState([]),[v,k]=l.useState(!1),[y,w]=l.useState(!1),[p,d]=l.useState(!1),[o,j]=l.useState({}),[f,S]=l.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),[b,C]=l.useState("add"),[r,i]=l.useState({userEmail:"",expertId:"",expertName:"",licenseType:"basic",expirationDate:"",maxAccounts:1,isActive:!0,notes:"",subStatus:"active",subPlan:"professional",subPeriodEnd:"",subPaymentMethod:"stripe"}),[c,N]=l.useState([]),[E,F]=l.useState(""),[Y,J]=l.useState([]),[R,H]=l.useState(!1),[K,te]=l.useState("partial"),[ae,re]=l.useState(null),Q=l.useRef(null),[Es,xe]=l.useState("create"),[_s,me]=l.useState(!1),[zs,Me]=l.useState(""),[Ms,he]=l.useState({expertId:"",name:"",description:"",metadata:"{}",isActive:!0}),[Ls,pe]=l.useState(null);l.useEffect(()=>{B()},[]);const B=async()=>{k(!0);try{const[a,g,P]=await Promise.all([T.getUsers(),T.getStats(),T.getAvailableExperts()]);u(a.users),x(g.stats),h(P.experts||[])}catch(a){console.error("Expert Data Fetch Error",a),s("error","Failed to load expert data: "+a.message)}finally{k(!1)}};l.useEffect(()=>(Q.current&&clearTimeout(Q.current),E.trim().length>=2?(H(!0),Q.current=setTimeout(async()=>{try{const a=await T.searchUsers(E);J(a.users)}catch(a){console.error("Search error",a)}finally{H(!1)}},400)):(J([]),H(!1)),()=>{Q.current&&clearTimeout(Q.current)}),[E]);const Le=a=>{const g=n.find(P=>P.expertId===a);i(P=>({...P,expertId:a,expertName:g?g.expertName:P.expertName}))},Re=a=>{c.find(g=>g.email===a.email)||N(g=>[...g,a]),F(""),J([])},$e=a=>{N(g=>g.filter(P=>P.email!==a))},Oe=()=>{i({userEmail:"",expertId:n.length>0?n[0].expertId:"",expertName:n.length>0?n[0].expertName:"",licenseType:"basic",expirationDate:"",maxAccounts:1,isActive:!0,notes:"",subStatus:"active",subPlan:"professional",subPeriodEnd:"",subPaymentMethod:"stripe"}),N([]),F(""),C("add"),te("partial"),re(null),w(!0)},Ue=(a,g)=>{var P,A,_,D;i({userEmail:a.email,expertId:g.expertId,expertName:g.expertName,licenseType:g.licenseType,expirationDate:g.expirationDate?new Date(g.expirationDate).toISOString().split("T")[0]:"",maxAccounts:g.maxAccounts||1,isActive:g.isActive,notes:"",subStatus:((P=g.subscription)==null?void 0:P.status)||"active",subPlan:((A=g.subscription)==null?void 0:A.plan)||"professional",subPeriodEnd:(_=g.subscription)!=null&&_.currentPeriodEnd?new Date(g.subscription.currentPeriodEnd).toISOString().split("T")[0]:"",subPaymentMethod:((D=g.subscription)==null?void 0:D.paymentMethod)||"stripe"}),N([{email:a.email,firstName:a.firstName||"",lastName:a.lastName||""}]),C("edit"),re(null),w(!0)},De=async a=>{a.preventDefault(),j(g=>({...g,expert_submit:!0}));try{const g={status:r.subStatus,plan:r.subPlan,currentPeriodEnd:r.subPeriodEnd||void 0,paymentMethod:r.subPaymentMethod},P={licenseType:r.licenseType,expirationDate:r.expirationDate||void 0,maxAccounts:r.maxAccounts,isActive:r.isActive,subscription:g};if(b==="add"){const A=c.map(le=>({userEmail:le.email,expertId:r.expertId,expertName:r.expertName,updates:P,notes:r.notes}));if(A.length===0)if(r.userEmail)A.push({userEmail:r.userEmail,expertId:r.expertId,expertName:r.expertName,updates:P,notes:r.notes});else throw new Error("Please select at least one user.");const _={items:A,atomic:K==="atomic"},D=await T.addUser(_);D.results?(re(D.results),(D.success||D.results.some(le=>le.success))&&B()):D.success&&(s("success",D.message||`Access granted to ${A.length} users.`),w(!1),B())}else{const A=await T.updateUser(r.userEmail,r.expertId,P);A.success&&(s("success",A.message),w(!1),B())}}catch(g){s("error",g.message||"Operation failed")}finally{j(g=>({...g,expert_submit:!1}))}},Te=async(a,g,P)=>{const A=`toggle_${a}_${g}`;j(_=>({..._,[A]:!0}));try{const _=await T.toggleAccess(a,g,!P);_.success&&(s("success",_.message),B())}catch(_){s("error",_.message)}finally{j(_=>({..._,[A]:!1}))}},Ve=(a,g)=>{S({isOpen:!0,title:"Remove Expert Access",message:`Are you sure you want to remove expert ${g} from user ${a}?`,isLoading:!1,onConfirm:async()=>{S(P=>({...P,isLoading:!0}));try{const P=await T.removeUser(a,g);P.success&&(s("success",P.message),B(),S(A=>({...A,isOpen:!1})))}catch(P){s("error",P.message),S(A=>({...A,isLoading:!1}))}}})},be=()=>{he({expertId:"",name:"",description:"",metadata:`{
  "category": "scalper"
}`,isActive:!0}),Me(`[
  { "expertId": "EXP_1", "name": "Expert One" },
  { "expertId": "EXP_2", "name": "Expert Two" }
]`),xe("create"),me(!1),pe(null),d(!0)},Fe=a=>{he({expertId:a.expertId,name:a.expertName,description:a.description||"",metadata:JSON.stringify(a.metadata||{},null,2),isActive:a.isActive!==!1}),xe("edit"),me(!1),pe(null),d(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ie,{isOpen:f.isOpen,title:f.title,message:f.message,isLoading:f.isLoading,onClose:()=>S(a=>({...a,isOpen:!1})),onConfirm:f.onConfirm}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Expert Access Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:be,className:"px-4 py-2 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-lg font-bold flex items-center gap-2 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(ge,{size:18})," Manage Catalog"]}),e.jsxs("button",{onClick:Oe,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold flex items-center gap-2 hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-600/20",children:[e.jsx(_e,{size:18})," Grant Access"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ge,{size:18,className:"text-accent-500"})," Available Expert Catalog"]}),e.jsxs("button",{onClick:be,className:"text-xs font-bold text-accent-600 hover:underline flex items-center gap-1",children:[e.jsx(Ze,{size:12})," Add New"]})]}),v?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3].map(a=>e.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-950 animate-pulse",children:[e.jsx("div",{className:"h-5 bg-slate-200 dark:bg-slate-800 rounded w-3/4 mb-3"}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-800 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-12 bg-slate-200 dark:bg-slate-800 rounded w-full"})]},a))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.length>0?n.map(a=>e.jsxs("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-950 hover:border-accent-500/50 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"font-bold text-sm text-slate-900 dark:text-white",children:a.expertName}),e.jsx("span",{className:`w-2 h-2 rounded-full ${a.isActive!==!1?"bg-emerald-500":"bg-red-500"}`,title:a.isActive!==!1?"Active":"Inactive"})]}),e.jsx("p",{className:"text-xs text-slate-500 font-mono mb-2",children:a.expertId}),a.description&&e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-3 line-clamp-2",children:a.description}),e.jsx("div",{className:"flex justify-end opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("button",{onClick:()=>Fe(a),className:"text-xs font-medium text-accent-600 hover:text-accent-700 dark:hover:text-accent-400 flex items-center gap-1",children:[e.jsx(X,{size:12})," Edit"]})})]},a.expertId)):e.jsx("div",{className:"col-span-full text-center py-8 text-slate-500 text-sm",children:"No experts defined in catalog."})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Licenses"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:(m==null?void 0:m.totalUsers)||0})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Active Users"}),e.jsx("div",{className:"text-2xl font-black text-emerald-600 dark:text-emerald-400 mt-1",children:(m==null?void 0:m.activeUsers)||0})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Trades"}),e.jsx("div",{className:"text-2xl font-black text-slate-900 dark:text-white mt-1",children:((m==null?void 0:m.totalTrades)||0).toLocaleString()})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-800",children:[e.jsx("div",{className:"text-xs font-bold text-slate-500 uppercase",children:"System Profit"}),e.jsxs("div",{className:"text-2xl font-black text-green-600 dark:text-green-400 mt-1",children:["$",((m==null?void 0:m.totalProfit)||0).toLocaleString()]})]})]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left min-w-[800px]",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4",children:"User"}),e.jsx("th",{className:"px-6 py-4",children:"Expert System"}),e.jsx("th",{className:"px-6 py-4",children:"License"}),e.jsx("th",{className:"px-6 py-4",children:"Subscription"}),e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsx(I,{className:"animate-spin mx-auto text-emerald-600"})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-500",children:"No active expert licenses found."})}):t.map(a=>a.experts.map((g,P)=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"font-bold text-slate-900 dark:text-white",children:[a.firstName," ",a.lastName]}),e.jsx("div",{className:"text-xs text-slate-500",children:a.email})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:g.expertName}),e.jsx("div",{className:"text-xs text-slate-500 font-mono",children:g.expertId})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex px-2 py-1 rounded text-xs font-bold uppercase bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700",children:g.licenseType})}),e.jsx("td",{className:"px-6 py-4",children:g.subscription?e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white capitalize",children:g.subscription.plan||"No Plan"}),e.jsx("div",{className:`capitalize font-medium ${g.subscription.status==="active"?"text-emerald-500":"text-slate-400"}`,children:g.subscription.status})]}):e.jsx("span",{className:"text-xs text-slate-400 italic",children:"None"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-bold ${g.isActive?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${g.isActive?"bg-emerald-500":"bg-red-500"}`}),g.isActive?"Active":"Suspended"]})}),e.jsxs("td",{className:"px-6 py-4 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Ue(a,g),className:"p-1.5 text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded transition-colors",title:"Edit Access",children:e.jsx(X,{size:16})}),e.jsx("button",{onClick:()=>Te(a.email,g.expertId,g.isActive),className:`p-1.5 rounded transition-colors ${g.isActive?"text-slate-500 hover:text-amber-600 hover:bg-amber-50 dark:hover:bg-amber-900/20":"text-slate-500 hover:text-emerald-600 hover:bg-emerald-50 dark:hover:bg-emerald-900/20"}`,title:g.isActive?"Suspend":"Activate",disabled:o[`toggle_${a.email}_${g.expertId}`],children:o[`toggle_${a.email}_${g.expertId}`]?e.jsx(I,{size:16,className:"animate-spin"}):e.jsx(ze,{size:16})}),e.jsx("button",{onClick:()=>Ve(a.email,g.expertId),className:"p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Revoke Access",children:e.jsx(Ie,{size:16})})]})]},`${a.email}-${P}`)))})]})})}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>w(!1)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto shadow-2xl border border-slate-200 dark:border-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-900 sticky top-0 z-10",children:[e.jsx("h3",{className:"font-bold text-lg dark:text-white",children:b==="add"?"Grant Expert Access":"Edit Access"}),e.jsx("button",{onClick:()=>w(!1),children:e.jsx(G,{size:20,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"})})]}),ae?e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Batch Operation Results"}),K==="atomic"&&ae.some(a=>!a.success)&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 p-4 rounded-lg mb-4 text-sm flex gap-3",children:[e.jsx(Z,{className:"shrink-0",size:20}),e.jsxs("p",{children:[e.jsx("strong",{children:"Operation Failed:"})," Strict mode was enabled and errors occurred."]})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border border-slate-200 dark:border-slate-800 rounded-lg divide-y divide-slate-200 dark:divide-slate-800 mb-6 custom-scrollbar",children:ae.map((a,g)=>e.jsxs("div",{className:`p-3 flex items-start justify-between gap-4 ${a.success?"bg-green-50/50 dark:bg-green-900/10":"bg-red-50/50 dark:bg-red-900/10"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-800 dark:text-white",children:a.userEmail}),e.jsx("div",{className:"text-xs text-slate-500",children:a.expertId}),!a.success&&a.error&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:a.error})]}),e.jsx("div",{className:"shrink-0 pt-1",children:a.success?e.jsx(V,{size:18,className:"text-emerald-500"}):e.jsx(Z,{size:18,className:"text-red-500"})})]},g))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>w(!1),className:"px-6 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-lg font-bold",children:"Close"})})]}):e.jsxs("form",{onSubmit:De,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Select Expert"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:r.expertId,onChange:a=>Le(a.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white appearance-none",disabled:b==="edit",children:[n.length===0&&e.jsx("option",{value:"",children:"Loading experts..."}),n.map(a=>e.jsxs("option",{value:a.expertId,children:[a.expertName," (",a.expertId,")"]},a.expertId))]}),e.jsx(Je,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",size:16})]})]}),b==="add"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Add Users"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:c.map(a=>e.jsxs("div",{className:"flex items-center gap-1 bg-accent-100 dark:bg-accent-900/30 text-accent-800 dark:text-accent-300 px-2 py-1 rounded-full text-xs font-medium border border-accent-200 dark:border-accent-800",children:[e.jsxs("span",{children:[a.firstName," ",a.lastName]}),e.jsx("button",{type:"button",onClick:()=>$e(a.email),className:"hover:text-red-500",children:e.jsx(G,{size:12})})]},a.email))}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:E,onChange:a=>F(a.target.value),className:"w-full px-3 py-2 pl-9 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",placeholder:"Search by name or email..."}),e.jsx(es,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),R&&e.jsx(I,{className:"absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-slate-400",size:16}),Y.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-lg shadow-xl max-h-60 overflow-y-auto z-20",children:Y.map(a=>e.jsxs("button",{type:"button",onClick:()=>Re(a),className:"w-full text-left px-4 py-2 hover:bg-slate-50 dark:hover:bg-slate-800 border-b border-slate-100 dark:border-slate-800 last:border-0 flex flex-col",children:[e.jsxs("span",{className:"font-bold text-sm text-slate-800 dark:text-white",children:[a.firstName," ",a.lastName]}),e.jsx("span",{className:"text-xs text-slate-500",children:a.email})]},a.email))})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"User Email"}),e.jsx("input",{type:"email",disabled:!0,value:r.userEmail,className:"w-full px-3 py-2 bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-slate-500 cursor-not-allowed"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"License Type"}),e.jsxs("select",{value:r.licenseType,onChange:a=>i({...r,licenseType:a.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"pro",children:"Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"}),e.jsx("option",{value:"trial",children:"Trial"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1",children:"Max Accounts"}),e.jsx("input",{type:"number",min:"1",value:r.maxAccounts,onChange:a=>i({...r,maxAccounts:parseInt(a.target.value)||1}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg outline-none focus:ring-2 focus:ring-accent-500 dark:text-white"})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/30 rounded-xl border border-slate-200 dark:border-slate-800 space-y-4",children:[e.jsxs("h4",{className:"text-xs font-bold uppercase text-slate-500 flex items-center gap-2 mb-2",children:[e.jsx(ss,{size:14})," Subscription Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Status"}),e.jsxs("select",{value:r.subStatus,onChange:a=>i({...r,subStatus:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Plan"}),e.jsxs("select",{value:r.subPlan,onChange:a=>i({...r,subPlan:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white",children:[e.jsx("option",{value:"basic",children:"Basic"}),e.jsx("option",{value:"professional",children:"Professional"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Period End"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:r.subPeriodEnd,onChange:a=>i({...r,subPeriodEnd:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white"}),e.jsx(ee,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Payment Method"}),e.jsx("input",{type:"text",placeholder:"stripe, crypto, etc.",value:r.subPaymentMethod,onChange:a=>i({...r,subPaymentMethod:a.target.value}),className:"w-full px-3 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg text-sm dark:text-white"})]})]})]}),b==="add"&&c.length>1&&e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2",children:"Batch Operation Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>te("partial"),className:`flex-1 py-2 text-xs font-bold rounded-md border transition-all ${K==="partial"?"bg-white dark:bg-slate-800 border-accent-500 text-accent-600 dark:text-accent-400 shadow-sm":"border-transparent text-slate-500 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:"Partial"}),e.jsx("button",{type:"button",onClick:()=>te("atomic"),className:`flex-1 py-2 text-xs font-bold rounded-md border transition-all ${K==="atomic"?"bg-white dark:bg-slate-800 border-accent-500 text-accent-600 dark:text-accent-400 shadow-sm":"border-transparent text-slate-500 hover:bg-white/50 dark:hover:bg-slate-800/50"}`,children:"Strict"})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3 border-t border-slate-100 dark:border-slate-800",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:o.expert_submit,className:"px-6 py-2 bg-accent-600 text-white rounded-lg font-bold hover:bg-accent-700 transition-colors shadow-lg shadow-accent-600/20 disabled:opacity-70 flex items-center gap-2",children:[o.expert_submit?e.jsx(I,{size:18,className:"animate-spin"}):e.jsx(ne,{size:18}),b==="add"?"Grant Access":"Update Access"]})]})]})]})]})]})},tt=()=>{const{user:s,logout:t,isLoading:u,checkAuth:m}=ke(),x=He(),[n,h]=l.useState("overview"),[v,k]=l.useState({show:!1,type:"success",message:""}),[y,w]=l.useState(null),[p,d]=l.useState({isOpen:!1,postId:null}),[o,j]=l.useState({}),f=(i,c)=>{k({show:!0,type:i,message:c})};l.useEffect(()=>{!u&&!s&&x("/auth/login")},[u,s,x]);const S=async()=>{await t(),x("/")},b=async i=>{if(w(i),!i.content&&!i.contentRaw)try{const c=await z.getById(i._id);c&&w(c)}catch(c){console.error("Failed to fetch full post details",c)}},C=async i=>{j(c=>({...c,[i]:!0}));try{const c=await z.approve(i);c.success&&(w(null),f("success",c.message))}catch{f("error","An error occurred")}finally{j(c=>({...c,[i]:!1}))}},r=async(i,c)=>{j(N=>({...N,[i]:!0}));try{const N=await z.reject(i,c);N.success&&(w(null),d({isOpen:!1,postId:null}),f("success",N.message))}catch{f("error","An error occurred")}finally{j(N=>({...N,[i]:!1}))}};return u?e.jsx("div",{className:"min-h-screen pt-24 flex items-center justify-center bg-slate-50 dark:bg-slate-950",children:e.jsxs("div",{className:"text-slate-600 dark:text-slate-400 font-medium animate-pulse flex items-center gap-2",children:[e.jsx(I,{className:"animate-spin"})," Loading dashboard..."]})}):s?e.jsxs("div",{className:"min-h-screen pt-24 pb-12 bg-slate-50 dark:bg-slate-950 px-4 sm:px-6 lg:px-8 transition-colors duration-500",children:[e.jsx(Qe,{show:v.show,type:v.type,message:v.message,onClose:()=>k(i=>({...i,show:!1}))}),y&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/80 backdrop-blur-sm",onClick:()=>w(null)}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg dark:text-white",children:["Reviewing: ",y.title]}),e.jsx("button",{onClick:()=>w(null),children:e.jsx(G,{size:20,className:"text-slate-500"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-slate-950",children:e.jsx(Xe,{content:y.content||y.contentRaw,title:y.title})}),e.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{d({isOpen:!0,postId:y._id})},className:"px-4 py-2 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-lg font-bold",children:"Reject"}),e.jsx("button",{onClick:()=>C(y._id),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg font-bold hover:bg-emerald-700",children:"Approve & Publish"})]})]})]}),e.jsx(se,{isOpen:p.isOpen,isProcessing:o[p.postId||""],onClose:()=>d(i=>({...i,isOpen:!1})),onConfirm:i=>{p.postId&&r(p.postId,i)}}),e.jsxs("div",{className:"max-w-7xl mx-auto flex flex-col md:flex-row gap-8",children:[e.jsx(fs,{user:s,activeTab:n,setActiveTab:h,onLogout:S}),e.jsxs("main",{className:"flex-1 min-w-0",children:[n==="overview"&&e.jsx(js,{user:s,onNavigate:h}),n==="profile"&&e.jsx(Ns,{user:s,onNotify:f,refreshUser:m}),n==="blog"&&e.jsx(ks,{user:s,onNotify:f}),n==="liked"&&e.jsx(ys,{user:s}),n==="verification"&&e.jsx(ws,{onNotify:f}),(s.role==="admin"||s.role==="moderator")&&n==="moderation"&&e.jsx(Ss,{onNotify:f,onViewPost:b}),s.role==="admin"&&e.jsxs(e.Fragment,{children:[n==="users"&&e.jsx(Cs,{onNotify:f,onViewPost:b}),n==="admin_verifications"&&e.jsx(Ps,{onNotify:f}),n==="admin_profiles"&&e.jsx(Is,{onNotify:f}),n==="expert_systems"&&e.jsx(As,{onNotify:f})]})]})]})]}):null};export{tt as default};
