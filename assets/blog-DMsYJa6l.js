const r="https://api.quader864.ir/api/blog",a=()=>({"Content-Type":"application/json",Accept:"application/json"}),o=async t=>{const e=t.headers.get("content-type");if(e&&e.includes("application/json")){const s=await t.json();if(!t.ok)throw new Error(s.error||s.message||`API Error: ${t.status}`);return s}else{const s=await t.text();throw console.error(`Non-JSON response from ${t.url}:`,s.substring(0,100)),new Error(`API Error: ${t.status} (Invalid Response Format)`)}},m={getAllPublic:async()=>{try{const t=await fetch(`${r}`,{method:"GET",headers:a(),mode:"cors",credentials:"include"});return await o(t)}catch(t){return console.error("Fetch public posts failed:",t),[]}},getBySlug:async t=>{try{const e=await fetch(`${r}/${t}`,{method:"GET",headers:a(),mode:"cors",credentials:"include"});return e.status===404?null:await o(e)}catch(e){return console.error("Fetch single post failed:",e),null}},getById:async t=>{try{const e=await fetch(`${r}/${t}`,{method:"GET",headers:a(),mode:"cors",credentials:"include"});return e.status===404?null:await o(e)}catch(e){return console.error("Fetch post by ID failed:",e),null}},getMyPosts:async t=>{try{const e=await fetch(`${r}`,{method:"GET",headers:a(),mode:"cors",credentials:"include"}),i=(await o(e)).filter(c=>typeof c.authorId=="string"?c.authorId===t:typeof c.authorId=="object"&&c.authorId._id?c.authorId._id===t:!1),u=await fetch(`${r}/me/posts`,{method:"GET",headers:a(),mode:"cors",credentials:"include"}),l=await o(u),h=[...i,...l],d=new Set;return h.filter(c=>{const n=d.has(c._id);return d.add(c._id),!n}).sort((c,n)=>new Date(n.createdAt).getTime()-new Date(c.createdAt).getTime())}catch(e){return console.warn("Fetch user posts failed:",e),[]}},getModerationPosts:async()=>{const t=await fetch(`${r}/panel`,{method:"GET",headers:a(),mode:"cors",credentials:"include"});if(t.status===404)throw console.error("CRITICAL: /api/blog/panel returned 404. This usually means the backend route is defined AFTER a dynamic route like '/:id'. Please move router.get('/panel') above any dynamic routes."),new Error("Endpoint not found (404). Backend route ordering issue suspected.");return await o(t)},getPending:async()=>await m.getModerationPosts(),create:async t=>{try{const e=await fetch(`${r}`,{method:"POST",headers:a(),mode:"cors",credentials:"include",body:JSON.stringify({...t,publish:t.visibility==="pending"})});return{success:!0,message:"Post created successfully",post:await o(e)}}catch(e){return{success:!1,message:e.message}}},update:async(t,e)=>{try{const s=await fetch(`${r}/${t}`,{method:"PATCH",headers:a(),mode:"cors",credentials:"include",body:JSON.stringify(e)});return{success:!0,message:"Post updated successfully",post:await o(s)}}catch(s){return{success:!1,message:s.message}}},submit:async t=>{try{const e=await fetch(`${r}/${t}/submit`,{method:"POST",headers:a(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await o(e),{success:!0,message:"Post submitted for approval"}}catch(e){return{success:!1,message:e.message}}},approve:async t=>{try{const e=await fetch(`${r}/${t}/approve`,{method:"POST",headers:a(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await o(e),{success:!0,message:"Post approved"}}catch(e){return{success:!1,message:e.message}}},reject:async(t,e)=>{try{const s=await fetch(`${r}/${t}/reject`,{method:"POST",headers:a(),mode:"cors",credentials:"include",body:JSON.stringify({reason:e})});return await o(s),{success:!0,message:"Post rejected"}}catch(s){return{success:!1,message:s.message}}},delete:async t=>{try{const e=await fetch(`${r}/${t}`,{method:"DELETE",headers:a(),mode:"cors",credentials:"include"});return{success:!0,message:(await o(e)).message||"Post deleted"}}catch(e){return{success:!1,message:e.message}}},toggleLike:async t=>{try{const e=await fetch(`${r}/${t}/toggle-like`,{method:"POST",headers:a(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await o(e)}catch(e){throw e}}};export{m as b};
