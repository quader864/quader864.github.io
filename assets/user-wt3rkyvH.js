import{w}from"./index-J9iKmyaX.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],j=w("users",g),o="https://api.quader864.ir/auth/verify",i=()=>({"Content-Type":"application/json",Accept:"application/json"}),s=async e=>{const t=e.headers.get("content-type");if(t&&t.includes("application/json")){const r=await e.json();if(!e.ok)throw new Error(r.message||`API Error: ${e.status}`);return r}else{const r=await e.text();throw console.error(`Non-JSON response from ${e.url}:`,r.substring(0,100)),new Error(`API Error: ${e.status} (Invalid Response Format)`)}},P=e=>{var a,n,p,f,h,y,m;const t=e.verification||e;if(!t||typeof t!="object")return{status:"UNVERIFIED",emailVerified:!1,identityVerified:!1,identityStatus:"unverified"};let r="unverified";return(a=t.identity)!=null&&a.verified?r="verified":t.rejectionReason?r="rejected":((n=t.identity)!=null&&n.documentKey||(p=t.identity)!=null&&p.documentUrl)&&(r="pending"),{status:t.overall||"UNVERIFIED",emailVerified:!!((f=t.email)!=null&&f.verified),identityVerified:!!((h=t.identity)!=null&&h.verified),identityStatus:r,rejectionReason:t.rejectionReason,updatedAt:((y=t.identity)==null?void 0:y.verifiedAt)||((m=t.email)==null?void 0:m.verifiedAt)}},E={getStatus:async()=>{try{const e=await fetch(`${o}/status`,{method:"GET",headers:i(),mode:"cors",credentials:"include"}),t=await s(e);return P(t)}catch(e){throw console.error("Fetch status failed:",e),e}},sendEmailOtp:async()=>{try{const e=await fetch(`${o}/email/send-otp`,{method:"POST",headers:i(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await s(e)}catch(e){throw new Error(e.message||"Failed to send OTP")}},confirmEmailOtp:async e=>{try{const t=await fetch(`${o}/email/confirm-otp`,{method:"POST",headers:i(),mode:"cors",credentials:"include",body:JSON.stringify({otp:e})});return await s(t)}catch(t){throw new Error(t.message||"Invalid OTP")}},uploadIdentity:async e=>{const t=new FormData;t.append("document",e);try{const r=await fetch(`${o}/identity/upload`,{method:"POST",headers:{Accept:"application/json"},mode:"cors",credentials:"include",body:t});return await s(r)}catch(r){throw new Error(r.message||"Upload failed")}},getPendingRequests:async()=>{try{const e=`${o}/identity/pending`,t=await fetch(e,{method:"GET",headers:i(),mode:"cors",credentials:"include"});return await s(t)}catch(e){return console.error("[VerificationAPI] Fetch pending failed:",e),[]}},getPresignedUrl:async e=>{try{const t=await fetch(`${o}/identity/${e}/presign`,{method:"GET",headers:i(),mode:"cors",credentials:"include"});return{url:(await s(t)).presignedUrl}}catch(t){throw new Error(t.message||"Failed to get document URL")}},approveIdentity:async e=>{try{const t=await fetch(`${o}/identity/${e}/approve`,{method:"POST",headers:i(),mode:"cors",credentials:"include",body:JSON.stringify({})});return await s(t)}catch(t){throw new Error(t.message||"Action failed")}},rejectIdentity:async(e,t)=>{try{const r=await fetch(`${o}/identity/${e}/reject`,{method:"POST",headers:i(),mode:"cors",credentials:"include",body:JSON.stringify({reason:t})});return await s(r)}catch(r){throw new Error(r.message||"Action failed")}}},c="https://api.quader864.ir/api/users",l=()=>({"Content-Type":"application/json",Accept:"application/json"}),d=async e=>{const t=e.headers.get("content-type");if(t&&t.includes("application/json")){const r=await e.json();if(!e.ok)throw new Error(r.message||r.error||`API Error: ${e.status}`);return r}else{const r=await e.text();throw console.error(`Non-JSON response from ${e.url}:`,r.substring(0,100)),new Error(`API Error: ${e.status} (Invalid Response Format)`)}},u=e=>e.profilePic&&!e.profilePic.startsWith("http")&&e.profilePic.includes("cdn.quader864.ir")?{...e,profilePic:`https://${e.profilePic}`}:e,v={getAll:async()=>{try{const e=await fetch(`${c}`,{method:"GET",headers:l(),mode:"cors",credentials:"include"});return(await d(e)).map(u)}catch(e){return console.error("Fetch users failed:",e),[]}},updateRole:async(e,t)=>{try{const r=await fetch(`${c}/${e}/role`,{method:"PATCH",headers:l(),mode:"cors",credentials:"include",body:JSON.stringify({role:t})});return await d(r),{success:!0,message:"User role updated successfully"}}catch(r){return{success:!1,message:r.message}}},uploadProfilePic:async e=>{const t=new FormData;t.append("profilePic",e);try{const r=await fetch(`${c}/upload/profile-pic`,{method:"POST",headers:{Accept:"application/json"},mode:"cors",credentials:"include",body:t});return await d(r)}catch(r){throw new Error(r.message||"Image upload failed")}},updateProfile:async e=>{try{const t=await fetch(`${c}/me/profile`,{method:"PATCH",headers:l(),mode:"cors",credentials:"include",body:JSON.stringify(e)}),r=await d(t);return r.user&&(r.user=u(r.user)),r}catch(t){throw new Error(t.message||"Profile update failed")}},verifyProfile:async(e,t,r)=>{try{const a=await fetch(`${c}/${e}/profile-verification`,{method:"PATCH",headers:l(),mode:"cors",credentials:"include",body:JSON.stringify({status:t,rejectionReason:r})}),n=await d(a);return n.user&&(n.user=u(n.user)),n}catch(a){throw new Error(a.message||"Verification update failed")}}};export{j as U,v as u,E as v};
